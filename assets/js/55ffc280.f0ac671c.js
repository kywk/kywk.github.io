"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["99003"],{26560:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>u,metadata:()=>s,assets:()=>d,contentTitle:()=>t});var s=JSON.parse('{"id":"javascript/package/sequelize_migration-seeds","title":"Sequelize: Migration","description":"Sequelize Migration","source":"@site/moco/javascript/package/sequelize_migration-seeds.md","sourceDirName":"javascript/package","slug":"/javascript/package/sequelize_migration-seeds","permalink":"/moco/javascript/package/sequelize_migration-seeds","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Node.js","permalink":"/moco/tags/node-js"},{"inline":true,"label":"ORM","permalink":"/moco/tags/orm"},{"inline":true,"label":"Nodejs/Sequelize","permalink":"/moco/tags/nodejs-sequelize"}],"version":"current","frontMatter":{"title":"Sequelize: Migration","description":"Sequelize Migration","tags":["Node.js","ORM","Nodejs/Sequelize"],"date_created":"2022-09-14T16:00:00.000Z","image":"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0"},"sidebar":"tutorialSidebar","previous":{"title":"axios_file-stream-pipe","permalink":"/moco/javascript/package/axios_file-stream-pipe"},"next":{"title":"Sequelize: Migration Seeds","permalink":"/moco/javascript/package/sequelize_migration"}}'),l=i(74848),r=i(84429);let a={title:"Sequelize: Migration",description:"Sequelize Migration",tags:["Node.js","ORM","Nodejs/Sequelize"],date_created:new Date("2022-09-14T16:00:00.000Z"),image:"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0"},t="[Node.js] Sequelize Migration",d={},c=[{value:"\u4EC0\u9EBC\u662F Migraiton ?",id:"\u4EC0\u9EBC\u662F-migraiton-",level:2},{value:"\u64CD\u4F5C\u884C\u70BA",id:"\u64CD\u4F5C\u884C\u70BA",level:3},{value:"\u53EF\u4EE5\u5E79\u561B",id:"\u53EF\u4EE5\u5E79\u561B",level:3},{value:"\u74B0\u5883\u5B89\u88DD\u8207\u8A2D\u7F6E",id:"\u74B0\u5883\u5B89\u88DD\u8207\u8A2D\u7F6E",level:2},{value:"sequelize-cli",id:"sequelize-cli",level:3},{value:"Project bootstrapping",id:"project-bootstrapping",level:3},{value:"configure",id:"configure",level:3},{value:"\u57FA\u672C\u4F7F\u7528\u6307\u4EE4",id:"\u57FA\u672C\u4F7F\u7528\u6307\u4EE4",level:2},{value:"\u6307\u4EE4\u5217\u8868",id:"\u6307\u4EE4\u5217\u8868",level:3},{value:"\u6A94\u6848\u67B6\u69CB",id:"\u6A94\u6848\u67B6\u69CB",level:2},{value:"Query Interface \u5E38\u7528\u65B9\u6CD5",id:"query-interface-\u5E38\u7528\u65B9\u6CD5",level:3},{value:"SQL \u8A9E\u6CD5",id:"sql-\u8A9E\u6CD5",level:3},{value:"\u9032\u968E\u4F7F\u7528",id:"\u9032\u968E\u4F7F\u7528",level:2},{value:"\u56DE\u6714\u7248\u672C",id:"\u56DE\u6714\u7248\u672C",level:3},{value:"\u8CC7\u6599\u8868\u95DC\u806F",id:"\u8CC7\u6599\u8868\u95DC\u806F",level:3},{value:"Hook",id:"hook",level:3},{value:"See Also",id:"see-also",level:2},{value:"Reference",id:"reference",level:3}];function o(e){let n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"nodejs-sequelize-migration",children:"[Node.js] Sequelize Migration"})}),"\n",(0,l.jsxs)(n.p,{children:["Sequelize \u662F Node.js \u4E0B\u76F8\u7576\u4E3B\u6D41\u7684 ORM \u5957\u4EF6.\nORM \u4F7F\u7528\u8207\u5426\u7684\u722D\u8AD6\u5927\u6982\u4E5F\u548C ",(0,l.jsx)(n.code,{children:"Space VS Tab"}),", ",(0,l.jsx)(n.code,{children:"Vi VS Emacs"})," ... \u4E00\u6A23\u7684\u6C38\u7121\u6B62\u76E1."]}),"\n",(0,l.jsx)(n.p,{children:"\u800C Sequelize 2 \u4E4B\u5F8C\u63A8\u51FA sequelize-cli \u4E2D\u7684 Migration \u529F\u80FD,\n\u900F\u904E\u4E00\u6B21\u53C8\u4E00\u6B21\u7684\u7DAD\u8B77\u6A94, \u78BA\u4FDD\u79FB\u690D\u6642\u6709\u76F8\u540C\u7684\u5EFA\u69CB\u904E\u7A0B,\n\u78BA\u5BE6\u80FD\u89E3\u6C7A\u7A0B\u5F0F\u958B\u767C\u968E\u6BB5\u5C0D\u8CC7\u6599\u5EAB\u64CD\u4F5C\u7684\u5E38\u898B\u56F0\u64FE:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u51FA\u554F\u984C\u56DE\u4E0D\u5230\u4E0A\u500B\u7248\u672C\uFF1F"}),"\n",(0,l.jsx)(n.li,{children:"\u5FD8\u8A18\u505A\u4E86\u54EA\u4E9B\u4FEE\u6539\uFF1F"}),"\n",(0,l.jsx)(n.li,{children:"\u6539\u4E86 schema \u6C92\u4EBA\u77E5\u9053\uFF1F"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4EC0\u9EBC\u662F-migraiton-",children:"\u4EC0\u9EBC\u662F Migraiton ?"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Migration"})," \u662F\u7528\u4F86\u63CF\u8FF0 \u300C\u8CC7\u6599\u5EAB\u7684\u7D50\u69CB\u638C\u4EC0\u9EBC\u6A23\u5B50\u300D \u7684\u6A94\u6848, \u96A8\u8457\u5C08\u6848\u958B\u767C\u904E\u7A0B\u4E2D\u5C0D\u8CC7\u6599\u5EAB\u7684\u4FEE\u6539\u800C\u9010\u6F38\u589E\u52A0."]}),"\n",(0,l.jsx)(n.li,{children:"\u53EF\u4EE5\u7406\u89E3\u6210\u8CC7\u6599\u5EAB\u683C\u5F0F\u8B8A\u66F4\u7684\u7248\u672C\u63A7\u5236."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://lh3.googleusercontent.com/pw/AL9nZEXTj9J5V07uQ7uWqG_O5kIuauTbX5mOu-pJ8RqJDe5CEPgkF4tHAR294BcbwsGbKdu0NbOqNCik91U8vG-fUtBbt6jVSr6tMuzjaQOIs5ZWTrx59xYN5phxsHd4GPEyX7oDNLn6KAT8Kr4u2f-dAO4lRg=w600-no?authuser=0",alt:"migration files"})}),"\n",(0,l.jsx)(n.h3,{id:"\u64CD\u4F5C\u884C\u70BA",children:"\u64CD\u4F5C\u884C\u70BA"}),"\n",(0,l.jsx)(n.p,{children:"Migration \u662F\u62FF\u4F86\u8B8A\u52D5\u8CC7\u6599\u8868\u7684, \u6240\u4EE5\u6703\u6709\u5E7E\u7A2E\u52D5\u4F5C\u5728\u9019\u88E1\u8655\u7406."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8B8A\u52D5\u8CC7\u6599\u8868"}),"\n",(0,l.jsx)(n.li,{children:"\u8B8A\u52D5\u6B04\u4F4D"}),"\n",(0,l.jsx)(n.li,{children:"\u8B8A\u52D5\u8CC7\u6599\u8868\u95DC\u806F"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u53EF\u4EE5\u5E79\u561B",children:"\u53EF\u4EE5\u5E79\u561B"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7D00\u9304\u64CD\u4F5C\u904E\u7A0B"}),"\n",(0,l.jsx)(n.li,{children:"\u964D\u4F4E\u4EBA\u70BA\u64CD\u4F5C\u932F\u8AA4\u7684\u53EF\u80FD"}),"\n",(0,l.jsx)(n.li,{children:"\u74B0\u5883\u90E8\u7F72\u6216\u662F\u66F4\u63DB\u8CC7\u6599\u5EAB\u7684\u6642\u5019\uFF0C\u5FEB\u901F\u9054\u6210\u540C\u6B65"}),"\n",(0,l.jsx)(n.li,{children:"\u932F\u8AA4\u767C\u751F\u6642\uFF0C\u53EF\u4EE5\u5FEB\u901F\u56DE\u5230\u6B63\u78BA\u7684\u7248\u672C"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u74B0\u5883\u5B89\u88DD\u8207\u8A2D\u7F6E",children:"\u74B0\u5883\u5B89\u88DD\u8207\u8A2D\u7F6E"}),"\n",(0,l.jsx)(n.h3,{id:"sequelize-cli",children:"sequelize-cli"}),"\n",(0,l.jsx)(n.p,{children:"sequelize-cli \u53EF\u7CFB\u7D71\u5168\u57DF\u5B89\u88DD\u6216\u5B89\u88DD\u5728\u5C08\u6848\u9805\u76EE, \u4F9D\u5BE6\u969B\u9700\u6C42\u800C\u5B9A."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"npm install --save-dev sequelize-cli \n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4EA6\u76F4\u63A5\u900F\u904E ",(0,l.jsx)(n.code,{children:"npx sequelize "})," \u57F7\u884C."]}),"\n",(0,l.jsx)(n.h3,{id:"project-bootstrapping",children:"Project bootstrapping"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"npx sequelize-cli init\n"})}),"\n",(0,l.jsx)(n.p,{children:"This will create following folders"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"config"}),", contains config file, which tells CLI how to connect with database"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"models"}),", contains all models for your project"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"migrations"}),", contains all migration files"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"seeders"}),", contains all seed files"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://lh3.googleusercontent.com/pw/AL9nZEVtWoXHl5m1PaPaMRoSgGYsCk8GxIE78CKElbigXOZj63pXqjmkjyDwnH-Vkk1cErjHsB_xFg_CJsdt6a5l2f-7_8wM046gAZDPcZK2Gc0-6LxwLxATYh81BU5m2V1NE_EscAE3DeLFXH1mb0JntUErkw=w314-no?authuser=0",alt:"tree"})}),"\n",(0,l.jsx)(n.h3,{id:"configure",children:"configure"}),"\n",(0,l.jsx)(n.p,{children:"\u4FEE\u6539 config/config.json \u88E1\u982D\u9023\u63A5 DB \u7684\u76F8\u95DC\u914D\u7F6E."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'"development": {\n    "username": "user",\n    "password": "password",\n    "database": "database name",\n    "host": "127.0.0.1",\n    "dialect": "mysql"\n  },\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8A2D\u5B9A\u5B8C\u5F8C\u5373\u53EF\u5229\u7528 sequelize \u4F86\u64CD\u4F5C DB. \u5982\u65B0\u5EFA\u4E00\u5F35 user table"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sequelize model:generate --name user --attributes name:string,mail:string\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u57FA\u672C\u4F7F\u7528\u6307\u4EE4",children:"\u57FA\u672C\u4F7F\u7528\u6307\u4EE4"}),"\n",(0,l.jsx)(n.p,{children:"\u900F\u904E\u4E0B\u5217\u6307\u4EE4\u53EF\u65B0\u589E migration, \u4E26\u4E14\u60F3\u597D migration message."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sequelize migration:create --name <migration message>\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5C31\u6703\u7522\u751F\u6A94\u6848 ",(0,l.jsx)(n.code,{children:"migrations/<YYYYMMDDHHMMSS>-<migration message>.js"}),".\n\u7528\u81EA\u5DF1\u7FD2\u6163\u7684\u7DE8\u8F2F\u5668\u53BB\u4FEE\u6539 js, \u642D\u914D ",(0,l.jsx)(n.a,{href:"https://sequelize.org/docs/v6/other-topics/query-interface/",children:"Query Interface"})," \u8A9E\u6CD5\u53BB\u5EFA\u7ACB\u6216\u8ABF\u6574\u8CC7\u6599\u5EAB Schema \u4FEE\u6539."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sequelize db:migrate\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u500B\u6307\u4EE4\u6703\u81EA\u52D5\u57F7\u884C\u5230\u6700\u5F8C\u4E00\u500B migration.js \u6A94\u6848\u88E1\u9762\u7684 ",(0,l.jsx)(n.code,{children:"up()"}),", \u70BA\u8CC7\u6599\u5EAB\u6B04\u4F4D\u9010\u6B21\u4FEE\u6539\u8ABF\u6574\u904E\u7A0B."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sequelize db:migrate:undo\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5247\u57F7\u884C js \u6A94\u6848\u88E1\u9762\u7684 ",(0,l.jsx)(n.code,{children:"down()"}),", \u5167\u5BB9\u70BA\u5C0D\u61C9\u4FEE\u6539\u7684\u9084\u539F\u8A9E\u6CD5."]}),"\n",(0,l.jsx)(n.h3,{id:"\u6307\u4EE4\u5217\u8868",children:"\u6307\u4EE4\u5217\u8868"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Sequelize CLI [Node: 16.17.0, CLI: 6.4.1, ORM: 6.21.6]\n\nsequelize <command>\n\nCommands:\n  sequelize db:migrate                        Run pending migrations\n  sequelize db:migrate:schema:timestamps:add  Update migration table to have timestamps\n  sequelize db:migrate:status                 List the status of all migrations\n  sequelize db:migrate:undo                   Reverts a migration\n  sequelize db:migrate:undo:all               Revert all migrations ran\n  sequelize db:seed                           Run specified seeder\n  sequelize db:seed:undo                      Deletes data from the database\n  sequelize db:seed:all                       Run every seeder\n  sequelize db:seed:undo:all                  Deletes data from the database\n  sequelize db:create                         Create database specified by configuration\n  sequelize db:drop                           Drop database specified by configuration\n  sequelize init                              Initializes project\n  sequelize init:config                       Initializes configuration\n  sequelize init:migrations                   Initializes migrations\n  sequelize init:models                       Initializes models\n  sequelize init:seeders                      Initializes seeders\n  sequelize migration:generate                Generates a new migration file\n  sequelize migration:create                  Generates a new migration file\n  sequelize model:generate                    Generates a model and its migration\n  sequelize model:create                      Generates a model and its migration\n  sequelize seed:generate                     Generates a new seed file\n  sequelize seed:create                       Generates a new seed file\n\nOptions:\n  --version  Show version number                                                           [boolean]\n  --help     Show help\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6A94\u6848\u67B6\u69CB",children:"\u6A94\u6848\u67B6\u69CB"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"up()"})," ",(0,l.jsx)(n.code,{children:"down()"})," \u90FD\u56DE\u50B3 promise"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",metastring:'title="migration-<DATA>-<MESSAGE>.js"',children:"'use strict';\n\nmodule.exports = {\n  up: (queryInterface, Sequelize) => {\n    // \u8981\u589E\u52A0\u5167\u5BB9\u7684\u52D5\u4F5C\n  },\n\n  down: (queryInterface, Sequelize) => {\n    // \u8981\u6E1B\u5C11\u5167\u5BB9\u7684\u52D5\u4F5C\n  }\n};\n"})}),"\n",(0,l.jsx)(n.h3,{id:"query-interface-\u5E38\u7528\u65B9\u6CD5",children:"Query Interface \u5E38\u7528\u65B9\u6CD5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u8B8A\u52D5\u8CC7\u6599\u8868\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u65B0\u589E\u8CC7\u6599\u8868 ",(0,l.jsx)(n.code,{children:"createTable(tableName, attributes, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u522A\u9664\u8CC7\u6599\u8868 ",(0,l.jsx)(n.code,{children:"dropTable(tableName, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u522A\u9664\u6240\u6709\u8CC7\u6599\u8868 ",(0,l.jsx)(n.code,{children:"dropAllTables(options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u91CD\u65B0\u547D\u540D\u8CC7\u6599\u8868 ",(0,l.jsx)(n.code,{children:"renameTable(before, after, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u986F\u793A\u8CC7\u6599\u8868\u9663\u5217 ",(0,l.jsx)(n.code,{children:"showAllTables(options)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"tableNames \u7684 datatype Array"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u986F\u793A\u8CC7\u6599\u8868 schema ",(0,l.jsx)(n.code,{children:"describeTable(tableName, options)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8B8A\u52D5\u6B04\u4F4D\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u589E\u52A0\u6B04\u4F4D ",(0,l.jsx)(n.code,{children:"addColumn(tableName, attributeName, dataTypeOrOptions, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u522A\u9664\u6B04\u4F4D ",(0,l.jsx)(n.code,{children:"removeColumn(tableName, attributeName, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u4FEE\u6539\u6B04\u4F4D\u8A2D\u5B9A ",(0,l.jsx)(n.code,{children:"changeColumn(tableName, attributeName, dataTypeOrOptions, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u91CD\u65B0\u547D\u540D\u6B04\u4F4D ",(0,l.jsx)(n.code,{children:"renameColumn(tableName, attrNameBefore, attrNameAfter, options)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8B8A\u52D5\u7D22\u5F15(\u8CC7\u6599\u8868\u5C6C\u6027\u7684\u529F\u80FD)\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5EFA\u7ACB\u7D22\u5F15 ",(0,l.jsx)(n.code,{children:"addIndex(tableName, attributes, options)"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u79FB\u9664\u7D22\u5F15 ",(0,l.jsx)(n.code,{children:"removeIndex(tableName, indexNameOrAttributes, options)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sql-\u8A9E\u6CD5",children:"SQL \u8A9E\u6CD5"}),"\n",(0,l.jsxs)(n.p,{children:["\u9664\u4E86\u547C\u53EB Query Interface \u5916, \u4F7F\u7528 ",(0,l.jsx)(n.code,{children:"queryInterface.sequelize.query(SQL \u8A9E\u6CD5)"})," \u7684\u7528\u6CD5,\n\u53EF\u4EE5\u76F4\u63A5\u57F7\u884C SQL \u8A9E\u6CD5, \u88DC\u8DB3 Query Interface \u65B9\u6CD5\u7684\u4E0D\u8DB3.\n\u6216\u56E0\u6545\u4E0D\u60F3\u900F\u904E Sequelize ORM \u8A9E\u6CD5\u6642, \u53EF\u76F4\u63A5\u4F7F\u7528\u6A19\u6E96 SQL \u4F86\u66F4\u6539\u8CC7\u6599\u5EAB Schema."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"up: (queryInterface, Sequelize) => {\n  return queryInterface.method(\n      //...\n    }).then(() => {\n      queryInterface.sequelize.query(`UPDATE table SET column=field`)\n    })\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u9032\u968E\u4F7F\u7528",children:"\u9032\u968E\u4F7F\u7528"}),"\n",(0,l.jsx)(n.h3,{id:"\u56DE\u6714\u7248\u672C",children:"\u56DE\u6714\u7248\u672C"}),"\n",(0,l.jsx)(n.p,{children:"\u53EF\u4EE5\u5EFA\u7ACB\u4E5F\u53EF\u4EE5\u56DE\u6EAF"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"sequelize db:migrate:undo  \u4E00\u6B21\u9000\u4E00\u500B\u7248\u672C"}),"\n",(0,l.jsx)(n.li,{children:"sequelize db:migrate:undo:all \u9000\u5230\u521D\u59CB\u72C0\u614B"}),"\n",(0,l.jsx)(n.li,{children:"sequelize db:migrate:undo:all --to XXXXXXXXXXXXXX-create-user.js \u9000\u5230\u6307\u5B9A\u7248\u672C"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u8CC7\u6599\u8868\u95DC\u806F",children:"\u8CC7\u6599\u8868\u95DC\u806F"}),"\n",(0,l.jsx)(n.p,{children:"\u5728 queryInterface.createTable / addColumn \u4E2D,\n\u5728 attributes \u5B9A\u7FA9\u6B04\u4F4D\u7684\u7269\u4EF6\u4E2D, \u5BEB reference \u6C7A\u5B9A\u8CC7\u6599\u5EAB\u8B8A\u52D5\u5F8C, \u95DC\u806F\u662F\u5426\u5B58\u5728."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"return queryInterface.addColumn(\n  'tableName',\n  'fieldName',\n  {\n    type: Sequelize.INTEGER.UNSIGNED,\n    references: {\n      model: 'tableName',\n      key: 'fieldName'\n    },\n    onDelete: 'SET NULL',\n    onUpdate: 'CASCADE'\n    //...\n  })\n},\n"})}),"\n",(0,l.jsx)(n.h3,{id:"hook",children:"Hook"}),"\n",(0,l.jsxs)(n.p,{children:["\u7576\u547C\u53EB add/set \u51FD\u6578\u6642, beforeUpdate/afterUpdate \u4E5F\u6703\u57F7\u884C.\n\u552F\u4E00\u53EF\u4EE5\u57F7\u884C beforeDestroy/afterDestroy \u7684\u65B9\u5F0F, \u5C31\u662F\u8A2D\u5B9A associations \u5C6C\u6027 onDelete: \u2018cascade\u2019.\n\u53C3\u8003: ",(0,l.jsx)(n.a,{href:"http://docs.sequelizejs.com/manual/tutorial/hooks.html",children:"http://docs.sequelizejs.com/manual/tutorial/hooks.html"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u547C\u53EB association \u6642\u8A2D\u5B9A hook \u9078\u9805, ex: ",(0,l.jsx)(n.code,{children:"onUpdate"}),", ",(0,l.jsx)(n.code,{children:"onDelete"}),".\n\u9810\u8A2D\u6240\u6709\u7684\u95DC\u806F, \u66F4\u65B0\u7528 CASCADE, \u522A\u9664\u7528 SET NULL, \u9664\u4E86 n:m \u95DC\u806F, \u7528 CASCADE \u522A\u9664."]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"RESTRICT"}),", \u540C NO ACTION"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CASCADE"}),", \u540C\u6B65 update/delete \u66F4\u65B0\u5B50\u8868 foreign key"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"NO ACTION"}),", \u4E0D\u5141\u8A31\u4E3B\u8868 update/delete"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SET DEFAULT"}),", \u5B50\u8868 foreign key \u8A2D\u70BA default (Innodb not use)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SET NULL"}),", \u5B50\u8868 foreign key \u8A2D\u70BA null"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Available constraints:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["UNIQUE\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"queryInterface.addConstraint('Users', ['email'], {\n  type: 'unique',\n  name: 'custom_unique_constraint_name'\n});  \n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["DEFAULT (MSSQL only)\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"queryInterface.addConstraint('Users', ['roles'], {\n  type: 'default',\n  defaultValue: 'guest'\n});\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["CHECK (MySQL - Ignored by the database engine)\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"queryInterface.addConstraint('Users', ['roles'], {\n  type: 'check',\n  where: {\n     roles: ['user', 'admin', 'moderator', 'guest']\n  }\n});\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["FOREIGN KEY\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"queryInterface.addConstraint('Posts', ['username'], {\n  type: 'foreign key',\n  name: 'custom_fkey_constraint_name',\n  references: { //Required field\n    table: 'target_table_name',\n    field: 'target_column_name'\n  },\n  onDelete: 'cascade',\n  onUpdate: 'cascade'\n});\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["PRIMARY KEY\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"queryInterface.addConstraint('Users', ['username'], {\n   type: 'primary key',\n   name: 'custom_primary_constraint_name'\n});\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsx)(n.p,{children:"\u96D6\u7136 Migration \u662F Sequelize \u6240\u63A8\u51FA\u7684, \u4F46 sequelize-cli \u53EF\u7368\u7ACB\u4F7F\u7528.\n\u4F7F\u7528 Sequelize Migration \u4F86\u7BA1\u7406\u5C08\u6848\u8CC7\u6599\u5EAB\u683C\u5F0F\u67B6\u69CB\u548C\u7A0B\u5F0F\u4E2D\u662F\u5426\u4F7F\u7528 Sequelize ORM \u4E26\u7121\u95DC\u4FC2."}),"\n",(0,l.jsxs)(n.p,{children:["\u4E0D\u559C\u4F7F\u7528 ORM \u7684\u958B\u767C\u8005\u6216\u65E2\u6709\u7684\u5C08\u6848, \u7121\u9808\u6539\u8B8A\u5B58\u53D6\u8CC7\u6599\u5EAB\u7684\u65B9\u5F0F,\n\u7A0B\u5F0F\u53EF\u4EE5\u4E0D\u900F\u904E Sequelize ORM, \u81EA\u884C\u8655\u7406\u8CC7\u6599\u5EAB\u5B58\u53D6\u4ECB\u9762.\n\u5C08\u6848\u4E5F\u53EF\u4EE5\u4E0D\u4F9D\u8CF4 ",(0,l.jsx)(n.code,{children:"qequelize-cli"}),",\n\u76F4\u63A5\u900F\u904E ",(0,l.jsx)(n.code,{children:"npx sequelize COMMAND [OPTIONS]"})," \u4F86\u57F7\u884C Sequelize Migration."]}),"\n",(0,l.jsx)(n.h3,{id:"reference",children:"Reference"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://sequelize.org/docs/v6/other-topics/migrations/",children:"Migrations | Sequelize"}),(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.a,{href:"https://sequelize.org/docs/v6/other-topics/query-interface/",children:"Query Interface"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dwatow.github.io/2018/09-24-sequelize/sequelize-migration/",children:"Sequelize Migration - \u300AChris \u6280\u8853\u7B46\u8A18\u300B"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://hackmd.io/@TSMI_E7ORNeP8YBbWm-lFA/ryCtaVW_M?print-pdf",children:"\u900F\u904E sequelize \u4F86\u9054\u6210 DB Schema Migration - HackMD"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},84429:function(e,n,i){i.d(n,{R:()=>a,x:()=>t});var s=i(96540);let l={},r=s.createContext(l);function a(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);