"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["35877"],{64098:function(n,e,o){o.r(e),o.d(e,{frontMatter:()=>s,toc:()=>d,default:()=>h,metadata:()=>i,assets:()=>t,contentTitle:()=>c});var i=JSON.parse('{"id":"golang/go-tour/go-tour_goroutine","title":"Goroutine","description":"Goroutine","source":"@site/moco/golang/go-tour/go-tour_goroutine.md","sourceDirName":"golang/go-tour","slug":"/golang/go-tour/go-tour_goroutine","permalink":"/moco/golang/go-tour/go-tour_goroutine","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Go","permalink":"/moco/tags/go"},{"inline":true,"label":"Go/GoTour","permalink":"/moco/tags/go-go-tour"}],"version":"current","frontMatter":{"title":"Goroutine","description":"Goroutine","tags":["Go","Go/GoTour"],"date_created":"2022-04-20T07:45:04.000Z","image":"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},"sidebar":"tutorialSidebar","previous":{"title":"defar","permalink":"/moco/golang/go-tour/go-tour_defer"},"next":{"title":"Get Started","permalink":"/moco/golang/go_get-started"}}'),l=o(85893),r=o(50065);let s={title:"Goroutine",description:"Goroutine",tags:["Go","Go/GoTour"],date_created:new Date("2022-04-20T07:45:04.000Z"),image:"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},c="[Go] Tour: Goroutine \u5FC3\u5F97\u7B46\u8A18",t={},d=[{value:"Threading",id:"threading",level:2},{value:"Goroutine \u4ECB\u7D39",id:"goroutine-\u4ECB\u7D39",level:2},{value:"LifeCycle",id:"lifecycle",level:2},{value:"\u7B49\u5019 Goroutine",id:"\u7B49\u5019-goroutine",level:2},{value:"sync.WaitGroup",id:"syncwaitgroup",level:3},{value:"channel",id:"channel",level:3},{value:"\u5171\u4EAB\u8B8A\u6578",id:"\u5171\u4EAB\u8B8A\u6578",level:2},{value:"sync.Mutex (\u4E92\u65A5\u9396)",id:"syncmutex-\u4E92\u65A5\u9396",level:3},{value:"\u85C9\u7531 Channel \u4FDD\u8B49\u8B8A\u6578\u7684\u5B89\u5168\u6027",id:"\u85C9\u7531-channel-\u4FDD\u8B49\u8B8A\u6578\u7684\u5B89\u5168\u6027",level:3},{value:"\u5C0F\u7D50",id:"\u5C0F\u7D50",level:2}];function a(n){let e={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"go-tour-goroutine-\u5FC3\u5F97\u7B46\u8A18",children:"[Go] Tour: Goroutine \u5FC3\u5F97\u7B46\u8A18"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.em,{children:["\u672C\u7BC7\u5927\u591A\u53C3\u8003\u65BC ",(0,l.jsx)(e.a,{href:"https://peterhpchen.github.io/2020/03/08/goroutine-and-channel.html",children:"Go \u7684\u4E26\u767C\uFF1AGoroutine \u8207 Channel \u4ECB\u7D39 - Limitless Ping"}),",\n\u52A0\u4E0A\u4E00\u4E9B\u500B\u4EBA\u7406\u89E3\u8207\u6574\u7406. \u5F37\u70C8\u5EFA\u8B70\u53C3\u95B1\u539F\u6587, \u5716\u6587\u4E26\u8302, \u6558\u4E8B\u689D\u7406\u5206\u660E\u7684\u597D\u6587\u7AE0."]})}),"\n",(0,l.jsx)(e.h2,{id:"threading",children:"Threading"}),"\n",(0,l.jsxs)(e.p,{children:["\u5148\u4F86\u4E86\u89E3\u57F7\u884C\u7DD2.",(0,l.jsx)(e.br,{}),"\n\u55AE\u57F7\u884C\u7DD2\u60C5\u6CC1\u4E0B, \u7A0B\u5F0F\u78BC\u6703\u4F9D\u5E8F\u57F7\u884C."]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'func say(s string) {\n    for i := 0; i < 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    begin := time.Now()\n    say("world")\n    say("hello")\n    diff := time.Now().Sub(begin)\n    fmt.Printf("spent %d ms", diff.Milliseconds())\n}\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"world\nworld\nworld\nworld\nworld\nhello\nhello\nhello\nhello\nhello\nspent 1000 ms\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u9019\u500B\u4F8B\u5B50\u4E2D, \u6703\u5148\u57F7\u884C\u5B8C ",(0,l.jsx)(e.code,{children:'say("world")'})," \u624D\u57F7\u884C ",(0,l.jsx)(e.code,{children:'say("hello")'}),"."]}),"\n",(0,l.jsx)(e.p,{children:"\u6709\u6642\u7A0B\u5F0F\u4E2D\u500B\u5225\u51FD\u5F0F\u4E4B\u9593\u4E26\u7121\u5148\u5F8C\u9806\u5E8F\u95DC\u4FC2, \u82E5\u53EF\u4EE5\u5584\u7528\u591A\u57F7\u884C\u7DD2\u57F7\u884C, \u5247\u53EF\u5927\u5E45\u63D0\u5347\u57F7\u884C\u6548\u7387.\n\u4E00\u822C\u4F86\u8AAA, Go \u591A\u57F7\u884C\u7DD2\u6700\u591A\u53EF\u4EE5\u540C\u6642\u57F7\u884C\u548C CPU \u6578\u91CF\u76F8\u7B49\u7684 Goroutine."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'func say(s string) {\n    for i := 0; i < 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    begin := time.Now()\n    go say("world")\n    say("hello")\n    diff := time.Now().Sub(begin)\n    fmt.Printf("spent %d ms", diff.Milliseconds())\n}\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"world\nhello\nworld\nhello\nhello\nworld\nworld\nhello\nhello\nspent 500 ms\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:'say("world")'})," \u6703\u5728\u53E6\u4E00\u500B\u57F7\u884C\u7DD2 (Goroutine) \u4E0A, \u548C ",(0,l.jsx)(e.code,{children:"main"})," \u7A0B\u5E8F\u540C\u6642\u57F7\u884C."]}),"\n",(0,l.jsx)(e.h2,{id:"goroutine-\u4ECB\u7D39",children:"Goroutine \u4ECB\u7D39"}),"\n",(0,l.jsx)(e.p,{children:"Goroutine \u985E\u4F3C golang \u7684 thread, \u8B93 Go \u53EF\u4EE5\u591A\u5DE5\u8655\u7406,\nmain function \u672C\u8EAB\u5C31\u662F\u4E00\u500B Goroutine,\n\u5E38\u898B\u6703\u548C Channel \u642D\u914D\u5354\u540C\u5DE5\u4F5C, \u53EF\u4EE5\u7C21\u5316 Goroutine \u64CD\u4F5C."}),"\n",(0,l.jsxs)(e.p,{children:["\u5EFA\u7ACB\u4E00\u500B Goroutine \u5C31\u7B49\u65BC\u5EFA\u7ACB\u4E00\u500B\u65B0\u57F7\u884C\u7DD2.\n\u5EFA\u7ACB Goroutine \u76F8\u7576\u7C21\u55AE, \u50C5\u9700\u5728\u51FD\u5F0F\u547C\u53EB\u524D\u52A0 ",(0,l.jsx)(e.code,{children:"go"})," \u524D\u7DB4\u8072\u660E\u5373\u53EF."]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"go f(x, y, z)\n"})}),"\n",(0,l.jsx)(e.h2,{id:"lifecycle",children:"LifeCycle"}),"\n",(0,l.jsx)(e.p,{children:"\u5728 golang \u4E2D, \u7576 main Goroutine \u7D50\u675F\u5F8C, \u5176\u4ED6 Goroutine \u90FD\u6703\u5F37\u5236\u7D50\u675F.\n\u56E0\u6B64 Goroutine \u751F\u547D\u9031\u671F\u5F9E\u88AB\u5EFA\u7ACB\u6642\u958B\u59CB, \u5230\u51FD\u5F0F\u57F7\u884C\u7D50\u675F\u8FD4\u56DE\u6216 main Goroutine \u7D50\u675F\u6642\u4E00\u8D77\u7D50\u675F."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'func say(s string) {\n    for i := 0; i < 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    begin := time.Now()\n    go say("world")\n    go say("hello")\n    time.Sleep(200 * time.Millisecond)\n    diff := time.Now().Sub(begin)\n    fmt.Printf("spent %d ms", diff.Milliseconds())\n}\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"world\nhello\nworld\nspent 200 ms\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u9019\u6BB5\u7A0B\u5F0F\u5171\u6709 ",(0,l.jsx)(e.code,{children:"main"}),", ",(0,l.jsx)(e.code,{children:'say("world")'}),", ",(0,l.jsx)(e.code,{children:'say("hello")'})," \u4E09\u500B Goroutine.\nmain Goroutune \u50C5\u9700\u82B1\u8CBB 200ms, \u5C11\u65BC\u5176\u4ED6\u5169\u500B ",(0,l.jsx)(e.code,{children:"say"})," Goroutine,\n\u7576 main \u7D50\u675F\u6642, \u53E6\u5916\u5169\u500B Goroutine \u6703\u8DDF\u8457\u5F37\u5236\u505C\u6B62."]}),"\n",(0,l.jsxs)(e.p,{children:["\u7528 ",(0,l.jsx)(e.code,{children:"time.Sleep"})," \u96D6\u7136\u53EF\u4EE5\u5EF6\u5F8C main \u7D50\u675F\u6642\u9593, \u8B93\u5176\u4ED6 Goroutine \u6709\u6A5F\u6703\u57F7\u884C\u5B8C\u6210.\n\u4F46\u82E5 sleep \u6642\u9593\u592A\u77ED, \u4ECD\u7121\u6CD5\u8B93\u5176\u4ED6 Goroutine \u5B8C\u6210.\n\u800C\u5982\u679C sleep \u6642\u9593\u592A\u9577, \u5247\u6703\u5F71\u97FF\u7A0B\u5F0F\u6548\u7387.\n\u9664\u975E\u7A0B\u5F0F\u57F7\u884C\u6642\u9593\u6709\u6240\u9650\u5236, \u5426\u5247\u7528 ",(0,l.jsx)(e.code,{children:"time.Sleep"})," \u4F86\u7B49\u5019 Goroutine \u4E26\u975E\u597D\u65B9\u6CD5."]}),"\n",(0,l.jsx)(e.h2,{id:"\u7B49\u5019-goroutine",children:"\u7B49\u5019 Goroutine"}),"\n",(0,l.jsxs)(e.p,{children:["\u82E5\u7A0B\u5F0F\u5FC5\u9808\u7B49\u5019\u6240\u6709 Goroutine \u57F7\u884C\u5B8C\u7562, \u900F\u904E sleep \u7B49\u5019\u662F\u4E0D\u53EF\u9760\u7684.\nGo \u88E1\u9762\u7684\u5E38\u898B\u7B49\u5019\u65B9\u5F0F\u6709 ",(0,l.jsx)(e.code,{children:"sync.WaitGroup"})," \u6216 ",(0,l.jsx)(e.code,{children:"channel"}),"."]}),"\n",(0,l.jsx)(e.h3,{id:"syncwaitgroup",children:"sync.WaitGroup"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"Package sync provides basic synchronization primitives such as mutual exclusion locks. Other than the Once and WaitGroup types, most are intended for use by low-level library routines. Higher-level synchronization is better done via channels and communication."}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:["Go \u5167\u5EFA ",(0,l.jsx)(e.code,{children:"sync"})," \u5957\u4EF6\u53EF\u4EE5\u7BA1\u7406\u591A\u500B Goroutine \u4E4B\u9593\u7684\u57F7\u884C\u72C0\u614B.",(0,l.jsx)(e.br,{}),"\n\u5728\u4E0A\u9762\u4F8B\u5B50\u4E2D, \u82E5\u7A0B\u5F0F\u9700\u7B49\u5019\u6240\u6709 Goroutine \u57F7\u884C\u7D50\u675F\u5F8C\u624D\u80FD\u7D50\u675F, \u53EF\u4F7F\u7528 ",(0,l.jsx)(e.code,{children:"sync.WaitGroup"}),"."]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'func say(s string, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    for i := 0; i < 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    wg := new(sync.WaitGroup)\n    wg.Add(2)\n\n    go say("world", wg)\n    go say("hello", wg)\n\n    wg.Wait()\n}\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5EFA\u7ACB\u548C\u9700\u8981\u7B49\u5019\u7684 Goroutine \u6578\u91CF\u76F8\u540C\u7684 ",(0,l.jsx)(e.code,{children:"WaitGroup"})," counter."]}),"\n",(0,l.jsxs)(e.li,{children:["\u5C07 ",(0,l.jsx)(e.code,{children:"WaitGroup"})," \u50B3\u5165 Goroutine \u4E2D, \u5728\u51FD\u5F0F\u57F7\u884C\u7D50\u675F\u6642\u547C\u53EB ",(0,l.jsx)(e.code,{children:"wg.Done()"})," \u5C07 counter \u6E1B\u4E00.",(0,l.jsx)(e.br,{}),"\n\u5E38\u898B\u6703\u5728\u51FD\u5F0F\u6700\u524D\u9762\u4F7F\u7528 ",(0,l.jsx)(e.code,{children:"defer wg.Done()"}),", \u4EE5\u78BA\u4FDD Goroutine \u7D50\u675F\u6642 ",(0,l.jsx)(e.code,{children:"wg.Done()"})," \u6703\u88AB\u57F7\u884C."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"wg.Wait()"})," \u6703\u7B49\u5019\u5230 counter \u70BA\u96F6\u70BA\u6B62."]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"WaitGroup"})," \u4F7F\u7528\u4E0A\u76F8\u5C0D\u7C21\u55AE, \u4F46\u8981\u6CE8\u610F\u624B\u52D5\u914D\u7F6E\u6578\u91CF\u7B26\u5408\u7684 counter."]}),"\n",(0,l.jsx)(e.h3,{id:"channel",children:"channel"}),"\n",(0,l.jsx)(e.p,{children:"channel \u901A\u5E38\u62FF\u4F86\u505A Goroutine \u4E4B\u9593\u6E9D\u901A\u8A0A\u606F\u6642\u4F7F\u7528,\n\u4F46\u56E0\u5176\u963B\u585E\u7279\u6027, \u4EA6\u53EF\u62FF\u4F86\u7576\u4F5C\u7B49\u5019 Goroutine \u7684\u65B9\u6CD5."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'func say(s string, c chan string) {\n    for i := 0; i < 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n    c <- "FINISH"\n}\n\nfunc main() {\n    ch := make(chan string)\n\n    go say("world", ch)\n    go say("hello", ch)\n\n    <-ch\n    <-ch\n}\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5EFA\u7ACB\u4E86\u4E00\u500B channel \u7528\u4EE5\u6E9D\u901A\u8A0A\u606F."}),"\n",(0,l.jsxs)(e.li,{children:["\u5EFA\u7ACB\u4E86 ",(0,l.jsx)(e.code,{children:"say()"})," Goroutine, \u50B3\u5165 channel."]}),"\n",(0,l.jsxs)(e.li,{children:["main \u51FD\u5F0F\u4E2D\u7B49\u5019 channel \u7684\u8CC7\u6599, \u6B64\u6642\u82E5 channel \u88E1\u9762\u6C92\u6709\u8CC7\u6599, \u6703\u963B\u585E\u7A0B\u5F0F\u57F7\u884C.\n\u76F4\u5230\u67D0\u500B Goroutine \u57F7\u884C\u5230 ",(0,l.jsx)(e.code,{children:'c <- "FINISH"'})," \u6642\u624D\u6703\u7E7C\u7E8C\u57F7\u884C."]}),"\n",(0,l.jsx)(e.li,{children:"\u672C\u4F8B\u4E2D\u5EFA\u7ACB\u4E86\u5169\u500B Goroutine, \u6240\u4EE5\u9700\u8981\u8B80\u53D6\u5169\u6B21 channel \u8CC7\u6599."}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"Channel \u963B\u585E\u7684\u65B9\u6CD5\u70BA Go \u8A9E\u8A00\u4E2D\u7B49\u5F85\u7684\u4E3B\u8981\u65B9\u5F0F."}),"\n",(0,l.jsx)(e.p,{children:"\u8981\u6CE8\u610F\u7684\u662F, Goroutine \u5E38\u6703\u548C Channel \u642D\u914D\u505A\u8A0A\u606F\u6E9D\u901A,\n\u82E5\u50B3\u5165\u7684 Channel \u6703\u62FF\u4F86\u6E9D\u901A\u8A0A\u606F, \u540C\u6642\u4E5F\u7576\u4F5C\u963B\u585E\u7B49\u5F85\u7684\u8A71, \u9700\u8981\u6CE8\u610F\u50B3\u56DE\u503C\u7684\u5224\u65B7\u7B49."}),"\n",(0,l.jsx)(e.h2,{id:"\u5171\u4EAB\u8B8A\u6578",children:"\u5171\u4EAB\u8B8A\u6578"}),"\n",(0,l.jsx)(e.p,{children:"\u591A\u57F7\u884C\u7DD2\u4E0B\u4F7F\u7528\u76F8\u540C\u8B8A\u6578\u6642, \u8981\u7279\u5225\u6CE8\u610F\u7AF6\u722D\u554F\u984C."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"func main() {\n    total := 0\n    for i := 0; i < 1000; i++ {\n        go func() {\n            total++\n        }()\n    }\n    time.Sleep(time.Second)\n    fmt.Println(total)\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-Shell",children:"981\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5728 for \u8FF4\u5708\u4E2D\u5EFA\u7ACB\u7684\u9589\u5305\u53C3\u7167\u4E86\u540C\u4E00\u500B total \u8B8A\u6578.\n\u591A\u57F7\u884C\u7DD2\u60C5\u6CC1\u4E0B, \u53EF\u80FD\u5C0E\u81F4\u5BE6\u969B\u904B\u884C\u72C0\u6CC1\u5982\u4E0B:"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u5047\u8A2D\u6B64\u6642 total \u503C\u70BA 70"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine1"})," \u8B80\u53D6 total (70), \u904B\u7B97 total++ = 71"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine2"})," \u8B80\u53D6 total (70), \u904B\u7B97 total++ = 71"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine2"})," \u5BEB\u56DE total \u503C 71"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine1"})," \u5BEB\u56DE total \u503C 71"]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"goroutine1"})," \u548C ",(0,l.jsx)(e.code,{children:"goroutine2"})," \u540C\u6642\u9032\u884C\u52A0\u6CD5\u904B\u7B97, \u4E26\u5148\u5F8C\u5C07\u8A08\u7B97\u5F8C\u7684\u503C\u5BEB\u56DE\u8A18\u61B6\u904E, \u53EF\u80FD\u5C0E\u81F4\u904B\u7B97\u932F\u8AA4.\n\u5728\u591A\u500B goroutine \u88E1\u5C0D\u540C\u4E00\u500B\u8B8A\u6578 total \u505A\u52A0\u6CD5\u904B\u7B97, \u5728\u8CE6\u503C\u6642\u7121\u6CD5\u78BA\u4FDD\u5176\u70BA\u5B89\u5168\u7684\u800C\u5C0E\u81F4\u904B\u7B97\u932F\u8AA4,\n\u6B64\u554F\u984C\u7A31\u70BA ",(0,l.jsx)(e.strong,{children:"Race Condition"}),"."]}),"\n",(0,l.jsxs)(e.p,{children:["\u5728\u57F7\u884C\u7DD2\u9593\u4F7F\u7528\u540C\u6A23\u7684\u8B8A\u6578\u6642, \u6700\u91CD\u8981\u7684\u662F\u78BA\u4FDD\u8B8A\u6578\u5728\u7576\u524D\u7684\u6B63\u78BA\u6027.",(0,l.jsx)(e.br,{}),"\nGo \u88E1\u9762\u6709\u5E7E\u500B\u5E38\u898B\u65B9\u6CD5:"]}),"\n",(0,l.jsx)(e.h3,{id:"syncmutex-\u4E92\u65A5\u9396",children:"sync.Mutex (\u4E92\u65A5\u9396)"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"sync.Mutex"})," (\u4E92\u65A5\u9396) \u662F sync \u5957\u4EF6\u4E2D\u7528\u4EE5\u78BA\u4FDD critical section \u6B63\u78BA\u6027\u7684\u5DE5\u5177\u7269\u4EF6.\n\u4E92\u65A5\u9396\u63D0\u4F9B\u5169\u500B\u65B9\u6CD5:"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Lock"}),"\n",(0,l.jsx)(e.li,{children:"Unlock\n\u5728 Lock \u53CA Unlock \u4E2D\u9593, \u6703\u4F7F\u5176\u4ED6\u7684 Goroutine \u7B49\u5F85, \u78BA\u4FDD\u6B64\u5340\u584A\u4E2D\u7684\u8B8A\u6578\u5B89\u5168."}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"sync.Mutex"})," \u76F8\u7576\u7C21\u6613\u597D\u7528, \u5BA3\u544A\u8B8A\u6578\u5F8C, \u5728\u8981\u9700\u4FDD\u8B77\u7684\u7A0B\u5F0F\u5340\u6BB5\u524D\u5F8C\u5206\u5225\u52A0\u4E0A Lock / Unlock \u5373\u53EF.\n\u5982\u4E0B:"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"func main() {\n    total := 0\n    mux := sync.Mutex{}\n    for i := 0; i < 1000; i++ {\n        go func() {\n            mux.Lock()\n            total++\n            mux.Unlock()\n        }()\n    }\n    time.Sleep(time.Second)\n    mux.Lock()\n    fmt.Println(total)\n    mux.Unlock()\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u85C9\u7531-channel-\u4FDD\u8B49\u8B8A\u6578\u7684\u5B89\u5168\u6027",children:"\u85C9\u7531 Channel \u4FDD\u8B49\u8B8A\u6578\u7684\u5B89\u5168\u6027"}),"\n",(0,l.jsx)(e.p,{children:"\u56E0\u70BA Channel \u63A8\u5165\u53CA\u62C9\u51FA\u6642\u963B\u585E\u8207\u7B49\u5F85\u7684\u7279\u6027, \u4E5F\u53EF\u4EE5\u628A\u5171\u4EAB\u8B8A\u6578\u5B58\u5165 Channel \u4E4B\u4E2D,\n\u62C9\u51FA\u4F86\u505A\u8A08\u7B97\u7684\u503C\u6703\u4FDD\u8B49\u662F\u5B89\u5168\u7684."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"func main() {\n    total := 0\n    ch := make(chan int, 1)\n    ch <- total\n    for i := 0; i < 1000; i++ {\n        go func() {\n            ch <- <-ch + 1\n        }()\n    }\n    time.Sleep(time.Second)\n    fmt.Println(<-ch)\n}\n"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u5C07 total \u8CC7\u6599\u5BEB\u5165 Channel \u4E4B\u4E2D."}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine1"})," \u5F9E Channel \u4E2D\u8B80\u53D6\u8CC7\u6599\u9032\u884C\u904B\u7B97."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine2"})," \u8981\u5F9E Channel \u8B80\u8CC7\u6599\u6642, \u56E0 Channel \u4E2D\u5DF2\u7121\u8CC7\u6599, \u9700\u7B49\u5019."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine1"})," \u628A\u904B\u7B97\u7D50\u679C\u5BEB\u56DE Channel."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"goroutine2"})," \u7B49\u5230 Channel \u4E2D\u6709\u8CC7\u6599, \u62C9\u51FA\u5F8C\u7D50\u675F\u7B49\u5F85, \u7E7C\u7E8C\u505A\u904B\u7B97."]}),"\n",(0,l.jsx)(e.li,{children:"..."}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"Channel \u963B\u585E\u7684\u7279\u6027, \u642D\u914D Goroutine \u53EF\u4EE5\u7528\u4F86\u4F5C\u6D41\u7A0B\u7BA1\u63A7\u7B49\u529F\u80FD.\n\u4F46 Channel \u9084\u6709\u5176\u4ED6\u7279\u6027, \u62FF Channel \u7576\u4F5C\u6E9D\u901A\u8CC7\u6599\u4E4B\u5916\u7684\u7528\u9014\u6642, \u4ECD\u9700\u7279\u5225\u6CE8\u610F."}),"\n",(0,l.jsx)(e.h2,{id:"\u5C0F\u7D50",children:"\u5C0F\u7D50"}),"\n",(0,l.jsxs)(e.p,{children:["\u5584\u7528 Goroutine \u591A\u57F7\u884C\u7DD2\u7279\u6027\u53EF\u4EE5\u907F\u514D\u7B49\u5019, \u589E\u9032\u7A0B\u5F0F\u6548\u7387.\n\u9700\u8981\u7B49\u5019\u7684\u6642\u6A5F, \u4E5F\u53EF\u7528 ",(0,l.jsx)(e.code,{children:"time.Sleep"}),", ",(0,l.jsx)(e.code,{children:"sync.WaitGroup"})," \u6216 Channel \u7684\u65B9\u5F0F\u8655\u7406."]}),"\n",(0,l.jsxs)(e.p,{children:["\u800C\u5728\u591A\u57F7\u884C\u7DD2\u7A0B\u5F0F\u4E2D\u5E38\u8981\u6CE8\u610F\u7684 Race Condition,\n\u5728 Go \u88E1\u53EF\u4EE5\u5F88\u7C21\u55AE\u7684\u7528 ",(0,l.jsx)(e.code,{children:"sync.Mutex"})," \u548C Channel \u4F86\u7BA1\u7406."]}),"\n",(0,l.jsx)(e.p,{children:"\u76F8\u5C0D\u5176\u4ED6\u8A9E\u8A00, Go \u5728\u591A\u57F7\u884C\u7DD2\u4E0A\u7684\u5275\u5EFA\u548C\u7BA1\u7406\u90FD\u76F8\u7576\u7C21\u55AE, \u5927\u5E45\u964D\u4F4E\u7A0B\u5F0F\u8907\u96DC\u5EA6.\n\u800C Channel \u7684\u963B\u585E\u7279\u6027, \u5728\u591A\u57F7\u884C\u7DD2\u4E2D\u767C\u63EE\u65B9\u4FBF\u5F37\u5927\u7684\u80FD\u529B, \u5F8C\u7BC7\u7E7C\u7E8C\u8A0E\u8AD6 Channel."}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:"/moco/golang/go-tour/go-tour_channel",children:(0,l.jsx)(e.em,{children:"\u7E8C: Go: Goroutine \u548C Channel \u5FC3\u5F97\u7B46\u8A18"})})})]})}function h(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},50065:function(n,e,o){o.d(e,{Z:()=>c,a:()=>s});var i=o(67294);let l={},r=i.createContext(l);function s(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);