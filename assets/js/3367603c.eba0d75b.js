"use strict";(self.webpackChunkkywk_github_io=self.webpackChunkkywk_github_io||[]).push([[52180],{93622:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>h,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>t});var i=l(85893),c=l(11151);const a={title:"Goroutine / Channel",description:"Goroutine / Channel",tags:["Go","Go/GoTour"],date:new Date("2022-04-21T04:03:41.000Z"),image:"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},r="[Go] Tour: Goroutine \u548c Channel \u5fc3\u5f97\u7b46\u8a18",o={id:"golang/go-tour/go-tour_channel",title:"Goroutine / Channel",description:"Goroutine / Channel",source:"@site/moco/golang/go-tour/go-tour_channel.md",sourceDirName:"golang/go-tour",slug:"/golang/go-tour/go-tour_channel",permalink:"/moco/golang/go-tour/go-tour_channel",draft:!1,unlisted:!1,tags:[{inline:!0,label:"Go",permalink:"/moco/tags/go"},{inline:!0,label:"Go/GoTour",permalink:"/moco/tags/go-go-tour"}],version:"current",frontMatter:{title:"Goroutine / Channel",description:"Goroutine / Channel",tags:["Go","Go/GoTour"],date:"2022-04-21T04:03:41.000Z",image:"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},sidebar:"tutorialSidebar",previous:{title:"A Tour of Go",permalink:"/moco/category/a-tour-of-go"},next:{title:"Closure",permalink:"/moco/golang/go-tour/go-tour_closure"}},h={},t=[{value:"Channel \u4ecb\u7d39",id:"channel-\u4ecb\u7d39",level:2},{value:"Channel \u7684\u963b\u585e",id:"channel-\u7684\u963b\u585e",level:3},{value:"\u5beb\u5165\u8cc7\u6599\u5230 Channel \u6642\u7684\u7b49\u5f85\u60c5\u5883",id:"\u5beb\u5165\u8cc7\u6599\u5230-channel-\u6642\u7684\u7b49\u5f85\u60c5\u5883",level:3},{value:"\u5f9e Channel \u8b80\u53d6\u8cc7\u6599\u6642\u7684\u7b49\u5f85\u60c5\u5883",id:"\u5f9e-channel-\u8b80\u53d6\u8cc7\u6599\u6642\u7684\u7b49\u5f85\u60c5\u5883",level:3},{value:"Unbuffered Channel",id:"unbuffered-channel",level:3},{value:"Buffered Channel",id:"buffered-channel",level:2},{value:"Buffer size",id:"buffer-size",level:3},{value:"Close channel",id:"close-channel",level:2},{value:"\u4f7f\u7528 range \u5de1\u8a2a channel",id:"\u4f7f\u7528-range-\u5de1\u8a2a-channel",level:3},{value:"Select",id:"select",level:2},{value:"\u5c0f\u7d50",id:"\u5c0f\u7d50",level:2},{value:"See Also",id:"see-also",level:2}];function s(n){const e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"go-tour-goroutine-\u548c-channel-\u5fc3\u5f97\u7b46\u8a18",children:"[Go] Tour: Goroutine \u548c Channel \u5fc3\u5f97\u7b46\u8a18"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"/moco/golang/go-tour/go-tour_goroutine",children:(0,i.jsx)(e.em,{children:"\u627f: Go: Goroutine \u5fc3\u5f97\u7b46\u8a18"})})}),"\n",(0,i.jsx)(e.h2,{id:"channel-\u4ecb\u7d39",children:"Channel \u4ecb\u7d39"}),"\n",(0,i.jsx)(e.p,{children:"\u524d\u7bc7\u85c9\u7531\u5169\u500b\u5728\u591a\u57f7\u884c\u7dd2\u4e2d\u91cd\u8981\u7684\u8b70\u984c: \u7b49\u5f85\u53ca\u8b8a\u6578\u5171\u4eab, \u5e36\u51fa Channel \u5f37\u5927\u7684\u8655\u7406\u80fd\u529b, \u63a5\u8457\u6df1\u5165\u4e86\u89e3 Channel."}),"\n",(0,i.jsx)(e.p,{children:"Channel \u53ef\u4ee5\u60f3\u6210\u4e00\u689d\u7ba1\u7dda, \u9019\u689d\u7ba1\u7dda\u53ef\u4ee5\u5beb\u5165\u6578\u503c, \u4e5f\u53ef\u4ee5\u5c07\u6578\u503c\u8b80\u53d6\u51fa\u4f86."}),"\n",(0,i.jsx)(e.p,{children:"\u5efa\u7acb Channel"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"ch := make(chan int) // \u5efa\u7acb int \u578b\u5225\u7684 Channel\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u63a8\u5165 / \u62c9\u51fa Channel \u5167\u7684\u503c, \u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"<-"})," \u7bad\u982d\u904b\u7b97\u5b50:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Channel \u5728 ",(0,i.jsx)(e.code,{children:"<-"})," \u5de6\u908a\uff1a\u5c07\u7bad\u982d\u53f3\u908a\u7684\u6578\u503c\u63a8\u5165 Channel \u4e2d"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"ch <- v    // Send v to channel ch.\nv := <-ch  // Receive from ch, and assign value to v.\n"})}),"\n",(0,i.jsx)(e.h3,{id:"channel-\u7684\u963b\u585e",children:"Channel \u7684\u963b\u585e"}),"\n",(0,i.jsxs)(e.p,{children:["Channel \u6703\u7b49\u5f85\u81f3\u53e6\u4e00\u7aef\u5b8c\u6210\u63a8\u5165 / \u62c9\u51fa\u7684\u52d5\u4f5c\u5f8c\u624d\u6703\u7e7c\u7e8c\u5f80\u4e0b\u8655\u7406,\n\u9019\u6a23\u7684\u7279\u6027\u4f7f\u5176\u53ef\u4ee5\u5728 Goroutines \u9593\u540c\u6b65\u7684\u8655\u7406\u8cc7\u6599, \u53ef\u4ee5\u4e0d\u4f7f\u7528\u660e\u78ba\u7684 ",(0,i.jsx)(e.code,{children:"mutex.Lock"}),", ",(0,i.jsx)(e.code,{children:"mutex.Unlock"})," \u7b49\u65b9\u6cd5."]}),"\n",(0,i.jsx)(e.p,{children:"\u800c Channel \u4ec0\u9ebc\u60c5\u6cc1\u4e0b\u6703\u963b\u585e\u5462?\n\u4e00\u822c\u4f86\u8aaa, Goroutine \u4f7f\u7528 Channel \u6642\u6709\u5169\u7a2e\u60c5\u6cc1\u6703\u9020\u6210\u963b\u585e:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5c07\u8cc7\u6599\u5beb\u5165 Channel \u5f8c,\n\u5beb\u5165\u8cc7\u6599\u7684 Goroutine \u6703\u7b49\u5f85 Channel \u8cc7\u6599\u88ab\u5176\u4ed6 Goroutine \u62c9\u53d6\u5f8c\u624d\u80fd\u7e7c\u7e8c\u57f7\u884c."}),"\n",(0,i.jsx)(e.li,{children:"\u82e5\u7576 Channel \u4e2d\u6c92\u6709\u8cc7\u6599, \u4f46\u8981\u5f9e\u4e2d\u8b80\u53d6\u6642,\n\u8b80\u53d6\u8cc7\u6599\u7684 Goroutine \u6703\u7b49\u5f85\u5176\u4ed6 Goroutine \u5beb\u5165\u8cc7\u6599,\n\u4e26\u7b49\u5019\u81ea\u5df1\u62c9\u53d6\u5b8c\u6210\u624d\u80fd\u5f80\u4e0b\u57f7\u884c."}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5beb\u5165\u8cc7\u6599\u5230-channel-\u6642\u7684\u7b49\u5f85\u60c5\u5883",children:"\u5beb\u5165\u8cc7\u6599\u5230 Channel \u6642\u7684\u7b49\u5f85\u60c5\u5883"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() { // calculate goroutine\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH" // goroutine \u57f7\u884c\u6703\u5728\u6b64\u88ab\u8feb\u7b49\u5f85\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    time.Sleep(2 * time.Second) // \u4f7f main \u6bd4 goroutine \u6162\n    fmt.Println(<-ch)\n    time.Sleep(time.Second)\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"calculate goroutine starts calculating\ncalculate goroutine ends calculating\nFINISH\ncalculate goroutine finished\nmain goroutine finished\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6b64\u4f8b\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"time.Sleep"})," \u5f37\u8feb main \u57f7\u884c\u6162\u65bc calculate, \u73fe\u5728\u4f86\u89c0\u5bdf\u8f38\u51fa\u7684\u7d50\u679c:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"calculate \u6703\u5148\u57f7\u884c\u4e26\u4e14\u8a08\u7b97\u5b8c\u6210"}),"\n",(0,i.jsxs)(e.li,{children:["calculate \u5c07 ",(0,i.jsx)(e.code,{children:"FINISH"})," \u8a0a\u865f\u63a8\u5165 Channel"]}),"\n",(0,i.jsxs)(e.li,{children:["\u4f46\u7531\u65bc\u76ee\u524d main \u9084\u672a\u62c9\u53d6 Channel \u4e2d\u7684\u8cc7\u6599, \u6240\u4ee5 calculate \u6703\u88ab\u8feb\u7b49\u5f85.\n\u56e0\u6b64 calculate \u7684\u6700\u5f8c\u4e00\u884c ",(0,i.jsx)(e.code,{children:'fmt.Println("main goroutine finished")'})," \u6c92\u6709\u99ac\u4e0a\u8f38\u51fa\u5728\u756b\u9762\u4e0a"]}),"\n",(0,i.jsx)(e.li,{children:"main \u62c9\u53d6\u4e86 Channel \u4e2d\u7684\u8cc7\u6599"}),"\n",(0,i.jsxs)(e.li,{children:["calculate \u57f7\u884c ",(0,i.jsx)(e.code,{children:'fmt.Println("main goroutine finished")'})," \u4e26\u7d50\u675f"]}),"\n",(0,i.jsx)(e.li,{children:"main \u57f7\u884c\u5b8c\u6210"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5f9e-channel-\u8b80\u53d6\u8cc7\u6599\u6642\u7684\u7b49\u5f85\u60c5\u5883",children:"\u5f9e Channel \u8b80\u53d6\u8cc7\u6599\u6642\u7684\u7b49\u5f85\u60c5\u5883"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() { // calculate goroutine\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH" // goroutine \u57f7\u884c\u6703\u5728\u6b64\u88ab\u8feb\u7b49\u5f85\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    //time.Sleep(2 * time.Second) // \u4f7f main \u6bd4 goroutine \u6162\n    fmt.Println(<-ch)\n    time.Sleep(time.Second)\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"calculate goroutine starts calculating\ncalculate goroutine ends calculating\ncalculate goroutine finished\nFINISH\nmain goroutine finished\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u9019\u4f8b\u5b50\u4e2d\u628a main \u4e2d\u7684 ",(0,i.jsx)(e.code,{children:"time.Sleep(2 * time.Second)"})," \u8a3b\u89e3\u6389."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["main \u8b80\u53d6\u8cc7\u6599\u6642, calculate \u9084\u6c92\u5c07\u8cc7\u6599\u63a8\u5165 Channel \u4e2d, main \u9700\u8981\u7b49\u5f85.\n\u56e0\u6b64 main \u7684\u6700\u5f8c\u4e00\u884c ",(0,i.jsx)(e.code,{children:"fmt.println"})," \u6c92\u6709\u99ac\u4e0a\u8f38\u51fa\u5728\u756b\u9762\u4e0a"]}),"\n",(0,i.jsx)(e.li,{children:"calculate \u57f7\u884c\u4e26\u4e14\u8a08\u7b97\u5b8c\u6210"}),"\n",(0,i.jsxs)(e.li,{children:["calculate \u5c07 ",(0,i.jsx)(e.code,{children:"FINISH"})," \u63a8\u5165 Channel"]}),"\n",(0,i.jsx)(e.li,{children:"calculate \u57f7\u884c\u5b8c\u6210"}),"\n",(0,i.jsx)(e.li,{children:"main \u62c9\u53d6\u4e86 Channel \u4e2d\u7684\u8cc7\u6599\u4e26\u4e14\u57f7\u884c\u5b8c\u6210"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"unbuffered-channel",children:"Unbuffered Channel"}),"\n",(0,i.jsx)(e.p,{children:"\u524d\u9762\u6240\u8aaa\u7684 Channel \u963b\u585e\u60c5\u6cc1\u90fd\u662f\u5c6c\u65bc Unbuffered Channel, \u6b64\u7a2e Channel \u53ea\u8981"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5beb\u5165\u4e00\u500b\u8cc7\u6599\u6703\u9020\u6210\u5beb\u5165\u65b9\u7684\u7b49\u5f85"}),"\n",(0,i.jsx)(e.li,{children:"\u8b80\u53d6\u6642\u6c92\u6709\u8cc7\u6599\u6703\u9020\u6210\u8b80\u53d6\u6642\u7684\u7b49\u5f85"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Unbuffered Channel \u7684\u554f\u984c\u662f: \u5982\u679c\u5beb\u65b9\u57f7\u884c\u6642\u9593\u8f03\u8b80\u53d6\u65b9\u77ed, \u5beb\u5165\u8cc7\u6599\u5f8c\u6703\u9020\u6210\u5beb\u5165\u65b9\u88ab\u8feb\u7b49\u5f85\u8cc7\u6599\u8b80\u53d6\u5f8c\u624d\u80fd\u7e7c\u7e8c\u8655\u7406,\n\u5982\u679c\u5beb\u5165\u8cc7\u6599\u5f8c\u7e8c\u7684\u7a0b\u5f0f\u7121\u9808\u7b49\u5019\u8cc7\u6599\u88ab\u8b80\u53d6\u53ef\u4ee5\u6b63\u78ba\u57f7\u884c\u57f7\u884c, \u9019\u6a23\u7684\u7b49\u5f85\u662f\u4e0d\u5fc5\u8981\u4e14\u53ef\u4ee5\u88ab\u907f\u514d\u7684."}),"\n",(0,i.jsx)(e.p,{children:"\u70ba\u4e86\u89e3\u6c7a\u5beb\u5165\u6642\u7b49\u5f85\u554f\u984c, \u53ef\u4ee5\u4f7f\u7528\u53e6\u4e00\u7a2e Channel: Buffered Channel."}),"\n",(0,i.jsx)(e.h2,{id:"buffered-channel",children:"Buffered Channel"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"ch := make(chan int, 100)\n"})}),"\n",(0,i.jsx)(e.p,{children:"Buffered Channel \u7684\u5ba3\u544a\u9700\u5728\u7b2c\u4e8c\u500b\u53c3\u6578\u4e2d\u5b9a\u7fa9 buffer \u7684\u9577\u5ea6,\n\u5b83\u53ea\u6703\u8b93 Buffered \u4e2d\u8cc7\u6599\u586b\u6eff\u4ee5\u5f8c\u624d\u6703\u963b\u585e\u5beb\u5165\u9020\u6210\u7b49\u5f85."}),"\n",(0,i.jsx)(e.p,{children:"\u4ee5\u4e0a\u4f8b\u4f86\u8aaa: \u7b2c 101 \u500b\u8cc7\u6599\u63a8\u5165\u7684\u6642\u5019, \u63a8\u5165\u65b9\u7684 Goroutine \u624d\u6703\u7b49\u5f85."}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u9762\u4f8b\u5b50\u5206\u5225\u4f7f\u7528 Buffered Channel \u8ddf Unbuffered Channel \u7684\u5dee\u5225:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func main() {\n    ch := make(chan int)\n    ch <- 1 // \u7b49\u5230\u5929\u8352\u5730\u8001\n    fmt.Println(<-ch)\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /tmp/sandbox3906241671/prog.go:11 +0x37\n\nProgram exited.\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e0a\u4f8b\u4f7f\u7528 Unbuffered Channel:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53ea\u6709\u4e00\u689d Goroutine: main"}),"\n",(0,i.jsx)(e.li,{children:"\u63a8\u5165 1 \u5f8c\u56e0\u70ba\u9084\u6c92\u6709\u5176\u4ed6 Goroutine \u62c9\u53d6 Channel \u4e2d\u7684\u8cc7\u6599, \u6240\u4ee5\u9032\u5165\u963b\u585e\u72c0\u614b."}),"\n",(0,i.jsx)(e.li,{children:"\u56e0\u70ba main \u5df2\u7d93\u5728\u63a8\u5165\u8cc7\u6599\u6642\u963b\u585e, \u62c9\u53d6\u7684\u7a0b\u5f0f\u6c38\u9060\u4e0d\u6703\u88ab\u57f7\u884c, \u9020\u6210\u6b7b\u7d50."}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u76f8\u540c\u7684\u60c5\u6cc1\u4e0b\uff0cBuffered Channel \u4e26\u4e0d\u6703\u88ab\u963b\u585e\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-GO",children:"func main() {\n    ch := make(chan int, 1)\n    ch <- 1\n    fmt.Println(<-ch)\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"1\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u539f\u56e0\u662f:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u63a8\u5165 1 \u5f8c Channel \u5167\u7684\u8cc7\u6599\u6578\u70ba1\u4e26\u6c92\u6709\u8d85\u904e Buffer \u7684\u9577\u5ea61, \u6240\u4ee5\u4e0d\u6703\u88ab\u963b\u585e."}),"\n",(0,i.jsx)(e.li,{children:"\u56e0\u70ba\u6c92\u6709\u963b\u585e, \u4e0b\u4e00\u884c\u62c9\u53d6\u7684\u7a0b\u5f0f\u78bc\u53ef\u4ee5\u88ab\u57f7\u884c, \u4e26\u5b8c\u6210\u57f7\u884c."}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"buffer-size",children:"Buffer size"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func main() {\n    ch := make(chan int, 5)\n    for i:=0 ; i < 6; i++ {\n        ch <- i\n        fmt.Println(i)\n    }\n    fmt.Println('FINISH')\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"0\n1\n2\n3\n4\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5efa\u7acb\u4e00\u500b Buffer \u9577\u5ea6 5 \u7b46\u8cc7\u6599\u7684 Channel"}),"\n",(0,i.jsx)(e.li,{children:"\u5beb\u5165\u524d\u4e94\u7b46\u8cc7\u6599\u6642\u4e0d\u6703\u963b\u585e,\n\u5beb\u5165\u7b2c\u516d\u7b46\u8cc7\u6599\u6642, \u56e0 Buffer \u5df2\u6eff, \u9020\u6210\u5beb\u5165\u8cc7\u6599\u963b\u585e."}),"\n",(0,i.jsx)(e.li,{children:"\u56e0\u6c92\u6709\u5176\u4ed6 Goroutine \u5728\u57f7\u884c, \u6240\u4ee5\u5beb\u5165\u963b\u585e\u9020\u6210 deadlock. \u7a0b\u5f0f\u932f\u8aa4."}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan int, 5)\n    go func() {\n        fmt.Println("Read data Goroutine")\n        fmt.Println("Read i:", <-ch)\n    }()\n    for i := 0; i < 6; i++ {\n        ch <- i\n        fmt.Println(i)\n    }\n    fmt.Println("FINISH. current first data on buffer is: ", <- ch)\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"0\n1\n2\n3\n4\nRead data Goroutine\nRead i: 0\n5\nFINISH. current first data on buffer is:  1\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u627f\u524d\u4f8b. \u5beb\u5165\u524d\u4e94\u7b46\u8cc7\u6599\u6642\u4e0d\u6703\u963b\u585e, \u800c\u5beb\u5165\u7b2c\u516d\u7b46\u8cc7\u6599\u6642\u9020\u6210 main \u963b\u585e."}),"\n",(0,i.jsx)(e.li,{children:"\u7a0b\u5f0f\u57f7\u884c\u8b80\u53d6\u8cc7\u6599\u7684 Goroutine. Buffer \u7b2c\u4e00\u7b46\u8cc7\u6599\u88ab\u62c9\u53d6,\n\u6240\u4ee5 Buffer \u7a7a\u51fa\u4e00\u7b46\u8cc7\u6599\u53ef\u4ee5\u63a8\u5165."}),"\n",(0,i.jsxs)(e.li,{children:["main \u63a8\u5165\u7b2c\u516d\u7b46\u8cc7\u6599, \u7a0b\u5f0f\u6b63\u78ba\u7d50\u675f. \u6b64\u6642 Channel \u7b2c\u4e00\u7b46\u8cc7\u6599\u70ba ",(0,i.jsx)(e.code,{children:"1"})]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"close-channel",children:"Close channel"}),"\n",(0,i.jsx)(e.p,{children:"\u5f9e Channel \u62c9\u53d6\u8cc7\u6599\u6642, \u53ef\u4ee5\u85c9\u7531\u7b2c\u4e8c\u500b\u56de\u50b3\u503c\u78ba\u8a8d Channel \u662f\u5426\u88ab\u95dc\u9589, \u5e38\u6703\u5728\u8ff4\u5708\u4e2d\u4f7f\u7528.\n\u5982\u679c\u88ab\u95dc\u9589\u7684\u8a71\u4ee3\u8868\u6b64 Channel \u5df2\u7d93\u4e0d\u518d\u4f7f\u7528, \u53ef\u4ee5\u7d50\u675f\u8ff4\u5708."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int)\n    go func() {\n        for i := 0; i < 10; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95dc\u9589 Channel\n    }()\n    for {\n        v, ok := <-c\n        if !ok { // \u5224\u65b7 Channel \u662f\u5426\u95dc\u9589\n            break\n        }\n        fmt.Println("read i:", v)\n    }\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u5c0d Closed Channel \u63a8\u5165\u8cc7\u6599\u7684\u8a71\u6703\u9020\u6210 Panic\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func main() {\n    c := make(chan int)\n    close(c)\n    c <- 0 // Panic!!!\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"panic: send on closed channel\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u70ba\u4e86\u907f\u514d\u5c07\u8cc7\u6599\u63a8\u5165\u5df2\u95dc\u9589\u7684 Channel \u4e2d\u9020\u6210 Panic, Channel \u7684\u95dc\u9589\u61c9\u8a72\u7531\u63a8\u5165\u7684 Goroutine \u8655\u7406."})}),"\n",(0,i.jsx)(e.h3,{id:"\u4f7f\u7528-range-\u5de1\u8a2a-channel",children:"\u4f7f\u7528 range \u5de1\u8a2a channel"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728\u8ff4\u5708\u4e2d\u62c9\u53d6 Channel \u4e2d\u7684\u8cc7\u6599, \u9664\u4e86\u53ef\u4ee5\u7528\u7b2c\u4e8c\u56de\u50b3\u503c\u5224\u65b7 Channel \u662f\u5426\u95dc\u9589,\n",(0,i.jsx)(e.code,{children:"range"})," \u4e5f\u662f\u53ef\u4ee5\u5de1\u89bd Channel \u7684. \u7d42\u6b62\u689d\u4ef6\u70ba Channel \u7684\u72c0\u614b\u70ba\u5df2\u95dc\u9589\u7684."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int)\n    go func() {\n        for i := 0; i < 5; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95dc\u9589 Channel\n    }()\n    for i := range c { // \u5728 close \u5f8c\u8df3\u51fa\u8ff4\u5708\n        fmt.Println("read i:", i)\n    }\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"push i: 0\npush i: 1\nread i: 0\nread i: 1\npush i: 2\npush i: 3\nread i: 2\nread i: 3\npush i: 4\nread i: 4\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"range"})," \u4f86\u5de1\u8a2a Channel \u8cc7\u6599\u6642, \u540c\u6a23\u6703\u9020\u6210\u8b80\u53d6\u8cc7\u6599\u548c\u63a8\u5165\u8cc7\u6599\u7684\u963b\u585e.\n\u5982\u4e0a, \u5c0d\u65bc Unbuddered Channel \u5beb\u5165\u548c\u8b80\u53d6\u8cc7\u6599,\npush \u548c read \u5169\u500b Goroutine \u6703\u76f8\u4e92\u963b\u585e, \u53ef\u80fd\u5f71\u97ff\u6548\u80fd."]}),"\n",(0,i.jsx)(e.p,{children:"\u53ef\u642d\u914d Buffered Channel \u4f7f\u7528, \u9069\u7576\u60c5\u6cc1\u4e0b\u6703\u6e1b\u5c11\u963b\u585e, \u63d0\u5347\u6548\u80fd."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int, 5)\n    go func() {\n        for i := 0; i < 8; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95dc\u9589 Channel\n    }()\n    for i := range c { // \u5728 close \u5f8c\u8df3\u51fa\u8ff4\u5708\n        fmt.Println("read i:", i)\n    }\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"push i: 0\npush i: 1\npush i: 2\npush i: 3\npush i: 4\npush i: 5\npush i: 6\nread i: 0\nread i: 1\nread i: 2\nread i: 3\nread i: 4\nread i: 5\nread i: 6\npush i: 7\nread i: 7\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u53e6\u5916\u8981\u6ce8\u610f\u7684\u662f, ",(0,i.jsx)(e.code,{children:"range"})," \u7d50\u675f\u689d\u4ef6\u548c buffer size \u7121\u95dc,\n\u4e0a\u4f8b\u4e2d buffer size \u70ba 5 \u7684 Channel, \u900f\u904e ",(0,i.jsx)(e.code,{children:"range"})," \u4ecd\u53ef\u8b80\u51fa 8 \u7b46\u8cc7\u6599.\n",(0,i.jsx)(e.code,{children:"range"})," \u7d50\u675f\u50c5\u4ee5 channel close \u70ba\u6e96."]}),"\n",(0,i.jsx)(e.h2,{id:"select",children:"Select"}),"\n",(0,i.jsx)(e.p,{children:"\u5728 Channel \u63a8\u5165/\u62c9\u53d6\u6642, \u56e0 Channel \u963b\u585e\u7684\u7279\u6027, \u6703\u6709\u4e00\u6bb5\u7b49\u5f85\u7684\u6642\u9593\u800c\u9020\u6210 Goroutine \u7121\u6cd5\u56de\u61c9.\n\u5982\u679c\u6b64 Goroutine \u662f\u8ca0\u8cac\u8655\u7406\u756b\u9762\u7684, \u4f7f\u7528\u8005\u5c31\u6703\u770b\u5230\u756b\u9762 lag \u7684\u60c5\u6cc1, \u9019\u662f\u6211\u5011\u4e0d\u60f3\u898b\u7684\u60c5\u6cc1."}),"\n",(0,i.jsx)(e.p,{children:"\u4f8b\u5982\u4e4b\u524d\u63d0\u5230\u7684\u4f8b\u5b50:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() {\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH"\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    fmt.Println("main goroutine is waiting for channel to receive value")\n    fmt.Println(<-ch) // goroutine \u57f7\u884c\u6703\u5728\u6b64\u88ab\u8feb\u7b49\u5f85\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"main goroutine is waiting for channel to receive value # main goroutine \u963b\u585e\ncalculate goroutine starts calculating\ncalculate goroutine ends calculating\ncalculate goroutine finished\nFINISH # main goroutine \u89e3\u9664\u963b\u585e\nmain goroutine finished\n"})}),"\n",(0,i.jsxs)(e.p,{children:["main goroutine \u8981\u62c9\u53d6 ",(0,i.jsx)(e.code,{children:"ch"})," \u7684\u8cc7\u6599\u6642\u6703\u88ab\u8feb\u7b49\u5f85.\n\u9019\u6642\u7121\u6cd5\u56de\u994b\u76ee\u524d\u7684\u72c0\u614b\u7d66\u4f7f\u7528\u8005, \u9020\u6210\u5361\u9813."]}),"\n",(0,i.jsxs)(e.p,{children:["\u9019\u6642\u53ef\u4ee5\u4f7f\u7528 Go \u63d0\u4f9b\u7684 ",(0,i.jsx)(e.code,{children:"select"})," \u8a9e\u6cd5,\n\u8b93\u958b\u767c\u8005\u53ef\u4ee5\u5f88\u8f15\u9b06\u7684\u8655\u7406 Channel \u7684\u591a\u7a2e\u60c5\u6cc1, \u5305\u62ec\u963b\u585e\u6642\u7684\u8655\u7406."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() {\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH"\n        time.Sleep(time.Second)\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    for {\n        select {\n        case <-ch: // Channel \u4e2d\u6709\u8cc7\u6599\u57f7\u884c\u6b64\u5340\u57df\n            fmt.Println("main goroutine finished")\n            return\n        default: // Channel \u963b\u585e\u7684\u8a71\u57f7\u884c\u6b64\u5340\u57df\n            fmt.Println("WAITING...")\n            time.Sleep(500 * time.Millisecond)\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"WAITING... # main goroutine \u5728\u963b\u585e\u6642\u53ef\u4ee5\u56de\u61c9\ncalculate goroutine starts calculating\nWAITING... # main goroutine \u5728\u963b\u585e\u6642\u53ef\u4ee5\u56de\u61c9\nWAITING... # main goroutine \u5728\u963b\u585e\u6642\u53ef\u4ee5\u56de\u61c9\ncalculate goroutine ends calculating\nmain goroutine finished # main goroutine \u89e3\u9664\u963b\u585e\u4e26\u7d50\u675f\u7a0b\u5f0f\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5c07\u525b\u525b\u7684\u4f8b\u5b50\u6539\u70ba ",(0,i.jsx)(e.code,{children:"select"})," \u4f86\u8655\u7406, \u53ef\u4ee5\u4f7f Channel \u7684\u63a8\u5165/\u62c9\u53d6\u4e0d\u6703\u963b\u585e:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6703\u5728\u6c92\u6709\u963b\u585e\u7684\u60c5\u6cc1\u4e0b\u624d\u6703\u57f7\u884c\u5c0d\u61c9\u7684\u5340\u584a"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"case <-ch:"})," \u6703\u7b49\u5230\u6c92\u6709\u963b\u585e\u60c5\u6cc1\u6642 (",(0,i.jsx)(e.code,{children:"ch"})," \u5167\u6709\u8cc7\u6599) \u624d\u6703\u57f7\u884c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"default:"})," \u5728\u6240\u6709\u7684 ",(0,i.jsx)(e.code,{children:"case"})," \u90fd\u963b\u585e\u7684\u60c5\u6cc1\u4e0b\u57f7\u884c"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u56e0\u70ba\u6709 ",(0,i.jsx)(e.code,{children:"default"})," \u53ef\u4ee5\u8a2d\u7f6e, \u7576 Channel \u963b\u585e\u6642\u4e5f\u53ef\u4ee5\u85c9\u7531 ",(0,i.jsx)(e.code,{children:"default"})," \u8f38\u51fa\u8cc7\u8a0a\u8b93\u4f7f\u7528\u8005\u77e5\u9053."]}),"\n",(0,i.jsx)(e.h2,{id:"\u5c0f\u7d50",children:"\u5c0f\u7d50"}),"\n",(0,i.jsx)(e.p,{children:"Channel \u662f Goroutine \u7684\u597d\u5e6b\u624b, \u524d\u7bc7\u5584\u7528 Channel \u7684\u963b\u585e\u7279\u6027,\n\u53ef\u4ee5\u7528\u4f86\u7ba1\u7406 Goroutine \u5171\u7528\u8b8a\u6578\u5b58\u53d6\u7b49\u63a7\u5236."}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u7bc7\u8aaa\u660e Channel \u7684\u963b\u585e\u6642\u6a5f (\u63a8\u5165\u963b\u585e\u53ca\u62c9\u53d6\u963b\u585e),\n\u4ee5\u53ca Unbuffered \u53ca Buffered Channel \u5c0d\u963b\u585e\u7684\u5dee\u5225.\n\u5247\u53ef\u85c9\u7531 Unbuffered Channel \u964d\u4f4e\u6548\u80fd\u4e0a\u7684\u640d\u5931."}),"\n",(0,i.jsx)(e.p,{children:"Channel \u50b3\u56de\u7684\u7b2c\u4e8c\u500b\u53c3\u6578: ok, \u53ef\u4ee5\u5224\u65b7\u6b64 Channel \u662f\u5426\u5df2\u7d93\u95dc\u9589,\n\u4e26\u88ab range \u7528\u5728\u7d50\u675f\u5de1\u89bd\u7684\u5224\u65b7\u4e2d."}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u5f8c, select \u53ef\u4ee5 Channel \u5728\u963b\u585e\u6642\u8b93 Goroutine \u4fdd\u6301\u975e\u963b\u585e\u7684\u72c0\u614b\u907f\u514d\u5361\u9813."}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u85c9\u7531 Goroutine \u53ca Channel \u7c21\u55ae\u7684\u8a9e\u6cd5\u4f46\u662f\u5f37\u5927\u7684\u80fd\u529b\u4f7f\u5de5\u7a0b\u5e2b\u958b\u767c\u591a\u5de5\u7a0b\u5f0f\u7684\u6642\u5019\u53ef\u4ee5\u5beb\u51fa\u512a\u96c5\u53c8\u6613\u65bc\u7dad\u8b77\u7684\u4ee3\u78bc, \u662f Go \u8a9e\u8a00\u7684\u512a\u52e2\u4e4b\u4e00"})}),"\n",(0,i.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://peterhpchen.github.io/2020/03/08/goroutine-and-channel.html",children:"Go \u7684\u4e26\u767c\uff1aGoroutine \u8207 Channel \u4ecb\u7d39 - Limitless Ping"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://easonwang.gitbook.io/golang/ji-ben-yu-fa/channel",children:"Channel \u8207Goroutine - Golang \u7b46\u8a18"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://blog.wu-boy.com/2020/01/when-to-use-go-channel-and-goroutine/",children:"\u4f7f\u7528 Go Channel \u53ca Goroutine \u6642\u6a5f - \u5c0f\u60e1\u9b54 - AppleBOY"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://pjchender.dev/golang/goroutine-channels-concurrency/",children:"[Golang] goroutines, channels, and concurrency"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"http://www.hangdaowangluo.com/archives/2504",children:"Goroutine\u548cchannel\u7684\u8be6\u7ec6\u7406\u89e3\uff08\u4e00\uff09 - \u7cbe\u5f69\u6bcf\u4e00\u5929"})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(s,{...n})}):s(n)}},11151:(n,e,l)=>{l.d(e,{Z:()=>o,a:()=>r});var i=l(67294);const c={},a=i.createContext(c);function r(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:r(n.components),i.createElement(a.Provider,{value:e},n.children)}}}]);