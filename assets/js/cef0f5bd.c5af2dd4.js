"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["58282"],{92095:function(n,e,s){s.r(e),s.d(e,{default:()=>h,frontMatter:()=>c,metadata:()=>i,assets:()=>o,toc:()=>a,contentTitle:()=>t});var i=JSON.parse('{"id":"devsecops/infra/ubuntu_nginx-php","title":"Ubuntu: NGINX + PHP","description":"\u9577\u671F\u4EE5\u4F86 Apache Server \u7684\u6548\u80FD\u8207\u627F\u8F09\u6578\u4F4E\u843D, \u52A0\u4E0A\u5C64\u51FA\u4E0D\u7AAE\u7684\u6F0F\u6D1E,","source":"@site/moco/devsecops/infra/ubuntu_nginx-php.md","sourceDirName":"devsecops/infra","slug":"/devsecops/infra/ubuntu_nginx-php","permalink":"/moco/devsecops/infra/ubuntu_nginx-php","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Infra","permalink":"/moco/tags/infra"},{"inline":true,"label":"Linux/Ubuntu","permalink":"/moco/tags/linux-ubuntu"},{"inline":true,"label":"NGINX","permalink":"/moco/tags/nginx"},{"inline":true,"label":"PHP","permalink":"/moco/tags/php"}],"version":"current","frontMatter":{"title":"Ubuntu: NGINX + PHP","tags":["Infra","Linux/Ubuntu","NGINX","PHP"],"date_created":"2021-03-16T08:58:20.000Z","image":"https://lh3.googleusercontent.com/pw/ACtC-3eEjuPzkzGlfvO-sUeB3BeuDd4MxMyUP2r4vJp53f2rK8p-vaRCNdC-UxOMDAQhANNfSTQr9fD4wJBSuDu3dXYIoMYDjaLJV6Np0KQZxnfY0VOm-JrNfVj_c0AjrP0jFEBKnJJrw8qAr8quoeHa5OuKJA=w750-h375-no?authuser=0"},"sidebar":"tutorialSidebar","previous":{"title":"Redis: \u8B66\u544A\u8207\u554F\u984C\u6392\u9664","permalink":"/moco/devsecops/infra/redis_troubleshooting"},"next":{"title":"Security","permalink":"/moco/category/security"}}'),r=s("85893"),l=s("50065");let c={title:"Ubuntu: NGINX + PHP",tags:["Infra","Linux/Ubuntu","NGINX","PHP"],date_created:new Date("2021-03-16T08:58:20.000Z"),image:"https://lh3.googleusercontent.com/pw/ACtC-3eEjuPzkzGlfvO-sUeB3BeuDd4MxMyUP2r4vJp53f2rK8p-vaRCNdC-UxOMDAQhANNfSTQr9fD4wJBSuDu3dXYIoMYDjaLJV6Np0KQZxnfY0VOm-JrNfVj_c0AjrP0jFEBKnJJrw8qAr8quoeHa5OuKJA=w750-h375-no?authuser=0"},t="[Ubuntu] \u5229\u7528 NGINX \u4F3A\u670D\u5668\u57F7\u884C PHP \u7A0B\u5F0F",o={},a=[{value:"CGI",id:"cgi",level:3},{value:"FastCGI",id:"fastcgi",level:3},{value:"FPM(FastCGI Process Manager)",id:"fpmfastcgi-process-manager",level:3},{value:"Installation",id:"installation",level:2},{value:"Nginx",id:"nginx",level:3},{value:"PHP",id:"php",level:3},{value:"PHP-FPM",id:"php-fpm",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Nginx",id:"nginx-1",level:3},{value:"\u8A2D\u5B9A FPM",id:"\u8A2D\u5B9A-fpm",level:3},{value:"Start Nginx + PHP",id:"start-nginx--php",level:3},{value:"See Also",id:"see-also",level:2}];function d(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"ubuntu-\u5229\u7528-nginx-\u4F3A\u670D\u5668\u57F7\u884C-php-\u7A0B\u5F0F",children:"[Ubuntu] \u5229\u7528 NGINX \u4F3A\u670D\u5668\u57F7\u884C PHP \u7A0B\u5F0F"})}),"\n",(0,r.jsx)(e.p,{children:"\u9577\u671F\u4EE5\u4F86 Apache Server \u7684\u6548\u80FD\u8207\u627F\u8F09\u6578\u4F4E\u843D, \u52A0\u4E0A\u5C64\u51FA\u4E0D\u7AAE\u7684\u6F0F\u6D1E,\n\u8A31\u591A\u4EBA\u9678\u7E8C\u6295\u5411 Event-based Server \u7684\u61F7\u62B1, \u4F8B\u5982 Nginx."}),"\n",(0,r.jsx)(e.p,{children:"Nginx \u662F\u4E00\u500B\u514D\u8CBB\u958B\u6E90\u4E14\u7A69\u5B9A\u9AD8\u6548\u7684 Web \u4F3A\u670D\u5668\u7A0B\u5F0F, \u64C1\u6709\u53CD\u5411\u4EE3\u7406\u53CA\u8CA0\u8F09\u5E73\u8861\u7684\u529F\u80FD,\n\u85C9\u7531 Non-blocking \u8207 epool \u7684\u7279\u6027, \u5927\u5E45\u63D0\u6607\u4E86\u9023\u7DDA\u670D\u52D9\u91CF\u8207\u901F\u5EA6, \u6210\u70BA\u8FD1\u5E74\u4F86\u6700\u70BA\u5EE3\u6CDB\u904B\u7528\u7684\u9078\u64C7."}),"\n",(0,r.jsx)(e.p,{children:"\u4F46\u662F Nginx \u53EA\u662F\u55AE\u7D14\u7684 HTTP Server, \u5982\u679C\u8981\u57F7\u884C\u7A0B\u5F0F, \u9084\u5F97\u85C9\u52A9 CGI \u7684\u5E6B\u5FD9.\nNginx \u53EF\u4EE5\u900F\u904E FastCGI \u53BB\u57F7\u884C PHP \u7A0B\u5F0F, \u4E14\u5167\u5EFA FastCGI \u5FEB\u53D6\u529F\u80FD.\n\u800C\u7B2C\u4E00\u6B65\u9700\u8981\u5BE6\u73FE\u7684\u662F\u5982\u4F55\u8B93 Nginx \u6B63\u78BA\u7684\u547C\u53EB PHP."}),"\n",(0,r.jsx)(e.h3,{id:"cgi",children:"CGI"}),"\n",(0,r.jsx)(e.p,{children:"CGI (Common Gateway Interface) \u662F\u7528\u65BC\u7DB2\u9801\u4F3A\u670D\u5668\u7684\u4ECB\u9762\u6A19\u6E96,\n\u652F\u63F4 CGI \u7684\u7DB2\u9801\u4F3A\u670D\u5668\u6703\u5C07\u5176\u6240\u63A5\u6536\u5230\u7684 HTTP \u8ACB\u6C42\u7684\u5167\u5BB9\u8A2D\u6210\u74B0\u5883\u8B8A\u6578,\n\u4F5C\u70BA\u67D0\u652F\u7A0B\u5F0F\u6642\u7684\u74B0\u5883\u8B8A\u6578\u4EE5\u53CA\u6A19\u6E96\u8F38\u5165 (stdin) \u8F38\u5165\u7684\u8CC7\u6599.\n\u800C\u8A72\u7A0B\u5F0F\u6A19\u6E96\u8F38\u51FA (stdout) \u7684\u8CC7\u6599\u5247\u6703\u88AB\u7DB2\u9801\u4F3A\u670D\u5668\u62FF\u4F86\u56DE\u61C9\u7D66\u5BA2\u6236\u7AEF."}),"\n",(0,r.jsx)(e.p,{children:"\u7DB2\u9801\u4F3A\u670D\u5668\u6BCF\u6B21\u4F7F\u7528 CGI \u57F7\u884C\u7A0B\u5F0F\u6642, \u90FD\u9700\u8981\u5EFA\u7ACB\u51FA\u65B0\u7684\u884C\u7A0B (fork process),\n\u5C31\u50CF\u5728\u7D42\u7AEF\u6A5F\u76F4\u63A5\u7528\u6A94\u6848\u8DEF\u5F91\u53BB\u57F7\u884C\u67D0\u652F\u7A0B\u5F0F.\n\u53EF\u60F3\u800C\u77E5, \u9019\u6A23\u7684\u65B9\u5F0F\u5728\u61C9\u4ED8\u591A\u500B HTTP \u8ACB\u6C42\u6642\u662F\u6C92\u6709\u6548\u7387\u7684\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"fastcgi",children:"FastCGI"}),"\n",(0,r.jsx)(e.p,{children:"FastCGI \u5247\u662F\u5728\u7DB2\u9801\u4F3A\u670D\u5668\u548C CGI\u7A0B\u5F0F\u4E4B\u9593\u518D\u52A0\u4E00\u500B\u7BA1\u7406\u54E1."}),"\n",(0,r.jsx)(e.p,{children:"\u7DB2\u9801\u4F3A\u670D\u5668\u8981\u628A HTTP \u8ACB\u6C42\u4EA4\u7D66\u7BA1\u7406\u54E1\u8655\u7406, \u7BA1\u7406\u54E1\u8CA0\u8CAC\u5206\u914D CGI \u7A0B\u5F0F\u7684\u57F7\u884C\u8CC7\u6E90,\n\u4F7F\u7CFB\u7D71\u4E0D\u6703\u6BCF\u6B21\u9047\u5230\u8ACB\u6C42\u5C31\u958B\u4E00\u500B\u884C\u7A0B\u53BB\u8DD1 CGI \u7A0B\u5F0F, \u4EE5\u6539\u5584\u904B\u4F5C\u6548\u7387."}),"\n",(0,r.jsx)(e.h3,{id:"fpmfastcgi-process-manager",children:"FPM(FastCGI Process Manager)"}),"\n",(0,r.jsx)(e.p,{children:"FPM(php-fpm) \u662F PHP \u76EE\u524D\u7684 FastCGI \u5BE6\u4F5C."}),"\n",(0,r.jsx)(e.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(e.h3,{id:"nginx",children:"Nginx"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728 Ubuntu \u4E0A\u5B89\u88DD Nginx \u548C\u5B89\u88DD\u5176\u4ED6\u8EDF\u9AD4\u4E00\u6A23, \u76F4\u63A5\u900F\u904E ",(0,r.jsx)(e.code,{children:"apt"})," \u5B89\u88DD\u5373\u53EF."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo apt install nginx\n"})}),"\n",(0,r.jsx)(e.p,{children:"Nginx \u9810\u8A2D\u6703\u555F\u7528 HTTP, \u4F54\u7528 TCP \u9023\u63A5\u57E0\u70BA HTTP \u9810\u8A2D\u7684 80.\n\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u6307\u4EE4\u4F86\u67E5\u770B Nginx \u662F\u5426\u6709\u78BA\u5BE6\u5B89\u88DD\u6210\u529F."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo netstat -tlnp | grep nginx\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.img,{src:"https://lh3.googleusercontent.com/pw/ACtC-3dV-nWgkfyACFUd4j0DDN0tmvWuOrhO8zprZsVWg7MbXfwzDYPOzYQtdvB0cqqPozf_-yzMW55AfkWGDc0sbFfm19rltX5FBkYcCP-qZ4T2JCl5auRbEaftoxXWyAKw5p4oIaCCGdpZGFuLr-vAcpO0Gg=w1214-h130-no?authuser=0",alt:""}),"\n\u5982\u4E0A\u5716, \u5982\u679C\u6709\u770B\u5230\u9023\u63A5\u57E0 80 \u6709\u88AB\u76E3\u807D, \u5C31\u8868\u793A Nginx \u5B89\u88DD\u6210\u529F."]}),"\n",(0,r.jsxs)(e.p,{children:["Nginx \u6240\u4EE5\u76E3\u807D\u4EFB\u610F\u7DB2\u8DEF\u4ECB\u9762\u4E0A\u7684 80 \u9023\u63A5\u57E0, \u662F\u56E0\u70BA\u9810\u8A2D\u7684\u8A2D\u5B9A\u6A94 ",(0,r.jsx)(e.code,{children:"(/etc/nginx/sites-available/default)"})," \u4E2D,\n\u6709\u8A2D\u4E00\u500B\u6703\u53BB\u76E3\u807D\u4EFB\u610F\u7DB2\u8DEF\u4ECB\u9762, \u4E14\u9023\u63A5\u57E0\u70BA 80 \u7684 ",(0,r.jsx)(e.strong,{children:"\u865B\u64EC\u4E3B\u6A5F (Virtual Host)"}),".\n\u6709\u95DC\u65BC Nginx \u9032\u4E00\u6B65\u7684\u8A2D\u5B9A\u8207\u914D\u7F6E\u8AAA\u660E, \u53EF\u4EE5\u53C3\u8003\n",(0,r.jsx)(e.a,{href:"https://magiclen.org/ubuntu-server-nginx/",children:"\u4F7F\u7528Ubuntu Server\u67B6\u8A2DNginx\u4F3A\u670D\u5668 | MagicLen"})]}),"\n",(0,r.jsx)(e.h3,{id:"php",children:"PHP"}),"\n",(0,r.jsx)(e.p,{children:"PHP \u662F\u8173\u672C\u5F0F\u7A0B\u5F0F\u8A9E\u8A00, \u9700\u8981\u6709 PHP \u57F7\u884C\u74B0\u5883\u624D\u53EF\u4EE5\u88AB\u57F7\u884C."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo apt install php-cli\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u5B89\u88DD\u5B8C ",(0,r.jsx)(e.code,{children:"php-cli"})," \u5957\u4EF6\u5F8C, \u53EF\u4EE5\u4F7F\u7528 ",(0,r.jsx)(e.code,{children:"php"})," \u6307\u4EE4\u4F86\u57F7\u884C PHP \u7A0B\u5F0F."]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u67E5\u770B PHP \u7684\u7248\u672C:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ php -v\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://lh3.googleusercontent.com/pw/ACtC-3eYw_TsLcSEZ9pglabIbB0nJqs0KKJNq9y9qjjhZgWAAxpQ2LdxFH0eGKnc1Tjsr9h_0lDQhgYKvfGp0XSovF8ZsNVLA5IOJHWxZvjL1M_5YZWlbORRURJDRo7LkpWc-r9QB18sx9aYqDVEoF0Qms0jnQ=w802-h172-no?authuser=0",alt:""})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u57F7\u884C PHP \u7A0B\u5F0F:\n",(0,r.jsx)(e.img,{src:"https://lh3.googleusercontent.com/pw/ACtC-3eOPeyqs8L6qvl7AxoPmInMY2pLWaoHAys9miug_nA6ACVhHqGbeHiBduAsPlWu_Rtb7iL-q4fM_2v25jmURV33rzqQvaxCRDHhshKE3RLSNlDAV8ESb4iy59NV7sbosIDFrpnSU7u3rHyNBK_Mktb50w=w784-h326-no?authuser=0",alt:""})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"php"})," \u8A2D\u5B9A\u6A94\u7684\u8DEF\u5F91\u662F ",(0,r.jsx)(e.code,{children:"/etc/php/<PHP\u7248\u672C\u865F\u78BC>/cli/php.ini"}),",\n\u8A73\u7D30\u8A2D\u5B9A\u8AAA\u660E\u53EF\u53C3\u8003\u5B98\u65B9\u6587\u4EF6\u6216 ",(0,r.jsx)(e.a,{href:"https://magiclen.org/ubuntu-server-nginx-php/",children:"\u4F7F\u7528Ubuntu Server\u900F\u904ENginx\u4F3A\u670D\u5668\u57F7\u884CPHP\u7A0B\u5F0F | MagicLen"}),"."]}),"\n",(0,r.jsx)(e.h3,{id:"php-fpm",children:"PHP-FPM"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo apt install php-fpm\n"})}),"\n",(0,r.jsxs)(e.p,{children:["FPM \u9810\u8A2D\u53EA\u6703\u76E3\u807D Unix Domain Socket(UDS\uFF0C\u6216\u7A31 IPC Socket), UDS \u6A94\u6848\u8DEF\u5F91\u70BA ",(0,r.jsx)(e.code,{children:"/run/php/php<PHP\u7248\u672C\u865F\u78BC>-fpm.sock"}),".\n\u4F8B\u5982 PHP 7.4 UDS \u6A94\u6848\u8DEF\u5F91\u5C31\u662F ",(0,r.jsx)(e.code,{children:"/run/php/php7.4-fpm.sock"}),"."]}),"\n",(0,r.jsxs)(e.p,{children:["\u5982\u679C\u8981\u78BA\u8A8D FPM \u6709\u6C92\u6709\u5B89\u88DD\u4E26\u555F\u7528\u6210\u529F, \u53EF\u4EE5\u5229\u7528 ",(0,r.jsx)(e.code,{children:"socat"})," \u9019\u500B\u6307\u4EE4\u5DE5\u5177\u4F86\u9032\u884C.\n\u5B89\u88DD socat\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo apt install socat\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u57F7\u884C\u4EE5\u4E0B\u6307\u4EE4\u4F86\u5224\u65B7 FPM \u662F\u5426\u6B63\u5E38\u5DE5\u4F5C:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'$ echo /dev/null | sudo socat unix:/var/run/php/php-fpm.sock - && echo "Working!" || echo "Not working!"\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://lh3.googleusercontent.com/pw/ACtC-3fQR-dRGQoBBDsbMbaJLBMuWu4qRTgsg6AVJaQ8nxsL1268iPR1UTrC3-4EhX8IQee8-v0rWO_ZAhvMja7kwfLB0UcnMwu24oRcChfdJ2FkzNWfe7vxR2p9EIZtf5c5WqaeD7X-PzxQGewrE7qp8A7bXw=w928-h128-no?authuser=0",alt:""})}),"\n",(0,r.jsx)(e.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(e.h3,{id:"nginx-1",children:"Nginx"}),"\n",(0,r.jsx)(e.p,{children:"\u9806\u5229\u5B89\u88DD\u5B8C\u4E4B\u5F8C\u958B\u59CB\u4FEE\u6539 Nginx Server \u8A2D\u5B9A\u6A94, \u5982\u4E0B:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo vim /etc/nginx/nginx.conf\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"user www-data;\nworker_processes auto;\npid /run/nginx.pid;\ninclude /etc/nginx/modules-enabled/*.conf;\n\nevents {\n    use epoll;\n    worker_connections 2048;\n}\n\nhttp {\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout 65;\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE\n    ssl_prefer_server_ciphers on;\n\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log;\n\n    gzip on;\n\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5E7E\u500B\u91CD\u8981\u7684\u53C3\u6578:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"user"}),": Nginx Server \u555F\u52D5\u6240\u4F7F\u7528\u7684\u4F7F\u7528\u8005 (ubuntu \u9810\u8A2D\u7528 www-data)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"pid"}),": ProcessID \u5B58\u653E\u4F4D\u7F6E ( ubuntu \u9810\u8A2D\u5728 /run/nginx.pid)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"worker_processes"}),": \u958B\u555F\u7684\u7A0B\u5E8F\u6578\u91CF, \u8ACB\u5C0D\u61C9 CPU \u6838\u5FC3\u6578\u9032\u884C\u8ABF\u6574, \u6216\u7DAD\u6301\u9810\u8A2D\u7684 auto"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"use epoll"}),": \u555F\u52D5 epoll \u6703\u5FEB\u5F88\u591A\uFF0C\u6548\u679C\u4E0D\u932F"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"worker_connections"}),": \u6BCF\u500B\u7A0B\u5E8F\u6700\u9AD8\u53EF\u4EE5\u958B\u555F\u7684\u9023\u7DDA\u6578"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"server_tokens off"}),": \u79FB\u9664 Nginx \u7248\u672C\u8CC7\u8A0A"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"access_log, error_log"}),": HTTP Log \u5B58\u653E\u7684\u4F4D\u7F6E"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4E0A\u9762\u662F Ngnix Server \u6574\u9AD4\u7684\u8A2D\u5B9A, \u63A5\u4E0B\u4F86\u8981\u9032\u884C Virtual Host \u914D\u7F6E."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo vim /etc/nginx/sites-available/default\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"server {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/html;\n\n    # Add index.php to the list if you are using PHP\n    index index.html index.htm index.php index.nginx-debian.html;\n\n    server_name _;\n\n    # set expiration of assets to MAX for caching\n    location ~* \\.(ico|css|js|gif|jpe?g|png|ogg|ogv|svg|svgz|eot|otf|woff)(\\?.+)?$ {\n        expires max;\n        log_not_found off;\n    }\n\n    # framework rewrite\n    location / {\n        try_files $uri $uri/ /index.php =404;\n    }\n\n    # pass PHP scripts to FastCGI server\n    location ~* \\.php$ {\n        #include snippets/fastcgi-php.conf;\n        fastcgi_pass 127.0.0.1:9000;\n        fastcgi_index index.php;\n        fastcgi_split_path_info ^(.+\\.php)(.*)$;\n        include fastcgi_params;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5E7E\u500B\u53C3\u6578\u8A2D\u5B9A\u8AAA\u660E:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"server_name"}),": \u540C Apache ServerName \u53EF\u4EE5\u7528\u4F86\u6307\u5B9A Virtual Host (\u865B\u64EC\u4E3B\u6A5F)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"root"}),": \u7DB2\u9801\u6240\u64FA\u653E\u7684\u4F4D\u7F6E"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"location /"})," Selection (framework rewrite):\n\u7528 ",(0,r.jsx)(e.code,{children:"try_files $uri $uri/ /index.php;"})," \u4F86\u5617\u8A66\u8B80\u53D6\u958B\u555F.\n\u5982\u679C\u6A94\u6848\u4E0D\u5B58\u5728\u5C31\u8F49\u70BA\u547C\u53EB index.php.\n\u505A\u7684\u4E8B\u60C5\u8207\u5E38\u7528\u7684 Apache Rewrite Module \u5DEE\u4E0D\u591A.\n\u4E3B\u8981\u662F\u70BA\u4E86\u5C07 Request \u5C0E\u7D66 Framework (\u5982 Codeigniter, Zend Framework \u7B49\u7B49),\n\u82E5\u6C92\u6709\u4F7F\u7528 PHP Framwwork, \u53EF\u4EE5\u7121\u9808\u8A2D\u5B9A."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"location ~ .php$"})," Selection (pass PHP scripts to FastCGI server):\n\u8A2D\u5B9A\u8981\u5C07 ",(0,r.jsx)(e.code,{children:".php"})," \u6A94\u6848\u76F4\u63A5\u4EA4\u7531 FPM \u4F86\u8655\u7406.\n\u8A73\u7D30\u7684\u8A2D\u5B9A\u8AAA\u660E\u53EF\u4EE5\u53C3\u8003 ",(0,r.jsx)(e.a,{href:"https://www.nginx.com/resources/wiki/",children:"Nginx WIKI"}),".\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"fastcgi_pass"})," \u6307\u5411 PHP-FPM \u958B\u555F\u7684\u670D\u52D9\u4F4D\u7F6E, \u9700\u548C\u5F8C\u9762\u7684 PHP-FPM \u8A2D\u5B9A\u76F8\u540C,"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u8A2D\u5B9A-fpm",children:"\u8A2D\u5B9A FPM"}),"\n",(0,r.jsxs)(e.p,{children:["FPM \u8A2D\u5B9A\u6A94\u653E\u7F6E\u65BC ",(0,r.jsx)(e.code,{children:"/etc/php/<PHP\u7248\u672C\u865F\u78BC>/fpm/"})," \u76EE\u9304\u4E0B,\n\u4F8B\u5982 PHP 7.4 \u5C31\u662F\u5728 ",(0,r.jsx)(e.code,{children:"/etc/php/7.4/fpm/"})," \u76EE\u9304."]}),"\n",(0,r.jsxs)(e.p,{children:["FPM \u8A2D\u5B9A\u6A94\u76EE\u9304\u4E2D\u6709\u500B ",(0,r.jsx)(e.code,{children:"pool.d"})," \u76EE\u9304, \u7528\u4F86\u653E\u7F6E\u6BCF\u500B\u300C\u6C60\u300D (Pool) \u7684\u8A2D\u5B9A\u6A94.\n\u4E00\u500B\u6C60\u5C31\u662F\u4E00\u500B FastCGI \u7684\u7BA1\u7406\u5340\u57DF (\u6216\u8005\u8AAA\u7BA1\u7406\u54E1).\n\u9810\u8A2D\u70BA ",(0,r.jsx)(e.code,{children:"www"})," \u6C60, \u8A2D\u5B9A\u6A94\u6A94\u540D\u70BA ",(0,r.jsx)(e.code,{children:"www.conf"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo vim /etc/php/7.4/fpm/pool.d/www.conf\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"[www]\nuser = www-data\ngroup = www-data\n \nlisten = 127.0.0.1:9000\nlisten.backlog = 65535\nlisten.owner = www-data\nlisten.group = www-data\n \nrequest_terminate_timeout = 600s\n \npm = dynamic\npm.max_children = 5\npm.start_servers = 2\npm.min_spare_servers = 1\npm.max_spare_servers = 3\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"listen"}),": \u8A2D\u5B9A\u5F9E\u54EA\u500B\u5730\u65B9\u63A5\u6536 Nginx fastcgi_pass \u8ACB\u6C42, \u8981\u548C\u524D\u9762 Nginx \u7684\u8A2D\u5B9A\u76F8\u540C.\n\u9810\u8A2D\u662F ",(0,r.jsx)(e.code,{children:"/run/php/php<PHP\u7248\u672C\u865F\u78BC>-fpm.sock"}),".\nPHP-FPM \u53EF\u4EE5\u900F\u904E TCP Socket \u6216\u8005\u662F UNIX Kernel Socket.\nKernel Socket \u901F\u5EA6\u6703\u6BD4\u8F03\u5FEB, \u4F46\u662F\u7D93\u904E\u58D3\u529B\u6E2C\u8A66\u5F8C Kernel Socket \u53CD\u800C\u5E38\u5E38\u6389\u5305,\n\u7A69\u5B9A\u6027\u4E0D\u5982 TCP Socket \u4F86\u7684\u512A\u7570. \u6545\u9019\u908A\u8A2D\u70BA\u672C\u5730\u7AEF\u7684 TCP Socket."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"request_terminate_timeout"}),": \u8A2D\u5B9A\u8868\u793A PHP \u7684\u57F7\u884C\u6642\u9593, \u8D85\u904E\u9019\u500B\u9031\u671F\u5C31\u6703\u7D50\u675F.\n\u8A2D\u592A\u77ED\u5BB9\u6613\u9047\u5230\u6A94\u6848\u4E0A\u50B3\u6642\u9593\u6BD4\u8F03\u4E45\u5C31 GG \u4E86."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"pm"}),": \u8A2D\u5B9A\u5B50\u884C\u7A0B\u7684\u6578\u91CF\u8981\u56FA\u5B9A\u9084\u662F\u6D6E\u52D5.\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"static \u662F\u56FA\u5B9A\u70BA\u6700\u5927\u6578\u91CF(pm.max_children)."}),"\n",(0,r.jsx)(e.li,{children:"dynamic \u662F\u52D5\u614B\u8ABF\u6574, \u9810\u8A2D\u662F dynamic."}),"\n",(0,r.jsx)(e.li,{children:"ondemand \u662F\u884C\u7A0B\u958B\u5B8C\u5C31\u95DC."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"pm.max_children"}),": \u8A2D\u5B9A\u5B50\u884C\u7A0B\u7684\u6700\u5927\u6578\u91CF, \u9810\u8A2D\u662F5.\n\u9019\u500B\u6578\u91CF\u5EFA\u8B70\u8A2D\u70BA\u8655\u7406\u5668\u7684\u6578\u91CF\u518D\u6839\u64DA\u6BCF\u500B\u5B50\u884C\u7A0B\u7684\u8A18\u61B6\u9AD4\u7528\u91CF\u4E58\u4E0A\u67D0\u500B\u500D\u6578 (\u4F8B\u5982\u8A18\u61B6\u9AD4\u5269\u5F97\u5C11\u5C31\u4E582\uFF0C\u8A18\u61B6\u9AD4\u5269\u5F97\u591A\u5C31\u4E584)."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"start-nginx--php",children:"Start Nginx + PHP"}),"\n",(0,r.jsx)(e.p,{children:"\u6700\u5F8C\u555F\u52D5 Nginx \u8207 PHP-FPM \u670D\u52D9:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"$ sudo service php7.4-fpm restart\n$ sudo service nginx restart\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u958B\u555F\u700F\u89BD\u5668\u8A66\u770B\u770B, Ubuntu \u88DD\u8D77\u4F86\u7684 Nginx Welcome \u756B\u9762\u5982\u4E0B\uFF1A"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://lh3.googleusercontent.com/pw/ACtC-3euV0DG5x_6NEszyLYrW1cW8cFj6p7qapfHbldw0am_PCAEX3lYENsxrPIBCA4gCCt37f-GBJv5Gs6138SYf8sf4l_wmKGbv1HbnmUH-q8uUWMHCnZ7cylYvCLxiXSwrzIgQ3K2EgX8Ido8J0jd0ZTbLw=w1088-h508-no?authuser=0",alt:""})}),"\n",(0,r.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsx)(e.p,{children:"\u6574\u9AD4\u4F86\u8AAA Nginx \u5B89\u88DD\u883B\u5BB9\u6613\u7684, \u4F46\u8981\u8ABF\u6821\u7684\u597D\u53C8\u662F\u53E6\u5916\u4E00\u4EF6\u4E8B.\n\u8A2D\u5B9A\u7684\u4E0D\u6D3D\u7576, \u5728\u9AD8\u6D41\u91CF\u6642 Nginx \u5E38\u6703\u9001\u4F60 502 Bad Gateway."}),"\n",(0,r.jsx)(e.p,{children:"\u53C8\u4F8B\u5982 Nginx \u53EF\u4EE5\u5C07 FastCGI \u670D\u52D9\u56DE\u61C9\u7684\u8CC7\u6599\u5FEB\u53D6\u6210\u6A94\u6848,\n\u9019\u6A23\u4E0B\u6B21\u5982\u679C\u53C8\u6709\u4E00\u6A23\u7684\u8ACB\u6C42\uFF0CNginx \u5C31\u76F4\u63A5\u5F9E\u6A94\u6848\u7CFB\u7D71\u4E2D\u6488\u51FA\u4F86\u56DE\u61C9\uFF0C\n\u4E0D\u5FC5\u518D\u8F49\u9001\u7D66 FastCGI \u670D\u52D9\u8655\u7406, \u53EF\u52A0\u5FEB\u53CD\u61C9.\nCache \u7684\u8A2D\u7F6E\u76F8\u7576\u8003\u9A57 SRE \u5C0D PHP \u670D\u52D9\u4E86\u89E3\u7A0B\u5EA6, \u4E26\u975E\u6240\u6709\u670D\u52D9\u90FD\u9069\u5408\u958B\u8A2D Cache.\n\u9019\u53E6\u7BC7\u518D\u8A0E\u8AD6\u4E86."}),"\n",(0,r.jsx)(e.p,{children:"\u9700\u8981\u82B1\u883B\u591A\u6642\u9593\u5617\u8A66\u8ABF\u6574\u53C3\u6578, \u642D\u914D\u6548\u80FD\u6E2C\u8A66\u5DE5\u5177\u4F86\u6AA2\u67E5, \u8B93\u4F3A\u670D\u5668\u767C\u63EE\u6700\u5927\u6548\u7528."}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://magiclen.org/ubuntu-server-nginx-php/",children:"\u4F7F\u7528Ubuntu Server\u900F\u904ENginx\u4F3A\u670D\u5668\u57F7\u884CPHP\u7A0B\u5F0F | MagicLen"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://blog.toright.com/posts/3890/%E7%84%A1%E5%A0%85%E4%B8%8D%E6%91%A7%EF%BC%8C%E5%94%AF%E5%BF%AB%E4%B8%8D%E7%A0%B4%EF%BC%81%E5%BF%AB%E6%94%B9%E7%94%A8-nginx-php-fpm-%E5%8F%96%E4%BB%A3-apache-%E5%90%A7%EF%BC%81.html",children:"\u7121\u5805\u4E0D\u6467\uFF0C\u552F\u5FEB\u4E0D\u7834\uFF01\u5FEB\u6539\u7528 Nginx + PHP-FPM \u53D6\u4EE3 Apache \u5427\uFF01 - Soul & Shell Blog"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://xenby.com/b/137-%E6%95%99%E5%AD%B8-%E5%AE%89%E8%A3%9Dlemplinuxnginxmysqlphp%E7%92%B0%E5%A2%83",children:"[\u6559\u5B78] \u5B89\u88DDLEMP(Linux+Nginx+Mysql+PHP)\u74B0\u5883 | \u8F9B\u6BD4\u8A8C"})}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},50065:function(n,e,s){s.d(e,{Z:function(){return t},a:function(){return c}});var i=s(67294);let r={},l=i.createContext(r);function c(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);