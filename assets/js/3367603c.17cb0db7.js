"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["5899"],{73023:function(n,e,l){l.r(e),l.d(e,{metadata:()=>i,contentTitle:()=>o,default:()=>d,assets:()=>h,toc:()=>t,frontMatter:()=>r});var i=JSON.parse('{"id":"golang/go-tour/go-tour_channel","title":"Goroutine / Channel","description":"Goroutine / Channel","source":"@site/moco/golang/go-tour/go-tour_channel.md","sourceDirName":"golang/go-tour","slug":"/golang/go-tour/go-tour_channel","permalink":"/moco/golang/go-tour/go-tour_channel","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Go","permalink":"/moco/tags/go"},{"inline":true,"label":"Go/GoTour","permalink":"/moco/tags/go-go-tour"}],"version":"current","frontMatter":{"title":"Goroutine / Channel","description":"Goroutine / Channel","tags":["Go","Go/GoTour"],"date_created":"2022-04-21T04:03:41.000Z","cover":"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},"sidebar":"tutorialSidebar","previous":{"title":"A Tour of Go","permalink":"/moco/category/a-tour-of-go"},"next":{"title":"Closure","permalink":"/moco/golang/go-tour/go-tour_closure"}}'),c=l("85893"),a=l("50065");let r={title:"Goroutine / Channel",description:"Goroutine / Channel",tags:["Go","Go/GoTour"],date_created:new Date("2022-04-21T04:03:41.000Z"),cover:"https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"},o="[Go] Tour: Goroutine \u548C Channel \u5FC3\u5F97\u7B46\u8A18",h={},t=[{value:"Channel \u4ECB\u7D39",id:"channel-\u4ECB\u7D39",level:2},{value:"Channel \u7684\u963B\u585E",id:"channel-\u7684\u963B\u585E",level:3},{value:"\u5BEB\u5165\u8CC7\u6599\u5230 Channel \u6642\u7684\u7B49\u5F85\u60C5\u5883",id:"\u5BEB\u5165\u8CC7\u6599\u5230-channel-\u6642\u7684\u7B49\u5F85\u60C5\u5883",level:3},{value:"\u5F9E Channel \u8B80\u53D6\u8CC7\u6599\u6642\u7684\u7B49\u5F85\u60C5\u5883",id:"\u5F9E-channel-\u8B80\u53D6\u8CC7\u6599\u6642\u7684\u7B49\u5F85\u60C5\u5883",level:3},{value:"Unbuffered Channel",id:"unbuffered-channel",level:3},{value:"Buffered Channel",id:"buffered-channel",level:2},{value:"Buffer size",id:"buffer-size",level:3},{value:"Close channel",id:"close-channel",level:2},{value:"\u4F7F\u7528 range \u5DE1\u8A2A channel",id:"\u4F7F\u7528-range-\u5DE1\u8A2A-channel",level:3},{value:"Select",id:"select",level:2},{value:"\u5C0F\u7D50",id:"\u5C0F\u7D50",level:2},{value:"See Also",id:"see-also",level:2}];function s(n){let e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"go-tour-goroutine-\u548C-channel-\u5FC3\u5F97\u7B46\u8A18",children:"[Go] Tour: Goroutine \u548C Channel \u5FC3\u5F97\u7B46\u8A18"})}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.a,{href:"/moco/golang/go-tour/go-tour_goroutine",children:(0,c.jsx)(e.em,{children:"\u627F: Go: Goroutine \u5FC3\u5F97\u7B46\u8A18"})})}),"\n",(0,c.jsx)(e.h2,{id:"channel-\u4ECB\u7D39",children:"Channel \u4ECB\u7D39"}),"\n",(0,c.jsx)(e.p,{children:"\u524D\u7BC7\u85C9\u7531\u5169\u500B\u5728\u591A\u57F7\u884C\u7DD2\u4E2D\u91CD\u8981\u7684\u8B70\u984C: \u7B49\u5F85\u53CA\u8B8A\u6578\u5171\u4EAB, \u5E36\u51FA Channel \u5F37\u5927\u7684\u8655\u7406\u80FD\u529B, \u63A5\u8457\u6DF1\u5165\u4E86\u89E3 Channel."}),"\n",(0,c.jsx)(e.p,{children:"Channel \u53EF\u4EE5\u60F3\u6210\u4E00\u689D\u7BA1\u7DDA, \u9019\u689D\u7BA1\u7DDA\u53EF\u4EE5\u5BEB\u5165\u6578\u503C, \u4E5F\u53EF\u4EE5\u5C07\u6578\u503C\u8B80\u53D6\u51FA\u4F86."}),"\n",(0,c.jsx)(e.p,{children:"\u5EFA\u7ACB Channel"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"ch := make(chan int) // \u5EFA\u7ACB int \u578B\u5225\u7684 Channel\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u63A8\u5165 / \u62C9\u51FA Channel \u5167\u7684\u503C, \u4F7F\u7528 ",(0,c.jsx)(e.code,{children:"<-"})," \u7BAD\u982D\u904B\u7B97\u5B50:"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["Channel \u5728 ",(0,c.jsx)(e.code,{children:"<-"})," \u5DE6\u908A\uFF1A\u5C07\u7BAD\u982D\u53F3\u908A\u7684\u6578\u503C\u63A8\u5165 Channel \u4E2D"]}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"ch <- v    // Send v to channel ch.\nv := <-ch  // Receive from ch, and assign value to v.\n"})}),"\n",(0,c.jsx)(e.h3,{id:"channel-\u7684\u963B\u585E",children:"Channel \u7684\u963B\u585E"}),"\n",(0,c.jsxs)(e.p,{children:["Channel \u6703\u7B49\u5F85\u81F3\u53E6\u4E00\u7AEF\u5B8C\u6210\u63A8\u5165 / \u62C9\u51FA\u7684\u52D5\u4F5C\u5F8C\u624D\u6703\u7E7C\u7E8C\u5F80\u4E0B\u8655\u7406,\n\u9019\u6A23\u7684\u7279\u6027\u4F7F\u5176\u53EF\u4EE5\u5728 Goroutines \u9593\u540C\u6B65\u7684\u8655\u7406\u8CC7\u6599, \u53EF\u4EE5\u4E0D\u4F7F\u7528\u660E\u78BA\u7684 ",(0,c.jsx)(e.code,{children:"mutex.Lock"}),", ",(0,c.jsx)(e.code,{children:"mutex.Unlock"})," \u7B49\u65B9\u6CD5."]}),"\n",(0,c.jsx)(e.p,{children:"\u800C Channel \u4EC0\u9EBC\u60C5\u6CC1\u4E0B\u6703\u963B\u585E\u5462?\n\u4E00\u822C\u4F86\u8AAA, Goroutine \u4F7F\u7528 Channel \u6642\u6709\u5169\u7A2E\u60C5\u6CC1\u6703\u9020\u6210\u963B\u585E:"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u5C07\u8CC7\u6599\u5BEB\u5165 Channel \u5F8C,\n\u5BEB\u5165\u8CC7\u6599\u7684 Goroutine \u6703\u7B49\u5F85 Channel \u8CC7\u6599\u88AB\u5176\u4ED6 Goroutine \u62C9\u53D6\u5F8C\u624D\u80FD\u7E7C\u7E8C\u57F7\u884C."}),"\n",(0,c.jsx)(e.li,{children:"\u82E5\u7576 Channel \u4E2D\u6C92\u6709\u8CC7\u6599, \u4F46\u8981\u5F9E\u4E2D\u8B80\u53D6\u6642,\n\u8B80\u53D6\u8CC7\u6599\u7684 Goroutine \u6703\u7B49\u5F85\u5176\u4ED6 Goroutine \u5BEB\u5165\u8CC7\u6599,\n\u4E26\u7B49\u5019\u81EA\u5DF1\u62C9\u53D6\u5B8C\u6210\u624D\u80FD\u5F80\u4E0B\u57F7\u884C."}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u5BEB\u5165\u8CC7\u6599\u5230-channel-\u6642\u7684\u7B49\u5F85\u60C5\u5883",children:"\u5BEB\u5165\u8CC7\u6599\u5230 Channel \u6642\u7684\u7B49\u5F85\u60C5\u5883"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() { // calculate goroutine\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH" // goroutine \u57F7\u884C\u6703\u5728\u6B64\u88AB\u8FEB\u7B49\u5F85\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    time.Sleep(2 * time.Second) // \u4F7F main \u6BD4 goroutine \u6162\n    fmt.Println(<-ch)\n    time.Sleep(time.Second)\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"calculate goroutine starts calculating\ncalculate goroutine ends calculating\nFINISH\ncalculate goroutine finished\nmain goroutine finished\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u6B64\u4F8B\u4F7F\u7528 ",(0,c.jsx)(e.code,{children:"time.Sleep"})," \u5F37\u8FEB main \u57F7\u884C\u6162\u65BC calculate, \u73FE\u5728\u4F86\u89C0\u5BDF\u8F38\u51FA\u7684\u7D50\u679C:"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"calculate \u6703\u5148\u57F7\u884C\u4E26\u4E14\u8A08\u7B97\u5B8C\u6210"}),"\n",(0,c.jsxs)(e.li,{children:["calculate \u5C07 ",(0,c.jsx)(e.code,{children:"FINISH"})," \u8A0A\u865F\u63A8\u5165 Channel"]}),"\n",(0,c.jsxs)(e.li,{children:["\u4F46\u7531\u65BC\u76EE\u524D main \u9084\u672A\u62C9\u53D6 Channel \u4E2D\u7684\u8CC7\u6599, \u6240\u4EE5 calculate \u6703\u88AB\u8FEB\u7B49\u5F85.\n\u56E0\u6B64 calculate \u7684\u6700\u5F8C\u4E00\u884C ",(0,c.jsx)(e.code,{children:'fmt.Println("main goroutine finished")'})," \u6C92\u6709\u99AC\u4E0A\u8F38\u51FA\u5728\u756B\u9762\u4E0A"]}),"\n",(0,c.jsx)(e.li,{children:"main \u62C9\u53D6\u4E86 Channel \u4E2D\u7684\u8CC7\u6599"}),"\n",(0,c.jsxs)(e.li,{children:["calculate \u57F7\u884C ",(0,c.jsx)(e.code,{children:'fmt.Println("main goroutine finished")'})," \u4E26\u7D50\u675F"]}),"\n",(0,c.jsx)(e.li,{children:"main \u57F7\u884C\u5B8C\u6210"}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u5F9E-channel-\u8B80\u53D6\u8CC7\u6599\u6642\u7684\u7B49\u5F85\u60C5\u5883",children:"\u5F9E Channel \u8B80\u53D6\u8CC7\u6599\u6642\u7684\u7B49\u5F85\u60C5\u5883"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() { // calculate goroutine\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH" // goroutine \u57F7\u884C\u6703\u5728\u6B64\u88AB\u8FEB\u7B49\u5F85\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    //time.Sleep(2 * time.Second) // \u4F7F main \u6BD4 goroutine \u6162\n    fmt.Println(<-ch)\n    time.Sleep(time.Second)\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"calculate goroutine starts calculating\ncalculate goroutine ends calculating\ncalculate goroutine finished\nFINISH\nmain goroutine finished\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u9019\u4F8B\u5B50\u4E2D\u628A main \u4E2D\u7684 ",(0,c.jsx)(e.code,{children:"time.Sleep(2 * time.Second)"})," \u8A3B\u89E3\u6389."]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["main \u8B80\u53D6\u8CC7\u6599\u6642, calculate \u9084\u6C92\u5C07\u8CC7\u6599\u63A8\u5165 Channel \u4E2D, main \u9700\u8981\u7B49\u5F85.\n\u56E0\u6B64 main \u7684\u6700\u5F8C\u4E00\u884C ",(0,c.jsx)(e.code,{children:"fmt.println"})," \u6C92\u6709\u99AC\u4E0A\u8F38\u51FA\u5728\u756B\u9762\u4E0A"]}),"\n",(0,c.jsx)(e.li,{children:"calculate \u57F7\u884C\u4E26\u4E14\u8A08\u7B97\u5B8C\u6210"}),"\n",(0,c.jsxs)(e.li,{children:["calculate \u5C07 ",(0,c.jsx)(e.code,{children:"FINISH"})," \u63A8\u5165 Channel"]}),"\n",(0,c.jsx)(e.li,{children:"calculate \u57F7\u884C\u5B8C\u6210"}),"\n",(0,c.jsx)(e.li,{children:"main \u62C9\u53D6\u4E86 Channel \u4E2D\u7684\u8CC7\u6599\u4E26\u4E14\u57F7\u884C\u5B8C\u6210"}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"unbuffered-channel",children:"Unbuffered Channel"}),"\n",(0,c.jsx)(e.p,{children:"\u524D\u9762\u6240\u8AAA\u7684 Channel \u963B\u585E\u60C5\u6CC1\u90FD\u662F\u5C6C\u65BC Unbuffered Channel, \u6B64\u7A2E Channel \u53EA\u8981"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u5BEB\u5165\u4E00\u500B\u8CC7\u6599\u6703\u9020\u6210\u5BEB\u5165\u65B9\u7684\u7B49\u5F85"}),"\n",(0,c.jsx)(e.li,{children:"\u8B80\u53D6\u6642\u6C92\u6709\u8CC7\u6599\u6703\u9020\u6210\u8B80\u53D6\u6642\u7684\u7B49\u5F85"}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"Unbuffered Channel \u7684\u554F\u984C\u662F: \u5982\u679C\u5BEB\u65B9\u57F7\u884C\u6642\u9593\u8F03\u8B80\u53D6\u65B9\u77ED, \u5BEB\u5165\u8CC7\u6599\u5F8C\u6703\u9020\u6210\u5BEB\u5165\u65B9\u88AB\u8FEB\u7B49\u5F85\u8CC7\u6599\u8B80\u53D6\u5F8C\u624D\u80FD\u7E7C\u7E8C\u8655\u7406,\n\u5982\u679C\u5BEB\u5165\u8CC7\u6599\u5F8C\u7E8C\u7684\u7A0B\u5F0F\u7121\u9808\u7B49\u5019\u8CC7\u6599\u88AB\u8B80\u53D6\u53EF\u4EE5\u6B63\u78BA\u57F7\u884C\u57F7\u884C, \u9019\u6A23\u7684\u7B49\u5F85\u662F\u4E0D\u5FC5\u8981\u4E14\u53EF\u4EE5\u88AB\u907F\u514D\u7684."}),"\n",(0,c.jsx)(e.p,{children:"\u70BA\u4E86\u89E3\u6C7A\u5BEB\u5165\u6642\u7B49\u5F85\u554F\u984C, \u53EF\u4EE5\u4F7F\u7528\u53E6\u4E00\u7A2E Channel: Buffered Channel."}),"\n",(0,c.jsx)(e.h2,{id:"buffered-channel",children:"Buffered Channel"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"ch := make(chan int, 100)\n"})}),"\n",(0,c.jsx)(e.p,{children:"Buffered Channel \u7684\u5BA3\u544A\u9700\u5728\u7B2C\u4E8C\u500B\u53C3\u6578\u4E2D\u5B9A\u7FA9 buffer \u7684\u9577\u5EA6,\n\u5B83\u53EA\u6703\u8B93 Buffered \u4E2D\u8CC7\u6599\u586B\u6EFF\u4EE5\u5F8C\u624D\u6703\u963B\u585E\u5BEB\u5165\u9020\u6210\u7B49\u5F85."}),"\n",(0,c.jsx)(e.p,{children:"\u4EE5\u4E0A\u4F8B\u4F86\u8AAA: \u7B2C 101 \u500B\u8CC7\u6599\u63A8\u5165\u7684\u6642\u5019, \u63A8\u5165\u65B9\u7684 Goroutine \u624D\u6703\u7B49\u5F85."}),"\n",(0,c.jsx)(e.p,{children:"\u4E0B\u9762\u4F8B\u5B50\u5206\u5225\u4F7F\u7528 Buffered Channel \u8DDF Unbuffered Channel \u7684\u5DEE\u5225:"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"func main() {\n    ch := make(chan int)\n    ch <- 1 // \u7B49\u5230\u5929\u8352\u5730\u8001\n    fmt.Println(<-ch)\n}\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /tmp/sandbox3906241671/prog.go:11 +0x37\n\nProgram exited.\n"})}),"\n",(0,c.jsx)(e.p,{children:"\u4E0A\u4F8B\u4F7F\u7528 Unbuffered Channel:"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u53EA\u6709\u4E00\u689D Goroutine: main"}),"\n",(0,c.jsx)(e.li,{children:"\u63A8\u5165 1 \u5F8C\u56E0\u70BA\u9084\u6C92\u6709\u5176\u4ED6 Goroutine \u62C9\u53D6 Channel \u4E2D\u7684\u8CC7\u6599, \u6240\u4EE5\u9032\u5165\u963B\u585E\u72C0\u614B."}),"\n",(0,c.jsx)(e.li,{children:"\u56E0\u70BA main \u5DF2\u7D93\u5728\u63A8\u5165\u8CC7\u6599\u6642\u963B\u585E, \u62C9\u53D6\u7684\u7A0B\u5F0F\u6C38\u9060\u4E0D\u6703\u88AB\u57F7\u884C, \u9020\u6210\u6B7B\u7D50."}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"\u5728\u76F8\u540C\u7684\u60C5\u6CC1\u4E0B\uFF0CBuffered Channel \u4E26\u4E0D\u6703\u88AB\u963B\u585E\uFF1A"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-GO",children:"func main() {\n    ch := make(chan int, 1)\n    ch <- 1\n    fmt.Println(<-ch)\n}\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"1\n"})}),"\n",(0,c.jsx)(e.p,{children:"\u539F\u56E0\u662F:"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u63A8\u5165 1 \u5F8C Channel \u5167\u7684\u8CC7\u6599\u6578\u70BA1\u4E26\u6C92\u6709\u8D85\u904E Buffer \u7684\u9577\u5EA61, \u6240\u4EE5\u4E0D\u6703\u88AB\u963B\u585E."}),"\n",(0,c.jsx)(e.li,{children:"\u56E0\u70BA\u6C92\u6709\u963B\u585E, \u4E0B\u4E00\u884C\u62C9\u53D6\u7684\u7A0B\u5F0F\u78BC\u53EF\u4EE5\u88AB\u57F7\u884C, \u4E26\u5B8C\u6210\u57F7\u884C."}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"buffer-size",children:"Buffer size"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"func main() {\n    ch := make(chan int, 5)\n    for i:=0 ; i < 6; i++ {\n        ch <- i\n        fmt.Println(i)\n    }\n    fmt.Println('FINISH')\n}\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"0\n1\n2\n3\n4\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u5EFA\u7ACB\u4E00\u500B Buffer \u9577\u5EA6 5 \u7B46\u8CC7\u6599\u7684 Channel"}),"\n",(0,c.jsx)(e.li,{children:"\u5BEB\u5165\u524D\u4E94\u7B46\u8CC7\u6599\u6642\u4E0D\u6703\u963B\u585E,\n\u5BEB\u5165\u7B2C\u516D\u7B46\u8CC7\u6599\u6642, \u56E0 Buffer \u5DF2\u6EFF, \u9020\u6210\u5BEB\u5165\u8CC7\u6599\u963B\u585E."}),"\n",(0,c.jsx)(e.li,{children:"\u56E0\u6C92\u6709\u5176\u4ED6 Goroutine \u5728\u57F7\u884C, \u6240\u4EE5\u5BEB\u5165\u963B\u585E\u9020\u6210 deadlock. \u7A0B\u5F0F\u932F\u8AA4."}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan int, 5)\n    go func() {\n        fmt.Println("Read data Goroutine")\n        fmt.Println("Read i:", <-ch)\n    }()\n    for i := 0; i < 6; i++ {\n        ch <- i\n        fmt.Println(i)\n    }\n    fmt.Println("FINISH. current first data on buffer is: ", <- ch)\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"0\n1\n2\n3\n4\nRead data Goroutine\nRead i: 0\n5\nFINISH. current first data on buffer is:  1\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u627F\u524D\u4F8B. \u5BEB\u5165\u524D\u4E94\u7B46\u8CC7\u6599\u6642\u4E0D\u6703\u963B\u585E, \u800C\u5BEB\u5165\u7B2C\u516D\u7B46\u8CC7\u6599\u6642\u9020\u6210 main \u963B\u585E."}),"\n",(0,c.jsx)(e.li,{children:"\u7A0B\u5F0F\u57F7\u884C\u8B80\u53D6\u8CC7\u6599\u7684 Goroutine. Buffer \u7B2C\u4E00\u7B46\u8CC7\u6599\u88AB\u62C9\u53D6,\n\u6240\u4EE5 Buffer \u7A7A\u51FA\u4E00\u7B46\u8CC7\u6599\u53EF\u4EE5\u63A8\u5165."}),"\n",(0,c.jsxs)(e.li,{children:["main \u63A8\u5165\u7B2C\u516D\u7B46\u8CC7\u6599, \u7A0B\u5F0F\u6B63\u78BA\u7D50\u675F. \u6B64\u6642 Channel \u7B2C\u4E00\u7B46\u8CC7\u6599\u70BA ",(0,c.jsx)(e.code,{children:"1"})]}),"\n"]}),"\n",(0,c.jsx)(e.h2,{id:"close-channel",children:"Close channel"}),"\n",(0,c.jsx)(e.p,{children:"\u5F9E Channel \u62C9\u53D6\u8CC7\u6599\u6642, \u53EF\u4EE5\u85C9\u7531\u7B2C\u4E8C\u500B\u56DE\u50B3\u503C\u78BA\u8A8D Channel \u662F\u5426\u88AB\u95DC\u9589, \u5E38\u6703\u5728\u8FF4\u5708\u4E2D\u4F7F\u7528.\n\u5982\u679C\u88AB\u95DC\u9589\u7684\u8A71\u4EE3\u8868\u6B64 Channel \u5DF2\u7D93\u4E0D\u518D\u4F7F\u7528, \u53EF\u4EE5\u7D50\u675F\u8FF4\u5708."}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int)\n    go func() {\n        for i := 0; i < 10; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95DC\u9589 Channel\n    }()\n    for {\n        v, ok := <-c\n        if !ok { // \u5224\u65B7 Channel \u662F\u5426\u95DC\u9589\n            break\n        }\n        fmt.Println("read i:", v)\n    }\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n"})}),"\n",(0,c.jsx)(e.p,{children:"\u5982\u679C\u5C0D Closed Channel \u63A8\u5165\u8CC7\u6599\u7684\u8A71\u6703\u9020\u6210 Panic\uFF1A"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"func main() {\n    c := make(chan int)\n    close(c)\n    c <- 0 // Panic!!!\n}\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"panic: send on closed channel\n"})}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u70BA\u4E86\u907F\u514D\u5C07\u8CC7\u6599\u63A8\u5165\u5DF2\u95DC\u9589\u7684 Channel \u4E2D\u9020\u6210 Panic, Channel \u7684\u95DC\u9589\u61C9\u8A72\u7531\u63A8\u5165\u7684 Goroutine \u8655\u7406."})}),"\n",(0,c.jsx)(e.h3,{id:"\u4F7F\u7528-range-\u5DE1\u8A2A-channel",children:"\u4F7F\u7528 range \u5DE1\u8A2A channel"}),"\n",(0,c.jsxs)(e.p,{children:["\u5728\u8FF4\u5708\u4E2D\u62C9\u53D6 Channel \u4E2D\u7684\u8CC7\u6599, \u9664\u4E86\u53EF\u4EE5\u7528\u7B2C\u4E8C\u56DE\u50B3\u503C\u5224\u65B7 Channel \u662F\u5426\u95DC\u9589,\n",(0,c.jsx)(e.code,{children:"range"})," \u4E5F\u662F\u53EF\u4EE5\u5DE1\u89BD Channel \u7684. \u7D42\u6B62\u689D\u4EF6\u70BA Channel \u7684\u72C0\u614B\u70BA\u5DF2\u95DC\u9589\u7684."]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int)\n    go func() {\n        for i := 0; i < 5; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95DC\u9589 Channel\n    }()\n    for i := range c { // \u5728 close \u5F8C\u8DF3\u51FA\u8FF4\u5708\n        fmt.Println("read i:", i)\n    }\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"push i: 0\npush i: 1\nread i: 0\nread i: 1\npush i: 2\npush i: 3\nread i: 2\nread i: 3\npush i: 4\nread i: 4\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u4F7F\u7528 ",(0,c.jsx)(e.code,{children:"range"})," \u4F86\u5DE1\u8A2A Channel \u8CC7\u6599\u6642, \u540C\u6A23\u6703\u9020\u6210\u8B80\u53D6\u8CC7\u6599\u548C\u63A8\u5165\u8CC7\u6599\u7684\u963B\u585E.\n\u5982\u4E0A, \u5C0D\u65BC Unbuddered Channel \u5BEB\u5165\u548C\u8B80\u53D6\u8CC7\u6599,\npush \u548C read \u5169\u500B Goroutine \u6703\u76F8\u4E92\u963B\u585E, \u53EF\u80FD\u5F71\u97FF\u6548\u80FD."]}),"\n",(0,c.jsx)(e.p,{children:"\u53EF\u642D\u914D Buffered Channel \u4F7F\u7528, \u9069\u7576\u60C5\u6CC1\u4E0B\u6703\u6E1B\u5C11\u963B\u585E, \u63D0\u5347\u6548\u80FD."}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    c := make(chan int, 5)\n    go func() {\n        for i := 0; i < 8; i++ {\n            fmt.Println("push i:", i)\n            c <- i\n        }\n        close(c) // \u95DC\u9589 Channel\n    }()\n    for i := range c { // \u5728 close \u5F8C\u8DF3\u51FA\u8FF4\u5708\n        fmt.Println("read i:", i)\n    }\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"push i: 0\npush i: 1\npush i: 2\npush i: 3\npush i: 4\npush i: 5\npush i: 6\nread i: 0\nread i: 1\nread i: 2\nread i: 3\nread i: 4\nread i: 5\nread i: 6\npush i: 7\nread i: 7\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u53E6\u5916\u8981\u6CE8\u610F\u7684\u662F, ",(0,c.jsx)(e.code,{children:"range"})," \u7D50\u675F\u689D\u4EF6\u548C buffer size \u7121\u95DC,\n\u4E0A\u4F8B\u4E2D buffer size \u70BA 5 \u7684 Channel, \u900F\u904E ",(0,c.jsx)(e.code,{children:"range"})," \u4ECD\u53EF\u8B80\u51FA 8 \u7B46\u8CC7\u6599.\n",(0,c.jsx)(e.code,{children:"range"})," \u7D50\u675F\u50C5\u4EE5 channel close \u70BA\u6E96."]}),"\n",(0,c.jsx)(e.h2,{id:"select",children:"Select"}),"\n",(0,c.jsx)(e.p,{children:"\u5728 Channel \u63A8\u5165/\u62C9\u53D6\u6642, \u56E0 Channel \u963B\u585E\u7684\u7279\u6027, \u6703\u6709\u4E00\u6BB5\u7B49\u5F85\u7684\u6642\u9593\u800C\u9020\u6210 Goroutine \u7121\u6CD5\u56DE\u61C9.\n\u5982\u679C\u6B64 Goroutine \u662F\u8CA0\u8CAC\u8655\u7406\u756B\u9762\u7684, \u4F7F\u7528\u8005\u5C31\u6703\u770B\u5230\u756B\u9762 lag \u7684\u60C5\u6CC1, \u9019\u662F\u6211\u5011\u4E0D\u60F3\u898B\u7684\u60C5\u6CC1."}),"\n",(0,c.jsx)(e.p,{children:"\u4F8B\u5982\u4E4B\u524D\u63D0\u5230\u7684\u4F8B\u5B50:"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() {\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH"\n\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    fmt.Println("main goroutine is waiting for channel to receive value")\n    fmt.Println(<-ch) // goroutine \u57F7\u884C\u6703\u5728\u6B64\u88AB\u8FEB\u7B49\u5F85\n    fmt.Println("main goroutine finished")\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"main goroutine is waiting for channel to receive value # main goroutine \u963B\u585E\ncalculate goroutine starts calculating\ncalculate goroutine ends calculating\ncalculate goroutine finished\nFINISH # main goroutine \u89E3\u9664\u963B\u585E\nmain goroutine finished\n"})}),"\n",(0,c.jsxs)(e.p,{children:["main goroutine \u8981\u62C9\u53D6 ",(0,c.jsx)(e.code,{children:"ch"})," \u7684\u8CC7\u6599\u6642\u6703\u88AB\u8FEB\u7B49\u5F85.\n\u9019\u6642\u7121\u6CD5\u56DE\u994B\u76EE\u524D\u7684\u72C0\u614B\u7D66\u4F7F\u7528\u8005, \u9020\u6210\u5361\u9813."]}),"\n",(0,c.jsxs)(e.p,{children:["\u9019\u6642\u53EF\u4EE5\u4F7F\u7528 Go \u63D0\u4F9B\u7684 ",(0,c.jsx)(e.code,{children:"select"})," \u8A9E\u6CD5,\n\u8B93\u958B\u767C\u8005\u53EF\u4EE5\u5F88\u8F15\u9B06\u7684\u8655\u7406 Channel \u7684\u591A\u7A2E\u60C5\u6CC1, \u5305\u62EC\u963B\u585E\u6642\u7684\u8655\u7406."]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:'func main() {\n    ch := make(chan string)\n\n    go func() {\n        fmt.Println("calculate goroutine starts calculating")\n        time.Sleep(time.Second) // Heavy calculation\n        fmt.Println("calculate goroutine ends calculating")\n\n        ch <- "FINISH"\n        time.Sleep(time.Second)\n        fmt.Println("calculate goroutine finished")\n    }()\n\n    for {\n        select {\n        case <-ch: // Channel \u4E2D\u6709\u8CC7\u6599\u57F7\u884C\u6B64\u5340\u57DF\n            fmt.Println("main goroutine finished")\n            return\n        default: // Channel \u963B\u585E\u7684\u8A71\u57F7\u884C\u6B64\u5340\u57DF\n            fmt.Println("WAITING...")\n            time.Sleep(500 * time.Millisecond)\n        }\n    }\n}\n'})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"WAITING... # main goroutine \u5728\u963B\u585E\u6642\u53EF\u4EE5\u56DE\u61C9\ncalculate goroutine starts calculating\nWAITING... # main goroutine \u5728\u963B\u585E\u6642\u53EF\u4EE5\u56DE\u61C9\nWAITING... # main goroutine \u5728\u963B\u585E\u6642\u53EF\u4EE5\u56DE\u61C9\ncalculate goroutine ends calculating\nmain goroutine finished # main goroutine \u89E3\u9664\u963B\u585E\u4E26\u7D50\u675F\u7A0B\u5F0F\n"})}),"\n",(0,c.jsxs)(e.p,{children:["\u5C07\u525B\u525B\u7684\u4F8B\u5B50\u6539\u70BA ",(0,c.jsx)(e.code,{children:"select"})," \u4F86\u8655\u7406, \u53EF\u4EE5\u4F7F Channel \u7684\u63A8\u5165/\u62C9\u53D6\u4E0D\u6703\u963B\u585E:"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u6703\u5728\u6C92\u6709\u963B\u585E\u7684\u60C5\u6CC1\u4E0B\u624D\u6703\u57F7\u884C\u5C0D\u61C9\u7684\u5340\u584A"}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"case <-ch:"})," \u6703\u7B49\u5230\u6C92\u6709\u963B\u585E\u60C5\u6CC1\u6642 (",(0,c.jsx)(e.code,{children:"ch"})," \u5167\u6709\u8CC7\u6599) \u624D\u6703\u57F7\u884C"]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"default:"})," \u5728\u6240\u6709\u7684 ",(0,c.jsx)(e.code,{children:"case"})," \u90FD\u963B\u585E\u7684\u60C5\u6CC1\u4E0B\u57F7\u884C"]}),"\n"]}),"\n",(0,c.jsxs)(e.p,{children:["\u56E0\u70BA\u6709 ",(0,c.jsx)(e.code,{children:"default"})," \u53EF\u4EE5\u8A2D\u7F6E, \u7576 Channel \u963B\u585E\u6642\u4E5F\u53EF\u4EE5\u85C9\u7531 ",(0,c.jsx)(e.code,{children:"default"})," \u8F38\u51FA\u8CC7\u8A0A\u8B93\u4F7F\u7528\u8005\u77E5\u9053."]}),"\n",(0,c.jsx)(e.h2,{id:"\u5C0F\u7D50",children:"\u5C0F\u7D50"}),"\n",(0,c.jsx)(e.p,{children:"Channel \u662F Goroutine \u7684\u597D\u5E6B\u624B, \u524D\u7BC7\u5584\u7528 Channel \u7684\u963B\u585E\u7279\u6027,\n\u53EF\u4EE5\u7528\u4F86\u7BA1\u7406 Goroutine \u5171\u7528\u8B8A\u6578\u5B58\u53D6\u7B49\u63A7\u5236."}),"\n",(0,c.jsx)(e.p,{children:"\u672C\u7BC7\u8AAA\u660E Channel \u7684\u963B\u585E\u6642\u6A5F (\u63A8\u5165\u963B\u585E\u53CA\u62C9\u53D6\u963B\u585E),\n\u4EE5\u53CA Unbuffered \u53CA Buffered Channel \u5C0D\u963B\u585E\u7684\u5DEE\u5225.\n\u5247\u53EF\u85C9\u7531 Unbuffered Channel \u964D\u4F4E\u6548\u80FD\u4E0A\u7684\u640D\u5931."}),"\n",(0,c.jsx)(e.p,{children:"Channel \u50B3\u56DE\u7684\u7B2C\u4E8C\u500B\u53C3\u6578: ok, \u53EF\u4EE5\u5224\u65B7\u6B64 Channel \u662F\u5426\u5DF2\u7D93\u95DC\u9589,\n\u4E26\u88AB range \u7528\u5728\u7D50\u675F\u5DE1\u89BD\u7684\u5224\u65B7\u4E2D."}),"\n",(0,c.jsx)(e.p,{children:"\u6700\u5F8C, select \u53EF\u4EE5 Channel \u5728\u963B\u585E\u6642\u8B93 Goroutine \u4FDD\u6301\u975E\u963B\u585E\u7684\u72C0\u614B\u907F\u514D\u5361\u9813."}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"\u85C9\u7531 Goroutine \u53CA Channel \u7C21\u55AE\u7684\u8A9E\u6CD5\u4F46\u662F\u5F37\u5927\u7684\u80FD\u529B\u4F7F\u5DE5\u7A0B\u5E2B\u958B\u767C\u591A\u5DE5\u7A0B\u5F0F\u7684\u6642\u5019\u53EF\u4EE5\u5BEB\u51FA\u512A\u96C5\u53C8\u6613\u65BC\u7DAD\u8B77\u7684\u4EE3\u78BC, \u662F Go \u8A9E\u8A00\u7684\u512A\u52E2\u4E4B\u4E00"})}),"\n",(0,c.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://peterhpchen.github.io/2020/03/08/goroutine-and-channel.html",children:"Go \u7684\u4E26\u767C\uFF1AGoroutine \u8207 Channel \u4ECB\u7D39 - Limitless Ping"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://easonwang.gitbook.io/golang/ji-ben-yu-fa/channel",children:"Channel \u8207Goroutine - Golang \u7B46\u8A18"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://blog.wu-boy.com/2020/01/when-to-use-go-channel-and-goroutine/",children:"\u4F7F\u7528 Go Channel \u53CA Goroutine \u6642\u6A5F - \u5C0F\u60E1\u9B54 - AppleBOY"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://pjchender.dev/golang/goroutine-channels-concurrency/",children:"[Golang] goroutines, channels, and concurrency"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"http://www.hangdaowangluo.com/archives/2504",children:"Goroutine\u548Cchannel\u7684\u8BE6\u7EC6\u7406\u89E3\uFF08\u4E00\uFF09 - \u7CBE\u5F69\u6BCF\u4E00\u5929"})}),"\n"]})]})}function d(n={}){let{wrapper:e}={...(0,a.a)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(s,{...n})}):s(n)}},50065:function(n,e,l){l.d(e,{Z:function(){return o},a:function(){return r}});var i=l(67294);let c={},a=i.createContext(c);function r(n){let e=i.useContext(a);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:r(n.components),i.createElement(a.Provider,{value:e},n.children)}}}]);