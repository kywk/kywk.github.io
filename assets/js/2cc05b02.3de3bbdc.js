"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["27774"],{21048:function(e,s,n){n.r(s),n.d(s,{default:()=>x,frontMatter:()=>c,metadata:()=>r,assets:()=>t,toc:()=>d,contentTitle:()=>o});var r=JSON.parse('{"id":"javascript/express/express_cors","title":"Express CORS","description":"Express CORS","source":"@site/moco/javascript/express/express_cors.md","sourceDirName":"javascript/express","slug":"/javascript/express/express_cors","permalink":"/moco/javascript/express/express_cors","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Node.js","permalink":"/moco/tags/node-js"},{"inline":true,"label":"Nodejs/Express","permalink":"/moco/tags/nodejs-express"},{"inline":true,"label":"Security","permalink":"/moco/tags/security"}],"version":"current","frontMatter":{"title":"Express CORS","description":"Express CORS","tags":["Node.js","Nodejs/Express","Security"],"date_created":"2022-09-28T16:00:00.000Z","image":"https://i.imgur.com/mErPwqL.png"},"sidebar":"tutorialSidebar","previous":{"title":"Snippets","permalink":"/moco/javascript/express/express_snippets"},"next":{"title":"TypeScript","permalink":"/moco/javascript/express/express_typescript"}}'),i=n("85893"),l=n("50065");let c={title:"Express CORS",description:"Express CORS",tags:["Node.js","Nodejs/Express","Security"],date_created:new Date("2022-09-28T16:00:00.000Z"),image:"https://i.imgur.com/mErPwqL.png"},o="[Express] CORS",t={},d=[{value:"Manually",id:"manually",level:2},{value:"Allow-Origin: *",id:"allow-origin-",level:3},{value:"use credentials",id:"use-credentials",level:3},{value:"express/cors",id:"expresscors",level:2},{value:"\u53C3\u6578",id:"\u53C3\u6578",level:3},{value:"See Also",id:"see-also",level:2},{value:"References",id:"references",level:3}];function a(e){let s={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"express-cors",children:"[Express] CORS"})}),"\n",(0,i.jsxs)(s.p,{children:["Express \u6846\u67B6\u4E2D, \u8981\u8655\u7406 ",(0,i.jsx)(s.a,{href:"../Security/CORS.md",children:"CORS \u898F\u7BC4\u8A2D\u5B9A"}),",\n\u53EF\u4EE5\u4F9D\u7A0B\u5F0F\u9700\u6C42\u624B\u52D5\u914D\u7F6E ",(0,i.jsx)(s.code,{children:"res.header()"}),", \u6216\u662F\u4F7F\u7528 ",(0,i.jsx)(s.a,{href:"https://github.com/expressjs/cors",children:"express/cors"})," \u5957\u4EF6."]}),"\n",(0,i.jsx)(s.h2,{id:"manually",children:"Manually"}),"\n",(0,i.jsx)(s.h3,{id:"allow-origin-",children:"Allow-Origin: *"}),"\n",(0,i.jsxs)(s.p,{children:["\u8981\u5141\u8A31\u4E0D\u540C Origin \u5B58\u53D6\u8CC7\u6599, Server \u7AEF\u5728 response header \u52A0\u4E0A ",(0,i.jsx)(s.code,{children:"Access-Control-Allow-Origin"}),".\nExpress \u6846\u67B6\u8A9E\u6CD5\u5982\u4E0B:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"app.use((req, res, next)=> {\n  res.header('Access-Control-Allow-Origin', *)\n  res.header('Access-Control-Allow-Credentials', false)\n  next()\n})\n"})}),"\n",(0,i.jsxs)(s.p,{children:["\u5982\u679C Access-Control-Allow-Origin \u8A2D\u5B9A\u70BA* (\u63A5\u53D7\u4EFB\u4F55\u8DE8\u9818\u57DF\u7684\u8B80\u53D6),\n",(0,i.jsx)(s.code,{children:"Access-Control-Allow-Credentials"})," \u53EA\u80FD\u8A2D\u5B9A\u70BA false,\n",(0,i.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors/CORSNotSupportingCredentials",children:"\u8AAA\u660E\u9023\u7D50"})]}),"\n",(0,i.jsx)(s.h3,{id:"use-credentials",children:"use credentials"}),"\n",(0,i.jsxs)(s.p,{children:["\u56E0\u70BA\u8A2D\u5B9A ",(0,i.jsx)(s.code,{children:"Access-Control-Allow-Credentials"})," \u70BA false, \u6240\u4EE5 client \u4E0D\u80FD\u50B3\u9001 cookie.\n\u82E5\u9700\u8981\u8DE8 subdomain \u5B58\u53D6 cookies credentials, \u53EF\u4EE5\u4F7F\u7528\u767D\u540D\u55AE\u7684\u8A2D\u8A08."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"const allowedOrigins = ['http://xxx.star.com.tw', 'http://yyy.star.com.tw', 'http://zzz.star.com.tw']\nconst origin = req.headers.origin\nif (allowedOrigins.indexOf(origin) > -1){\n   res.setHeader('Access-Control-Allow-Origin', origin)\n}\nres.header('Access-Control-Allow-Credentials', true)\n"})}),"\n",(0,i.jsx)(s.p,{children:"\u5982\u679C\u7B26\u5408 allowedOrigins \u5C31\u53EF\u4EE5\u63A5\u53D7 Credentials."}),"\n",(0,i.jsx)(s.h2,{id:"expresscors",children:"express/cors"}),"\n",(0,i.jsx)(s.p,{children:"Express \u8655\u7406 CORS \u8A2D\u5B9A\u96D6\u7136\u7C21\u55AE, \u4F46\u5BEB\u5728\u7A0B\u5F0F\u4E2D\u5BEB\u6B7B header \u8A2D\u7F6E, \u5728\u7DAD\u8B77\u4FEE\u6539\u90FD\u6BD4\u8F03\u9EBB\u7169.\n\u4E0D\u540C\u958B\u767C\u74B0\u5883\u90E8\u7F72\u4E0A\u4E5F\u6BD4\u8F03\u6C92\u6709\u5F48\u6027."}),"\n",(0,i.jsxs)(s.p,{children:["Express \u5B98\u65B9\u81EA\u5DF1\u51FA\u4E86\u4E00\u500B\u5957\u4EF6 ",(0,i.jsx)(s.a,{href:"https://github.com/expressjs/cors",children:"express/cors"})," \u65B9\u4FBF\u5927\u5BB6\u5728 Node.js \u4E0A\u8A2D\u5B9A CORS:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"npm install --save cors\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"var cors = require(cors)\napp.use(cors())\n"})}),"\n",(0,i.jsx)(s.p,{children:"\u9019\u6A23\u5C31\u5B8C\u6210\u4E86. \u4F46\u4E0D\u662F\u6700\u597D\u7684\u914D\u7F6E\u65B9\u5F0F, \u56E0\u70BA cors \u9810\u8A2D\u70BA\u958B\u597D\u958B\u6EFF, \u6240\u6709\u8DE8\u57DF\u8ACB\u6C42\u90FD\u63A5\u53D7:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'{\n  "origin": "*",\n  "methods": "GET,HEAD,PUT,PATCH,POST,DELETE",\n  "preflightContinue": false,\n  "optionsSuccessStatus": 204\n} \n'})}),"\n",(0,i.jsx)(s.p,{children:"\u6BD4\u8F03\u597D\u7684\u4F5C\u6CD5\u61C9\u8A72\u662F\u6388\u6B0A\u6307\u5B9A\u7684\u7DB2\u57DF, \u8ACB\u6C42\u65B9\u6CD5\u7B49, \u91DD\u5C0D\u9700\u6C42\u53BB\u8A2D\u5B9A:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"const corsOptions = {\n  origin: [\n    'http://www.example.com',\n    'http://localhost:8080',\n  ],\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS',\n  allowedHeaders: ['Content-Type', 'Authorization'],\n};\n\napp.use(cors(corsOptions));\n"})}),"\n",(0,i.jsx)(s.p,{children:"\u6CE8\u610F cors options \u70BA\u4E00\u6A19\u6E96\u7684 JSON \u683C\u5F0F,\n\u53EF\u4EE5\u8F09\u5165\u5916\u90E8 config.json \u6A94\u4F7F\u7528, \u5C31\u53EF\u4EE5\u5B8C\u6210\u4E0D\u540C\u958B\u767C\u74B0\u5883\u4E0B\u7684\u4E0D\u540C\u914D\u7F6E\u9700\u6C42\u4E86."}),"\n",(0,i.jsx)(s.h3,{id:"\u53C3\u6578",children:"\u53C3\u6578"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"origin"})," \u8A2D\u7F6E\u53EF\u5B58\u53D6\u7684\u7DB2\u57DF, \u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Allow-Origin"})," \u53C3\u6578.",(0,i.jsx)(s.br,{}),"\n\u53EF\u63A5\u53D7\u7684\u8CC7\u6599\u578B\u5225\u70BA ",(0,i.jsx)(s.code,{children:"Boolean"})," | ",(0,i.jsx)(s.code,{children:"String"})," | ",(0,i.jsx)(s.code,{children:"RegExp"})," | ",(0,i.jsx)(s.code,{children:"Array<String|RegExp>"})," | ",(0,i.jsx)(s.code,{children:"Function"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"methods"})," \u8A2D\u7F6E\u53EF\u5B58\u53D6\u7684\u65B9\u6CD5, \u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Allow-Methods"})," \u53C3\u6578.",(0,i.jsx)(s.br,{}),"\n\u53EF\u4EE5\u63A5\u53D7\u7684\u53C3\u6578\u683C\u5F0F: ",(0,i.jsx)(s.code,{children:"GET, POST,DELETE"})," \u9019\u7A2E\u7528\u9017\u865F\u9694\u958B\u7684.\n\u4E5F\u63A5\u53D7 ",(0,i.jsx)(s.code,{children:"Array<String>"})," \u7684\u683C\u5F0F, \u5982: ",(0,i.jsx)(s.code,{children:"['GET', 'POST']"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"allowedHeaders"})," \u8A2D\u7F6E\u53EF\u5B58\u53D6\u7684 Header\uFF0C\u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Allow-Headers"})," \u53C3\u6578,",(0,i.jsx)(s.br,{}),"\n\u53EF\u4EE5\u63A5\u53D7\u7684\u53C3\u6578\u683C\u5F0F: ",(0,i.jsx)(s.code,{children:"Content-Type,Authorization"})," \u9019\u7A2E\u7528\u9017\u865F\u9694\u958B\u7684.\n\u4E5F\u63A5\u53D7 ",(0,i.jsx)(s.code,{children:"Array<String>"})," \u7684\u683C\u5F0F, \u5982: ",(0,i.jsx)(s.code,{children:"'Content-Type', 'Authorization'"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"exposedHeaders"})," \u8A2D\u7F6E\u700F\u89BD\u5668\u53EF\u6AA2\u8996\u7684\u5176\u4ED6 Header \u9805\u76EE, \u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Expose-Headers"})," \u53C3\u6578.\n\u53EF\u4EE5\u63A5\u53D7\u7684\u53C3\u6578\u683C\u5F0F: ",(0,i.jsx)(s.code,{children:"Content-Range,X-Content-Range"})," \u9019\u7A2E\u7528\u9017\u865F\u9694\u958B\u7684.\n\u4E5F\u63A5\u53D7 ",(0,i.jsx)(s.code,{children:"Array<String>"})," \u7684\u683C\u5F0F, \u5982: ",(0,i.jsx)(s.code,{children:"['Content-Range', 'X-Content-Range']"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"credentials"})," \u8A2D\u7F6E\u662F\u5426\u50B3\u9001 cookie, \u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Allow-Credentials"})," \u53C3\u6578.\n\u8CC7\u6599\u578B\u5225 ",(0,i.jsx)(s.code,{children:"Boolean"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"maxAge"})," \u8A2D\u7F6E\u5408\u6CD5\u671F\u9593, \u4F7F\u700F\u89BD\u5668\u5728\u9019\u6BB5\u671F\u9593\u5167\u4E0D\u5FC5\u767C\u9001 OPTION \u8ACB\u6C42, \u4E5F\u5C31\u662F\u8A2D\u7F6E ",(0,i.jsx)(s.em,{children:"Access-Control-Max-Age"})," \u53C3\u6578.\n\u8CC7\u6599\u578B\u5225 ",(0,i.jsx)(s.code,{children:"Number"})," \u4E14\u9700\u6574\u6578"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"preflightContinue"})," \u50B3\u905E OPTION \u8ACB\u6C42\u7684 response \u5230\u4E0B\u4E00\u500B handler"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"optionsSuccessStatus"})," \u8A2D\u7F6E\u7576 OPTION \u8ACB\u6C42\u6210\u529F\u6642, \u56DE\u50B3\u7684 HTTP Code"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsx)(s.h3,{id:"references",children:"References"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"../Security/CORS.md",children:"CORS"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://medium.com/summers-life/cros-express%E7%AB%AF%E7%9A%84%E8%A8%AD%E5%AE%9A-f94c9a3199a1",children:"Cors Express\u7AEF\u7684\u8A2D\u5B9A. \u6700\u8FD1\u5DE5\u4F5C\u4E0A\u505A\u4E86\u4E00\u500B\u5E73\u53F0\u5C08\u9580\u5C07\u5716\u7247\u8F49\u6A94\uFF0C\u73FE\u5728\u9019\u500B\u5E73\u53F0\u8981\u958B\u59CB\u4E32\u63A5\u5230\u7DB2\u7AD9\u4E0A\uFF0C\u7531clie\u2026 | by Tinghuan Wang | summer's code life | Medium"})}),"\n"]})]})}function x(e={}){let{wrapper:s}={...(0,l.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},50065:function(e,s,n){n.d(s,{Z:function(){return o},a:function(){return c}});var r=n(67294);let i={},l=r.createContext(i);function c(e){let s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);