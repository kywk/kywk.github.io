"use strict";(self.webpackChunkblog_kywk=self.webpackChunkblog_kywk||[]).push([[38234],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>m});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),c=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,k=d["".concat(p,".").concat(m)]||d[m]||u[m]||a;return t?r.createElement(k,i(i({ref:n},s),{},{components:t})):r.createElement(k,i({ref:n},s))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},46247:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var r=t(87462),o=(t(67294),t(3905));const a={title:"Dockerize",description:"Dockerize Spring Boot application",tags:["SpringBoot","Docker"],sidebar_position:80,hide_table_of_contents:!0,created:new Date("2023-03-14T00:00:00.000Z"),updated:new Date("2023-03-14T00:00:00.000Z"),image:"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0"},i="[SpringBoot] Dockerize Spring Boot Application",l={unversionedId:"java/springboot/misc_dockerize",id:"java/springboot/misc_dockerize",title:"Dockerize",description:"Dockerize Spring Boot application",source:"@site/blogging/moco/java/springboot/misc_dockerize.md",sourceDirName:"java/springboot",slug:"/java/springboot/misc_dockerize",permalink:"/moco/java/springboot/misc_dockerize",draft:!1,tags:[{label:"SpringBoot",permalink:"/moco/tags/spring-boot"},{label:"Docker",permalink:"/moco/tags/docker"}],version:"current",sidebarPosition:80,frontMatter:{title:"Dockerize",description:"Dockerize Spring Boot application",tags:["SpringBoot","Docker"],sidebar_position:80,hide_table_of_contents:!0,created:"2023-03-14T00:00:00.000Z",updated:"2023-03-14T00:00:00.000Z",image:"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0"},sidebar:"tutorialSidebar",previous:{title:"Docker versioning",permalink:"/moco/java/springboot/misc_docker-versioning"},next:{title:"SpEL expressions",permalink:"/moco/java/springboot/spring/spring_spel-expressions"}},p={},c=[{value:"Run w/ Java source",id:"run-w-java-source",level:2},{value:"Run w/ JAR binary",id:"run-w-jar-binary",level:2},{value:"Multi-Stage Build",id:"multi-stage-build",level:2},{value:"See Also",id:"see-also",level:2}],s={toc:c};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"springboot-dockerize-spring-boot-application"},"[SpringBoot]"," Dockerize Spring Boot Application"),(0,o.kt)("p",null,"\u5efa\u7acb Sprint Boot Application Container \u4e0d\u5916\u4e4e\u5169\u7a2e\u65b9\u5f0f:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u628a\u539f\u59cb\u78bc\u653e\u5165 container, \u900f\u904e mvn \u5728 container \u8dd1."),(0,o.kt)("li",{parentName:"ol"},"\u628a Sprint Boot \u7de8\u8b6f\u6210 .jar \u6a94\u5f8c\u653e\u5165 Container, \u900f\u904e Java \u4f86\u57f7\u884c.")),(0,o.kt)("h2",{id:"run-w-java-source"},"Run w/ Java source"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM eclipse-temurin\nWORKDIR /app\n \nCOPY .mvn/ .mvn\nCOPY mvnw pom.xml ./\nRUN ./mvnw dependency:go-offline\n \nCOPY src ./src\n \nCMD ["./mvnw", "spring-boot:run"]\n')),(0,o.kt)("p",null,"\u9019\u500b Dockerfile \u628a source code \u6253\u5305\u9032 container \u521d\u59cb\u5316\u5c08\u6848\u6a94\u6848\u5f8c,\n\u900f\u904e mvn \u4f86\u7de8\u8b6f\u8207\u555f\u52d5 sprint boot application."),(0,o.kt)("p",null,"\u9019\u6a23\u7684 image \u9700\u8981\u628a\u5b8c\u6574\u7de8\u8b6f\u74b0\u5883\u548c\u7a0b\u5f0f\u90fd\u653e\u5165 container \u4e2d,\n\u512a\u9ede\u662f\u82e5 CI/CD \u74b0\u5883\u4e2d\u6c92\u6709 JDK \u74b0\u5883, \u4ecd\u53ef\u7de8\u8b6f\u51fa\u53ef\u4ee5\u6b63\u5e38\u57f7\u884c\u7684 Spring Boot container."),(0,o.kt)("p",null,"\u4f46\u4e00\u822c\u4f86\u8aaa, \u9664\u975e\u90e8\u5c6c\u57f7\u884c container \u74b0\u5883\u90fd\u662f\u81ea\u5bb6\u63a7\u7ba1\u7684, \u5426\u5247\u4e0d\u6703\u63a1\u7528\u9019\u7a2e\u65b9\u5f0f.\n\u7562\u7adf container \u4e2d\u6a94\u6848\u662f\u7121\u6cd5\u88ab\u4fdd\u8b77, \u539f\u59cb\u78bc\u653e\u5165 container \u90e8\u5c6c\u51fa\u53bb, \u7b49\u65bc\u7a0b\u5f0f\u88f8\u5954\u5728\u5916.\n\u82e5\u7a0b\u5f0f\u6709\u91cd\u8981\u5546\u52d9\u908f\u8f2f\u6216\u52a0\u89e3\u5bc6\u8cc7\u8a0a, \u662f\u76f8\u7576\u5371\u96aa\u7684."),(0,o.kt)("p",null,"Ref: ",(0,o.kt)("a",{parentName:"p",href:"https://dhruv-saksena.medium.com/build-deploy-a-spring-boot-application-in-docker-container-49b9b2d3e25e"},"Build & Deploy a Spring Boot application in Docker container | by Dhruv Saksena | Medium")),(0,o.kt)("h2",{id:"run-w-jar-binary"},"Run w/ JAR binary"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM openjdk:11-jdk-alpine\nVOLUME /tmp\nARG JAR_FILE\nCOPY ${JAR_FILE} app.jar\nENTRYPOINT ["java","-jar","/app.jar"]\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"mvn install dockerfile:build\n")),(0,o.kt)("p",null,"\u76f8\u5c0d\u65bc\u524d\u8005, \u9019\u500b\u65b9\u5f0f\u662f\u5148\u628a Java \u7de8\u8b6f\u6210 JAR \u6a94,\n\u9700\u6e96\u5099\u57fa\u672c\u7684 Java runtime container,\n\u628a JAR \u653e\u5165 container \u4e2d\u5373\u53ef\u57f7\u884c. "),(0,o.kt)("p",null,"\u82e5\u8981\u90e8\u5c6c\u5230\u5916\u90e8\u74b0\u5883, \u7de8\u8b6f\u5f8c\u7684 binary \u8f03\u4e0d\u5bb9\u6613\u88ab\u7834\u89e3."),(0,o.kt)("p",null,"\u4f46\u82e5\u8981\u5728 CI/CD \u4e2d\u6253\u5305 container, \u5247\u9700\u78ba\u5b9a CI/CD runner \u4e0a\u662f\u6b63\u78ba\u5c0d\u61c9 JDK \u7248\u672c.\n\u53ef\u80fd\u4e0d\u540c\u5c08\u6848\u4f7f\u7528\u4e86\u4e0d\u540c JDK \u6216 mvn \u7248\u672c, \u9020\u6210 CI/CD \u8a2d\u5b9a\u4e0a\u7684\u8907\u96dc\u6216\u51fa\u932f."),(0,o.kt)("p",null,"\u4e0d\u8003\u616e CI/CD \u60c5\u6cc1, \u7531 develop \u624b\u52d5 build docker image \u7684\u8a71, \u9019\u662f\u9069\u5408\u7684\u65b9\u5f0f."),(0,o.kt)("h2",{id:"multi-stage-build"},"Multi-Stage Build"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/build/building/multi-stage/"},"Multi-stage builds")," are useful to anyone who has struggled to optimize\n",(0,o.kt)("strong",{parentName:"p"},"Dockerfiles")," while keeping them easy to read and maintain.")),(0,o.kt)("p",null,"Docker \u652f\u63f4 Multi-Stage Build, \u53ef\u4ee5\u628a\u4e0d\u540c\u968e\u6bb5\u7684\u9700\u6c42\u62c6\u958b\u5230\u5728\u4e0d\u540c docker \u4e2d\u57f7\u884c,\n\u518d\u628a\u6700\u7d42\u9700\u8981\u90e8\u7f72\u7684\u6a94\u6848\u5206\u5225\u8907\u88fd\u5230\u4e00\u500b docker."),(0,o.kt)("p",null,"\u5e38\u898b\u662f\u900f\u904e\u6709\u5b8c\u6574\u958b\u767c\u74b0\u5883\u7684 container \u4f86\u7de8\u8b6f\u7a0b\u5f0f,\n\u518d\u628a\u7de8\u8b6f\u5f8c\u7684\u7a0b\u5f0f\u653e\u5230\u6700\u57fa\u672c\u7684\u57f7\u884c\u74b0\u5883\u4e2d\u767c\u4f48."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM eclipse-temurin:17-jdk-alpine as build\nWORKDIR /workspace/app\n\nCOPY mvnw .\nCOPY .mvn .mvn\nCOPY pom.xml .\nCOPY src src\n\nRUN ./mvnw install -DskipTests\nRUN mkdir -p target/dependency && (cd target/dependency; jar -xf ../*.jar)\n\nFROM eclipse-temurin:17-jdk-alpine\nVOLUME /tmp\nARG DEPENDENCY=/workspace/app/target/dependency\nCOPY --from=build ${DEPENDENCY}/BOOT-INF/lib /app/lib\nCOPY --from=build ${DEPENDENCY}/META-INF /app/META-INF\nCOPY --from=build ${DEPENDENCY}/BOOT-INF/classes /app\nENTRYPOINT ["java","-cp","app:app/lib/*","hello.Application"]\n')),(0,o.kt)("p",null,"\u4ee5\u9019\u500b\u4f8b\u5b50\u4f86\u8aaa, \u5148\u5efa\u7acb\u4e86 builder \u9019\u500b container,\n\u628a\u5c08\u6848\u8a2d\u5b9a\u548c\u539f\u59cb\u7a0b\u5f0f\u6a94\u90fd\u8907\u88fd\u9032 builder \u4e2d\u9032\u884c\u5c08\u6848\u521d\u59cb\u5316\u548c\u7de8\u8b6f."),(0,o.kt)("p",null,"\u518d\u5efa\u7acb\u4e00\u500b\u57fa\u672c\u7684\u57f7\u884c\u74b0\u5883 container,\n\u628a builder \u4e2d\u6240\u7de8\u8b6f\u7684 JAR \u548c\u76f8\u95dc\u74b0\u5883\u6a94\u6848\u8907\u88fd\u904e\u4f86."),(0,o.kt)("p",null,"\u5982\u6b64\u4e00\u4f86, \u7528\u4f86\u90e8\u7f72\u7684 container \u88e1\u9762\u53ea\u6703\u6709 JAR binary, \u53ef\u907f\u514d\u8cc7\u5b89\u554f\u984c.\n\u5728 CI/CD \u6d41\u7a0b\u6642, \u7de8\u8b6f JAR \u662f\u5728 docker \u4e2d\u88ab\u57f7\u884c, \u4ea6\u53ef\u907f\u514d\u74b0\u5883\u8a2d\u5b9a\u554f\u984c\u9020\u6210\u7684\u932f\u8aa4."),(0,o.kt)("p",null,"\u53ef\u8aaa\u662f\u96c6\u524d\u5169\u500b\u65b9\u5f0f\u7684\u512a\u9ede\u65bc\u4e00\u8eab\u7684\u65b9\u5f0f."),(0,o.kt)("p",null,"Ref: ",(0,o.kt)("a",{parentName:"p",href:"https://dzone.com/articles/build-package-and-run-spring-boot-apps-with-docker"},"Build, Package, and Run Spring Boot Apps With Docker - DZone")),(0,o.kt)("h2",{id:"see-also"},"See Also"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.docker.com/blog/9-tips-for-containerizing-your-spring-boot-code/"},"9 Tips for Containerizing Your Spring Boot Code | Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://spring.io/guides/topicals/spring-boot-docker/"},"Getting Started | Spring Boot Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/build/building/multi-stage/"},"Multi-stage builds"))))}u.isMDXComponent=!0}}]);