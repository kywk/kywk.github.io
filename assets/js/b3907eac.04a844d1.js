"use strict";(self.webpackChunkkywk_github_io=self.webpackChunkkywk_github_io||[]).push([[49191],{35256:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var t=s(85893),r=s(11151);const o={title:"Redis: \u8b66\u544a\u8207\u554f\u984c\u6392\u9664",tags:["Infra","Redis"],date_created:new Date("2021-05-06T06:26:31.000Z"),image:"https://lh3.googleusercontent.com/pw/ACtC-3c20fracgrQ2pPqoqdoDC8B2-TKXBr7gWPBBoYkEjUhibsZSiOx-D0rbH0mw4ioWUPFaggeqZhKvWI-og9IzKmSXItl67QFCpd33vklw9QLZU0FW7ggHE1yuZ7S7NVTUSmrshARmmk-iJQifd72Nb86rQ=w800-no?authuser=0"},i="[Redis] \u8b66\u544a\u8a0a\u606f\u6392\u9664",a={id:"devsecops/infra/redis_troubleshooting",title:"Redis: \u8b66\u544a\u8207\u554f\u984c\u6392\u9664",description:"\u555f\u52d5 Redis \u51fa\u73fe\u4e0b\u5217\u8b66\u544a\u8a0a\u606f, \u8b66\u544a\u8aaa\u660e\u76f8\u7576\u6e05\u695a, \u5982\u4f55\u8655\u7406\u8207\u914d\u7f6e\u4e5f\u5f88\u6e05\u695a, \u4e00\u4e00\u8a2d\u7f6e\u5373\u53ef.",source:"@site/moco/devsecops/infra/redis_troubleshooting.md",sourceDirName:"devsecops/infra",slug:"/devsecops/infra/redis_troubleshooting",permalink:"/moco/devsecops/infra/redis_troubleshooting",draft:!1,unlisted:!1,tags:[{inline:!0,label:"Infra",permalink:"/moco/tags/infra"},{inline:!0,label:"Redis",permalink:"/moco/tags/redis"}],version:"current",frontMatter:{title:"Redis: \u8b66\u544a\u8207\u554f\u984c\u6392\u9664",tags:["Infra","Redis"],date_created:"2021-05-06T06:26:31.000Z",image:"https://lh3.googleusercontent.com/pw/ACtC-3c20fracgrQ2pPqoqdoDC8B2-TKXBr7gWPBBoYkEjUhibsZSiOx-D0rbH0mw4ioWUPFaggeqZhKvWI-og9IzKmSXItl67QFCpd33vklw9QLZU0FW7ggHE1yuZ7S7NVTUSmrshARmmk-iJQifd72Nb86rQ=w800-no?authuser=0"},sidebar:"tutorialSidebar",previous:{title:"Redis: Cluster \u5efa\u88fd",permalink:"/moco/devsecops/infra/redis_cluster"},next:{title:"Ubuntu: NGINX + PHP",permalink:"/moco/devsecops/infra/ubuntu_nginx-php"}},c={},l=[{value:"\u540c\u6642\u958b\u555f\u6a94\u6848\u6578\u91cf\u592a\u5c11",id:"\u540c\u6642\u958b\u555f\u6a94\u6848\u6578\u91cf\u592a\u5c11",level:2},{value:"TCP backlog setting fail",id:"tcp-backlog-setting-fail",level:2},{value:"overcommit_memory = 0",id:"overcommit_memory--0",level:2},{value:"Transparent Huge Pages enabled",id:"transparent-huge-pages-enabled",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"redis-\u8b66\u544a\u8a0a\u606f\u6392\u9664",children:"[Redis] \u8b66\u544a\u8a0a\u606f\u6392\u9664"}),"\n",(0,t.jsx)(n.p,{children:"\u555f\u52d5 Redis \u51fa\u73fe\u4e0b\u5217\u8b66\u544a\u8a0a\u606f, \u8b66\u544a\u8aaa\u660e\u76f8\u7576\u6e05\u695a, \u5982\u4f55\u8655\u7406\u8207\u914d\u7f6e\u4e5f\u5f88\u6e05\u695a, \u4e00\u4e00\u8a2d\u7f6e\u5373\u53ef."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cow@sandbox:~/tmp/redis/src# ./redis-server\n25572:C 06 May 2021 07:58:52.254 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\n25572:C 06 May 2021 07:58:52.254 # Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=25572, just started\n25572:C 06 May 2021 07:58:52.254 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf\n25572:M 06 May 2021 07:58:52.255 * Increased maximum number of open files to 10032 (it was originally set to 1024).\n                _._\n           _.-``__ ''-._\n      _.-``    `.  `_.  ''-._           Redis 5.0.5 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._\n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 25572\n  `-._    `-._  `-./  _.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |           http://redis.io\n  `-._    `-._`-.__.-'_.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |\n  `-._    `-._`-.__.-'_.-'    _.-'\n      `-._    `-.__.-'    _.-'\n          `-._        _.-'\n              `-.__.-'\n\n25572:M 06 May 2021 07:58:52.255 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n25572:M 06 May 2021 07:58:52.255 # Server initialized\n25572:M 06 May 2021 07:58:52.255 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n25572:M 06 May 2021 07:58:52.255 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n25572:M 06 May 2021 07:58:52.255 * Ready to accept connections\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u540c\u6642\u958b\u555f\u6a94\u6848\u6578\u91cf\u592a\u5c11",children:"\u540c\u6642\u958b\u555f\u6a94\u6848\u6578\u91cf\u592a\u5c11"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"Increased maximum number of open files to 10032 (it was originally set to 1024).\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u7b2c\u4e00\u500b\u8a0a\u606f\u662f\u5efa\u8b70\u628a Redis \u7a0b\u5e8f\u540c\u6642\u7684\u6a94\u6848\u6578\u91cf\u8a2d\u70ba 10032. \u7cfb\u7d71\u4e00\u822c\u9810\u8a2d\u70ba 1024."}),"\n",(0,t.jsx)(n.p,{children:"\u4e00\u500b\u7a0b\u5e8f\u540c\u6642\u80fd\u6253\u958b\u7684\u6a94\u6848\u6578\u91cf\u904e\u591a\u6703\u5f71\u97ff\u7cfb\u7d71\u5176\u4ed6\u670d\u52d9, \u904e\u5c0f\u5247\u53ef\u80fd\u5f71\u97ff\u8a72\u7a0b\u5e8f\u81ea\u8eab\u6548\u80fd.\n\u82e5\u4e3b\u6a5f\u662f\u5c08\u9580\u62ff\u4f86\u8dd1 redis-server, \u5247\u53ef\u6a94\u6848\u4e0a\u9650\u653e\u5927."}),"\n",(0,t.jsxs)(n.p,{children:["\u4ee5\u4e0b\u4f7f\u7528\u7cfb\u7d71\u7d1a\u5225\u653e\u5927\u9650\u5236, \u53c3\u8003 ",(0,t.jsx)(n.a,{href:"https://www.kernel.org/doc/Documentation/sysctl/fs.txt",children:"fs"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ sudo vi /etc/sysctl.conf\n\nfs.file-max = 10032\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4e0a\u9762\u4fee\u6539\u7684\u914d\u7f6e\u9700\u91cd\u65b0\u958b\u6a5f\u624d\u80fd\u751f\u6548, \u53ef\u7b49\u672c\u7bc7\u6240\u6709\u6b65\u9a5f\u9032\u884c\u5b8c\u7562\u518d\u91cd\u65b0\u958b\u6a5f."}),"\n",(0,t.jsxs)(n.p,{children:["\u7121\u9808\u91cd\u65b0\u958b\u6a5f\u7684\u8a71\u53ef\u900f\u904e\u6307\u4ee4\u53bb\u8a2d\u7f6e\u6216\u662f\u4f7f\u7528\u8005\u7d1a\u5225\u8a2d\u7f6e\u65b9\u5f0f,\n\u53ef\u53c3\u8003 ",(0,t.jsx)(n.a,{href:"https://www.jianshu.com/p/0048af19a8cb",children:"Redis \u542f\u52a8\u8b66\u544a\u89e3\u51b3\u65b9\u6cd5 - \u7b80\u4e66"})]}),"\n",(0,t.jsx)(n.h2,{id:"tcp-backlog-setting-fail",children:"TCP backlog setting fail"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n"})}),"\n",(0,t.jsx)(n.p,{children:"Redis \u5617\u8a66\u8a2d\u7f6e TCP backlog 511 \u5931\u6557, \u56e0\u70ba\u7cfb\u7d71\u8a2d\u7f6e\u70ba\u66f4\u5c0f\u7684 128."}),"\n",(0,t.jsxs)(n.p,{children:["TCP backlog \u8a73\u89e3\u53ef\u53c3\u8003: ",(0,t.jsx)(n.a,{href:"https://blog.csdn.net/raintungli/article/details/37913765",children:"linux\u91cc\u7684backlog\u8be6\u89e3_\u6ca7\u6d77\u4e00\u7c9f-CSDN\u535a\u5ba2_backlog"}),"\n\u4fee\u6539\u7cfb\u7d71\u8a2d\u7f6e\u65b9\u5f0f\u5982\u4e0b:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ sudo vi /etc/sysctl.conf\n\nnet.core.somaxconn=65535\n"})}),"\n",(0,t.jsx)(n.h2,{id:"overcommit_memory--0",children:"overcommit_memory = 0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"overcommit_memory"})," \u53c3\u6578\u8a2d\u5b9a\u70ba ",(0,t.jsx)(n.code,{children:"0"}),". \u6703\u9020\u6210\u8a18\u61b6\u9ad4\u4e0d\u8db3\u7684\u60c5\u6cc1\u4e0b, \u5f8c\u53f0\u5b58\u6a94\u7684\u7a0b\u5e8f\u53ef\u80fd\u5931\u6548. \u5efa\u8b70\u4fee\u6539\u8a2d\u5b9a\u70ba ",(0,t.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://blog.csdn.net/whycold/article/details/21388455",children:"\u6709\u5173linux\u4e0bredis overcommit_memory\u7684\u95ee\u9898"}),"\n\u4fee\u6539\u7cfb\u7d71\u8a2d\u7f6e\u65b9\u5f0f\u5982\u4e0b:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ sudo vi /etc/sysctl.conf\n\nvm.overcommit_memory=1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"transparent-huge-pages-enabled",children:"Transparent Huge Pages enabled"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u76ee\u524d\u7cfb\u7d71\u555f\u7528 ",(0,t.jsx)(n.code,{children:"Transparent Huge Pages (THP)"})," \u9019\u53ef\u80fd\u6703\u9020\u6210 redis \u6548\u80fd\u5ef6\u9072\u6216\u8a18\u61b6\u9ad4\u4f7f\u7528\u554f\u984c, \u5efa\u8b70\u95dc\u9589 THP \u652f\u63f4."]}),"\n",(0,t.jsx)(n.p,{children:"THP \u4ecb\u7d39\u5982\u4e0b:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/1721462",children:"Linux\u5173\u4e8e\u900f\u660e\u5927\u9875\u7684\u4f7f\u7528\u4e0e\u7981\u7528\u4ecb\u7ecd - \u4e91+\u793e\u533a - \u817e\u8baf\u4e91"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://blog.csdn.net/whatday/article/details/103028344",children:"linux \u5185\u5b58\u7ba1\u7406 Transparent HugePages \u900f\u660e\u5927\u9875 \u7b80\u4ecb_whatday\u7684\u4e13\u680f-CSDN\u535a\u5ba2_linux\u5927\u9875\u5185\u5b58 \u900f\u660e\u5927\u9875\u5185\u5b58"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u95dc\u9589 THP \u65b9\u6cd5\u5982\u4e0b:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ sudo vi /etc/rc.local\n\n#!/bin/sh -e\n\necho never > /sys/kernel/mm/transparent_hugepage/enabled\n\n$ sudo chmod a+x /etc/rc.local\n"})}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsx)(n.p,{children:"\u5168\u90e8\u4fee\u6539\u5b8c\u5f8c\u91cd\u65b0\u958b\u6a5f\u5f8c, redis \u5c31\u4e0d\u6703\u51fa\u73fe\u76f8\u95dc WARNING \u4e86.\n\u82e5\u7cfb\u7d71\u4e0d\u65b9\u4fbf\u91cd\u65b0\u958b\u6a5f, \u4e0b\u5217\u5169\u500b\u53c3\u8003\u8cc7\u8a0a\u90fd\u6709\u53ef\u4ee5\u5373\u6642\u751f\u6548\u7684\u8a2d\u5b9a\u65b9\u5f0f."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.jianshu.com/p/0048af19a8cb",children:"Redis \u542f\u52a8\u8b66\u544a\u89e3\u51b3\u65b9\u6cd5 - \u7b80\u4e66"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://blog.51cto.com/sf1314/2156127",children:"Redis\u4f18\u5316\uff1a\u542f\u52a8\u8b66\u544a\u95ee\u9898\u7684\u89e3\u51b3(\u5fc5\u987b\u505a\u7684\u64cd\u4f5c) \u5929\u9053\u916c\u52e4\uff0c\u884c\u8005\u65e0\u7586\u7684\u6280\u672f\u535a\u5ba2_51CTO\u535a\u5ba2"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>i});var t=s(67294);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);