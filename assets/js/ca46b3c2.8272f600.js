"use strict";(self.webpackChunkkywk_me=self.webpackChunkkywk_me||[]).push([["13072"],{73715:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>s,toc:()=>c,default:()=>p,metadata:()=>i,assets:()=>d,contentTitle:()=>a});var i=JSON.parse('{"id":"java/Spring Boot/Spring Boot Dockerize","title":"Dockerize","description":"Dockerize Spring Boot application","source":"@site/moco/java/Spring Boot/Spring Boot Dockerize.md","sourceDirName":"java/Spring Boot","slug":"/java/spring-boot/spring-boot-dockerize/","permalink":"/moco/java/spring-boot/spring-boot-dockerize/","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"SpringBoot","permalink":"/moco/tags/spring-boot"},{"inline":true,"label":"Docker","permalink":"/moco/tags/docker"}],"version":"current","sidebarPosition":80,"frontMatter":{"title":"Dockerize","description":"Dockerize Spring Boot application","tags":["SpringBoot","Docker"],"sidebar_position":80,"hide_table_of_contents":true,"date_created":"2023-03-14T00:00:00.000Z","date_updated":"2023-03-14T00:00:00.000Z","image":"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0","slug":"/java/spring-boot/spring-boot-dockerize/"},"sidebar":"tutorialSidebar","previous":{"title":"Web Service","permalink":"/moco/java/spring-boot/spring-boot-web-service/"},"next":{"title":"Spring Support Policy","permalink":"/moco/java/spring-boot/spring-boot-oss-support/"}}'),l=r(74848),o=r(84429);let s={title:"Dockerize",description:"Dockerize Spring Boot application",tags:["SpringBoot","Docker"],sidebar_position:80,hide_table_of_contents:!0,date_created:new Date("2023-03-14T00:00:00.000Z"),date_updated:new Date("2023-03-14T00:00:00.000Z"),image:"https://lh3.googleusercontent.com/pw/AL9nZEUA9Ifvd5Z8SXDWkeVB6AC4MPGwnXaL6kBXNPoXwOQQ2jOcZ1Jw_0p8TKK8C3ZX0e67_FOY15eDrm7aaXSQJcKtoUzC80SAQEHsaBy6qS2AqNNs5VUFNXBKm439y_1wkvmDl-PnL8ReojnIumNlEvOXBg=w800-no?authuser=0",slug:"/java/spring-boot/spring-boot-dockerize/"},a="Spring Boot Docker \u5BB9\u5668\u5316",d={},c=[{value:"\u6982\u8FF0",id:"\u6982\u8FF0",level:2},{value:"\u5BB9\u5668\u5316\u65B9\u6CD5\u6BD4\u8F03",id:"\u5BB9\u5668\u5316\u65B9\u6CD5\u6BD4\u8F03",level:2},{value:"\u65B9\u6CD5\u4E00\uFF1A\u539F\u59CB\u78BC\u5BB9\u5668\u5316",id:"\u65B9\u6CD5\u4E00\u539F\u59CB\u78BC\u5BB9\u5668\u5316",level:2},{value:"Dockerfile",id:"dockerfile",level:3},{value:"\u5EFA\u7F6E\u548C\u57F7\u884C",id:"\u5EFA\u7F6E\u548C\u57F7\u884C",level:3},{value:"\u512A\u7F3A\u9EDE\u5206\u6790",id:"\u512A\u7F3A\u9EDE\u5206\u6790",level:3},{value:"\u65B9\u6CD5\u4E8C\uFF1AJAR \u5BB9\u5668\u5316",id:"\u65B9\u6CD5\u4E8Cjar-\u5BB9\u5668\u5316",level:2},{value:"\u672C\u5730\u5EFA\u7F6E JAR",id:"\u672C\u5730\u5EFA\u7F6E-jar",level:3},{value:"Dockerfile",id:"dockerfile-1",level:3},{value:"\u5EFA\u7F6E\u548C\u57F7\u884C",id:"\u5EFA\u7F6E\u548C\u57F7\u884C-1",level:3},{value:"\u512A\u7F3A\u9EDE\u5206\u6790",id:"\u512A\u7F3A\u9EDE\u5206\u6790-1",level:3},{value:"\u65B9\u6CD5\u4E09\uFF1A\u591A\u968E\u6BB5\u5EFA\u7F6E\uFF08\u63A8\u85A6\uFF09",id:"\u65B9\u6CD5\u4E09\u591A\u968E\u6BB5\u5EFA\u7F6E\u63A8\u85A6",level:2},{value:"Dockerfile",id:"dockerfile-2",level:3},{value:"\u512A\u5316\u7248\u672C\uFF08\u4F7F\u7528 Spring Boot 2.3+ \u7684\u5206\u5C64\u529F\u80FD\uFF09",id:"\u512A\u5316\u7248\u672C\u4F7F\u7528-spring-boot-23-\u7684\u5206\u5C64\u529F\u80FD",level:3},{value:"\u5EFA\u7F6E\u548C\u57F7\u884C",id:"\u5EFA\u7F6E\u548C\u57F7\u884C-2",level:3},{value:"Docker Compose \u914D\u7F6E",id:"docker-compose-\u914D\u7F6E",level:2},{value:"docker-compose.yml",id:"docker-composeyml",level:3},{value:"\u6700\u4F73\u5BE6\u8E10",id:"\u6700\u4F73\u5BE6\u8E10",level:2},{value:"1. \u5B89\u5168\u6027",id:"1-\u5B89\u5168\u6027",level:3},{value:"2. \u6548\u80FD\u512A\u5316",id:"2-\u6548\u80FD\u512A\u5316",level:3},{value:"3. \u76E3\u63A7\u548C\u65E5\u8A8C",id:"3-\u76E3\u63A7\u548C\u65E5\u8A8C",level:3},{value:"4. \u74B0\u5883\u914D\u7F6E",id:"4-\u74B0\u5883\u914D\u7F6E",level:3},{value:"\u90E8\u7F72\u8173\u672C",id:"\u90E8\u7F72\u8173\u672C",level:2},{value:"deploy.sh",id:"deploysh",level:3},{value:"\u6545\u969C\u6392\u9664",id:"\u6545\u969C\u6392\u9664",level:2},{value:"\u5E38\u898B\u554F\u984C",id:"\u5E38\u898B\u554F\u984C",level:3},{value:"\u9664\u932F\u6280\u5DE7",id:"\u9664\u932F\u6280\u5DE7",level:3},{value:"See Also",id:"see-also",level:2}];function t(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"spring-boot-docker-\u5BB9\u5668\u5316",children:"Spring Boot Docker \u5BB9\u5668\u5316"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6982\u8FF0",children:"\u6982\u8FF0"}),"\n",(0,l.jsx)(n.p,{children:"\u5C07 Spring Boot \u61C9\u7528\u7A0B\u5F0F\u5BB9\u5668\u5316\u6709\u591A\u7A2E\u65B9\u5F0F\uFF0C\u6BCF\u7A2E\u65B9\u5F0F\u90FD\u6709\u5176\u512A\u7F3A\u9EDE\u548C\u9069\u7528\u5834\u666F\u3002\u672C\u6587\u5C07\u4ECB\u7D39\u4E09\u7A2E\u4E3B\u8981\u7684\u5BB9\u5668\u5316\u65B9\u6CD5\uFF0C\u4E26\u63D0\u4F9B\u6700\u4F73\u5BE6\u8E10\u5EFA\u8B70\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u5BB9\u5668\u5316\u65B9\u6CD5\u6BD4\u8F03",children:"\u5BB9\u5668\u5316\u65B9\u6CD5\u6BD4\u8F03"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u65B9\u6CD5"}),(0,l.jsx)(n.th,{children:"\u512A\u9EDE"}),(0,l.jsx)(n.th,{children:"\u7F3A\u9EDE"}),(0,l.jsx)(n.th,{children:"\u9069\u7528\u5834\u666F"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u539F\u59CB\u78BC\u5BB9\u5668\u5316"}),(0,l.jsx)(n.td,{children:"CI/CD \u74B0\u5883\u7121\u9700 JDK"}),(0,l.jsx)(n.td,{children:"\u5BB9\u5668\u5927\u3001\u5B89\u5168\u6027\u4F4E"}),(0,l.jsx)(n.td,{children:"\u958B\u767C\u6E2C\u8A66\u74B0\u5883"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"JAR \u5BB9\u5668\u5316"}),(0,l.jsx)(n.td,{children:"\u5BB9\u5668\u5C0F\u3001\u5B89\u5168\u6027\u9AD8"}),(0,l.jsx)(n.td,{children:"\u9700\u8981\u672C\u5730 JDK \u74B0\u5883"}),(0,l.jsx)(n.td,{children:"\u624B\u52D5\u90E8\u7F72"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u591A\u968E\u6BB5\u5EFA\u7F6E"}),(0,l.jsx)(n.td,{children:"\u517C\u5177\u524D\u5169\u8005\u512A\u9EDE"}),(0,l.jsx)(n.td,{children:"\u5EFA\u7F6E\u6642\u9593\u8F03\u9577"}),(0,l.jsx)(n.td,{children:"\u751F\u7522\u74B0\u5883\u63A8\u85A6"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"\u65B9\u6CD5\u4E00\u539F\u59CB\u78BC\u5BB9\u5668\u5316",children:"\u65B9\u6CD5\u4E00\uFF1A\u539F\u59CB\u78BC\u5BB9\u5668\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:17-jdk\nWORKDIR /app\n \n# \u8907\u88FD Maven \u5305\u88DD\u5668\u548C\u914D\u7F6E\u6A94\u6848\nCOPY .mvn/ .mvn\nCOPY mvnw pom.xml ./\n\n# \u4E0B\u8F09\u4F9D\u8CF4\uFF08\u5229\u7528 Docker \u5C64\u5FEB\u53D6\uFF09\nRUN ./mvnw dependency:go-offline\n \n# \u8907\u88FD\u539F\u59CB\u78BC\nCOPY src ./src\n \n# \u66B4\u9732\u57E0\u865F\nEXPOSE 8080\n\n# \u555F\u52D5\u61C9\u7528\u7A0B\u5F0F\nCMD ["./mvnw", "spring-boot:run"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5EFA\u7F6E\u548C\u57F7\u884C",children:"\u5EFA\u7F6E\u548C\u57F7\u884C"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5EFA\u7F6E\u6620\u50CF\u6A94\ndocker build -t spring-boot-source .\n\n# \u57F7\u884C\u5BB9\u5668\ndocker run -p 8080:8080 spring-boot-source\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u512A\u7F3A\u9EDE\u5206\u6790",children:"\u512A\u7F3A\u9EDE\u5206\u6790"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u512A\u9EDE\uFF1A"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"CI/CD \u74B0\u5883\u7121\u9700\u5B89\u88DD JDK"}),"\n",(0,l.jsx)(n.li,{children:"\u5B8C\u6574\u7684\u7DE8\u8B6F\u74B0\u5883"}),"\n",(0,l.jsx)(n.li,{children:"\u9069\u5408\u958B\u767C\u548C\u6E2C\u8A66"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7F3A\u9EDE\uFF1A"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5BB9\u5668\u6620\u50CF\u6A94\u8F03\u5927\uFF08\u5305\u542B\u5B8C\u6574 JDK \u548C\u539F\u59CB\u78BC\uFF09"}),"\n",(0,l.jsx)(n.li,{children:"\u5B89\u5168\u6027\u8F03\u4F4E\uFF08\u539F\u59CB\u78BC\u66B4\u9732\uFF09"}),"\n",(0,l.jsx)(n.li,{children:"\u4E0D\u9069\u5408\u751F\u7522\u74B0\u5883"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u65B9\u6CD5\u4E8Cjar-\u5BB9\u5668\u5316",children:"\u65B9\u6CD5\u4E8C\uFF1AJAR \u5BB9\u5668\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u672C\u5730\u5EFA\u7F6E-jar",children:"\u672C\u5730\u5EFA\u7F6E JAR"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5EFA\u7F6E JAR \u6A94\u6848\n./mvnw clean package -DskipTests\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dockerfile-1",children:"Dockerfile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:17-jre-alpine\n\n# \u5EFA\u7ACB\u975E root \u4F7F\u7528\u8005\nRUN addgroup -g 1001 -S appgroup && \\\n    adduser -u 1001 -S appuser -G appgroup\n\n# \u8A2D\u5B9A\u5DE5\u4F5C\u76EE\u9304\nWORKDIR /app\n\n# \u8907\u88FD JAR \u6A94\u6848\nCOPY target/*.jar app.jar\n\n# \u8B8A\u66F4\u6A94\u6848\u64C1\u6709\u8005\nRUN chown appuser:appgroup app.jar\n\n# \u5207\u63DB\u5230\u975E root \u4F7F\u7528\u8005\nUSER appuser\n\n# \u66B4\u9732\u57E0\u865F\nEXPOSE 8080\n\n# \u8A2D\u5B9A JVM \u53C3\u6578\u548C\u555F\u52D5\u61C9\u7528\u7A0B\u5F0F\nENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "app.jar"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5EFA\u7F6E\u548C\u57F7\u884C-1",children:"\u5EFA\u7F6E\u548C\u57F7\u884C"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5EFA\u7F6E\u6620\u50CF\u6A94\ndocker build -t spring-boot-jar .\n\n# \u57F7\u884C\u5BB9\u5668\ndocker run -p 8080:8080 spring-boot-jar\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u512A\u7F3A\u9EDE\u5206\u6790-1",children:"\u512A\u7F3A\u9EDE\u5206\u6790"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u512A\u9EDE\uFF1A"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5BB9\u5668\u6620\u50CF\u6A94\u8F03\u5C0F\uFF08\u50C5\u5305\u542B JRE \u548C JAR\uFF09"}),"\n",(0,l.jsx)(n.li,{children:"\u5B89\u5168\u6027\u8F03\u9AD8\uFF08\u7121\u539F\u59CB\u78BC\uFF09"}),"\n",(0,l.jsx)(n.li,{children:"\u555F\u52D5\u901F\u5EA6\u5FEB"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7F3A\u9EDE\uFF1A"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9700\u8981\u672C\u5730 JDK \u74B0\u5883"}),"\n",(0,l.jsx)(n.li,{children:"CI/CD \u74B0\u5883\u914D\u7F6E\u8907\u96DC"}),"\n",(0,l.jsx)(n.li,{children:"\u4F9D\u8CF4\u672C\u5730\u5EFA\u7F6E\u74B0\u5883"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u65B9\u6CD5\u4E09\u591A\u968E\u6BB5\u5EFA\u7F6E\u63A8\u85A6",children:"\u65B9\u6CD5\u4E09\uFF1A\u591A\u968E\u6BB5\u5EFA\u7F6E\uFF08\u63A8\u85A6\uFF09"}),"\n",(0,l.jsx)(n.h3,{id:"dockerfile-2",children:"Dockerfile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# \u7B2C\u4E00\u968E\u6BB5\uFF1A\u5EFA\u7F6E\u968E\u6BB5\nFROM eclipse-temurin:17-jdk-alpine AS builder\n\nWORKDIR /workspace/app\n\n# \u8907\u88FD Maven \u5305\u88DD\u5668\u548C\u914D\u7F6E\nCOPY mvnw .\nCOPY .mvn .mvn\nCOPY pom.xml .\n\n# \u4E0B\u8F09\u4F9D\u8CF4\nRUN ./mvnw dependency:go-offline\n\n# \u8907\u88FD\u539F\u59CB\u78BC\u4E26\u5EFA\u7F6E\nCOPY src src\nRUN ./mvnw clean package -DskipTests\n\n# \u89E3\u58D3 JAR \u6A94\u6848\u4EE5\u512A\u5316\u5C64\u7D50\u69CB\nRUN mkdir -p target/dependency && (cd target/dependency; jar -xf ../*.jar)\n\n# \u7B2C\u4E8C\u968E\u6BB5\uFF1A\u57F7\u884C\u968E\u6BB5\nFROM eclipse-temurin:17-jre-alpine\n\n# \u5B89\u88DD\u5FC5\u8981\u5DE5\u5177\u548C\u5EFA\u7ACB\u4F7F\u7528\u8005\nRUN apk add --no-cache curl && \\\n    addgroup -g 1001 -S appgroup && \\\n    adduser -u 1001 -S appuser -G appgroup\n\nWORKDIR /app\n\n# \u5F9E\u5EFA\u7F6E\u968E\u6BB5\u8907\u88FD\u6A94\u6848\uFF08\u5206\u5C64\u8907\u88FD\u4EE5\u512A\u5316\u5FEB\u53D6\uFF09\nARG DEPENDENCY=/workspace/app/target/dependency\nCOPY --from=builder ${DEPENDENCY}/BOOT-INF/lib /app/lib\nCOPY --from=builder ${DEPENDENCY}/META-INF /app/META-INF\nCOPY --from=builder ${DEPENDENCY}/BOOT-INF/classes /app\n\n# \u8B8A\u66F4\u6A94\u6848\u64C1\u6709\u8005\nRUN chown -R appuser:appgroup /app\n\n# \u5207\u63DB\u5230\u975E root \u4F7F\u7528\u8005\nUSER appuser\n\n# \u66B4\u9732\u57E0\u865F\nEXPOSE 8080\n\n# \u5065\u5EB7\u6AA2\u67E5\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost:8080/actuator/health || exit 1\n\n# \u555F\u52D5\u61C9\u7528\u7A0B\u5F0F\nENTRYPOINT ["java", "-cp", "app:app/lib/*", "com.example.demo.DemoApplication"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u512A\u5316\u7248\u672C\u4F7F\u7528-spring-boot-23-\u7684\u5206\u5C64\u529F\u80FD",children:"\u512A\u5316\u7248\u672C\uFF08\u4F7F\u7528 Spring Boot 2.3+ \u7684\u5206\u5C64\u529F\u80FD\uFF09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# \u5EFA\u7F6E\u968E\u6BB5\nFROM eclipse-temurin:17-jdk-alpine AS builder\nWORKDIR /workspace/app\n\nCOPY mvnw .\nCOPY .mvn .mvn\nCOPY pom.xml .\nRUN ./mvnw dependency:go-offline\n\nCOPY src src\nRUN ./mvnw clean package -DskipTests\nRUN java -Djarmode=layertools -jar target/*.jar extract\n\n# \u57F7\u884C\u968E\u6BB5\nFROM eclipse-temurin:17-jre-alpine\n\nRUN addgroup -g 1001 -S appgroup && \\\n    adduser -u 1001 -S appuser -G appgroup\n\nWORKDIR /app\nUSER appuser\n\n# \u5206\u5C64\u8907\u88FD\uFF08\u6309\u8B8A\u66F4\u983B\u7387\u6392\u5E8F\uFF09\nCOPY --from=builder workspace/app/dependencies/ ./\nCOPY --from=builder workspace/app/spring-boot-loader/ ./\nCOPY --from=builder workspace/app/snapshot-dependencies/ ./\nCOPY --from=builder workspace/app/application/ ./\n\nEXPOSE 8080\nENTRYPOINT ["java", "org.springframework.boot.loader.JarLauncher"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5EFA\u7F6E\u548C\u57F7\u884C-2",children:"\u5EFA\u7F6E\u548C\u57F7\u884C"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5EFA\u7F6E\u6620\u50CF\u6A94\ndocker build -t spring-boot-multistage .\n\n# \u57F7\u884C\u5BB9\u5668\ndocker run -p 8080:8080 spring-boot-multistage\n"})}),"\n",(0,l.jsx)(n.h2,{id:"docker-compose-\u914D\u7F6E",children:"Docker Compose \u914D\u7F6E"}),"\n",(0,l.jsx)(n.h3,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  app:\n    build: .\n    ports:\n      - "8080:8080"\n    environment:\n      - SPRING_PROFILES_ACTIVE=docker\n      - SPRING_DATASOURCE_URL=jdbc:postgresql://db:5432/myapp\n      - SPRING_DATASOURCE_USERNAME=myuser\n      - SPRING_DATASOURCE_PASSWORD=mypassword\n    depends_on:\n      - db\n    networks:\n      - app-network\n    restart: unless-stopped\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_DB=myapp\n      - POSTGRES_USER=myuser\n      - POSTGRES_PASSWORD=mypassword\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    networks:\n      - app-network\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n\nnetworks:\n  app-network:\n    driver: bridge\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u6700\u4F73\u5BE6\u8E10",children:"\u6700\u4F73\u5BE6\u8E10"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u5B89\u5168\u6027",children:"1. \u5B89\u5168\u6027"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:"# \u4F7F\u7528\u975E root \u4F7F\u7528\u8005\nRUN addgroup -g 1001 -S appgroup && \\\n    adduser -u 1001 -S appuser -G appgroup\nUSER appuser\n\n# \u4F7F\u7528\u6700\u5C0F\u5316\u57FA\u790E\u6620\u50CF\u6A94\nFROM eclipse-temurin:17-jre-alpine\n\n# \u5B9A\u671F\u66F4\u65B0\u57FA\u790E\u6620\u50CF\u6A94\nRUN apk update && apk upgrade\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u6548\u80FD\u512A\u5316",children:"2. \u6548\u80FD\u512A\u5316"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# JVM \u8ABF\u512A\nENV JAVA_OPTS="-Xmx512m -Xms256m -XX:+UseG1GC -XX:+UseContainerSupport"\n\n# \u555F\u52D5\u53C3\u6578\nENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u76E3\u63A7\u548C\u65E5\u8A8C",children:"3. \u76E3\u63A7\u548C\u65E5\u8A8C"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.yml\nservices:\n  app:\n    logging:\n      driver: "json-file"\n      options:\n        max-size: "10m"\n        max-file: "3"\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.routers.app.rule=Host(`myapp.local`)"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"4-\u74B0\u5883\u914D\u7F6E",children:"4. \u74B0\u5883\u914D\u7F6E"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# .env \u6A94\u6848\nSPRING_PROFILES_ACTIVE=production\nDATABASE_URL=jdbc:postgresql://db:5432/myapp\nREDIS_URL=redis://redis:6379\nJWT_SECRET=your-secret-key\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u90E8\u7F72\u8173\u672C",children:"\u90E8\u7F72\u8173\u672C"}),"\n",(0,l.jsx)(n.h3,{id:"deploysh",children:"deploy.sh"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nset -e\n\necho "Building Spring Boot application..."\ndocker build -t myapp:latest .\n\necho "Stopping existing containers..."\ndocker-compose down\n\necho "Starting new containers..."\ndocker-compose up -d\n\necho "Waiting for application to start..."\nsleep 30\n\necho "Checking application health..."\nif curl -f http://localhost:8080/actuator/health; then\n    echo "Application deployed successfully!"\nelse\n    echo "Application deployment failed!"\n    docker-compose logs app\n    exit 1\nfi\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u6545\u969C\u6392\u9664",children:"\u6545\u969C\u6392\u9664"}),"\n",(0,l.jsx)(n.h3,{id:"\u5E38\u898B\u554F\u984C",children:"\u5E38\u898B\u554F\u984C"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5BB9\u5668\u555F\u52D5\u5931\u6557"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u6AA2\u67E5\u65E5\u8A8C\ndocker logs <container-id>\n\n# \u9032\u5165\u5BB9\u5668\u9664\u932F\ndocker exec -it <container-id> /bin/sh\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u8A18\u61B6\u9AD4\u4E0D\u8DB3"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'# \u9650\u5236 JVM \u8A18\u61B6\u9AD4\u4F7F\u7528\nENV JAVA_OPTS="-Xmx512m -XX:+UseContainerSupport"\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7DB2\u8DEF\u9023\u7DDA\u554F\u984C"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u6AA2\u67E5\u7DB2\u8DEF\u914D\u7F6E\ndocker network ls\ndocker network inspect <network-name>\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u9664\u932F\u6280\u5DE7",children:"\u9664\u932F\u6280\u5DE7"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u6AA2\u67E5\u5BB9\u5668\u8CC7\u6E90\u4F7F\u7528\ndocker stats\n\n# \u6AA2\u67E5\u5BB9\u5668\u8A73\u7D30\u8CC7\u8A0A\ndocker inspect <container-id>\n\n# \u5373\u6642\u67E5\u770B\u65E5\u8A8C\ndocker logs -f <container-id>\n"})}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.docker.com/blog/9-tips-for-containerizing-your-spring-boot-code/",children:"9 Tips for Containerizing Your Spring Boot Code | Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://spring.io/guides/topicals/spring-boot-docker/",children:"Getting Started | Spring Boot Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.docker.com/build/building/multi-stage/",children:"Multi-stage builds"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},84429:function(e,n,r){r.d(n,{R:()=>s,x:()=>a});var i=r(96540);let l={},o=i.createContext(l);function s(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);