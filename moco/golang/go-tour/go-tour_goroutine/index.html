<!doctype html><html lang=zh-TW dir=ltr class="docs-wrapper plugin-docs plugin-id-moco docs-version-current docs-doc-page docs-doc-id-golang/go-tour/go-tour_goroutine" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Goroutine | kywk.me</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true property=og:url content=https://kywk.github.io/moco/golang/go-tour/go-tour_goroutine/ /><meta data-rh=true property=og:locale content=zh_TW /><meta data-rh=true name=docusaurus_locale content=zh-TW /><meta data-rh=true name=docsearch:language content=zh-TW /><meta data-rh=true name=keywords content="旅行, 背包客, 生活效率, 工程筆記, DevSecOps, Obsidian"/><meta data-rh=true name=author content=kywk /><meta data-rh=true property=og:type content=website /><meta data-rh=true property=og:site_name content=kywk.me /><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-moco-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-moco-current /><meta data-rh=true property=og:title content="Goroutine | kywk.me"/><meta data-rh=true name=description content=Goroutine /><meta data-rh=true property=og:description content=Goroutine /><meta data-rh=true property=og:image content="https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"/><meta data-rh=true name=twitter:image content="https://lh3.googleusercontent.com/pw/AM-JKLWu8wVpy5iA1V-YEeQHafjhEuZiS8kFPaPu0pj_m6yi09YtCsVYFT8Z6LxtDL57sWDXa8rRZm6B_OsIhWjgBWupJ1ZopYhtDR5PMn-4q8ypuliQvh5KDBfdZmKAxOkIXb4FhRvkuQsRhKiyjB02tR6otw=w860-h480-no?authuser=0s"/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://kywk.github.io/moco/golang/go-tour/go-tour_goroutine/ /><link data-rh=true rel=alternate href=https://kywk.github.io/moco/golang/go-tour/go-tour_goroutine/ hreflang=zh-TW /><link data-rh=true rel=alternate href=https://kywk.github.io/moco/golang/go-tour/go-tour_goroutine/ hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://kywk.github.io/moco/category/go","name":"Go","position":1},{"@type":"ListItem","item":"https://kywk.github.io/moco/category/a-tour-of-go","name":"A Tour of Go","position":2},{"@type":"ListItem","item":"https://kywk.github.io/moco/golang/go-tour/go-tour_goroutine","name":"Goroutine","position":3}]}</script><link rel=alternate type=application/rss+xml href=/news/rss.xml title="kywk.me RSS Feed"><link rel=alternate type=application/atom+xml href=/news/atom.xml title="kywk.me Atom Feed"><link rel=alternate type=application/rss+xml href=/life/rss.xml title="kywk.me RSS Feed"><link rel=alternate type=application/atom+xml href=/life/atom.xml title="kywk.me Atom Feed"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+TC:wght@400;500;700&display=swap" type=text/css><link rel=stylesheet href=https://unpkg.com/leaflet@1.9.4/dist/leaflet.css type=text/css><script src=https://unpkg.com/leaflet@1.9.4/dist/leaflet.js></script><script src=/js/leaflet-init.js></script><link rel=stylesheet href=/assets/css/styles.51adb6cf.css /><script src=/assets/js/runtime~main.1242ddc9.js defer></script><script src=/assets/js/main.350a5058.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/logo.svg /><div role=region aria-label=跳至主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳至主要内容</a></div><nav aria-label=主導航 class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切換導覽列 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt="kywk.me Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/logo.svg alt="kywk.me Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate">kywk.me</b></a><a class="navbar__item navbar__link" href=/backpacker/lonely-planet/>lonely planet</a><a class="navbar__item navbar__link" href=/lifehacker/way-2-kywk/>lifehacker</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/moco/kywk.moco/>moco</a><a class="navbar__item navbar__link" href=/life/>life</a><a class="navbar__item navbar__link" href=/news/>news</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/kywk/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切換淺色/深色模式（當前為system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到頂部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文件側邊欄 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/52-projects/><span title="52 Projects" class=categoryLinkLabel_W154>52 Projects</span></a><button aria-label="展開側邊欄分類 '52 Projects'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/life-with-ai/><span title="Life with AI" class=categoryLinkLabel_W154>Life with AI</span></a><button aria-label="展開側邊欄分類 'Life with AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/bootcamp/><span title=BOOTCAMP class=categoryLinkLabel_W154>BOOTCAMP</span></a><button aria-label="展開側邊欄分類 'BOOTCAMP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/tech-stack/><span title="Tech Stack" class=categoryLinkLabel_W154>Tech Stack</span></a><button aria-label="展開側邊欄分類 'Tech Stack'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/devsecops/><span title=DevSecOps class=categoryLinkLabel_W154>DevSecOps</span></a><button aria-label="展開側邊欄分類 'DevSecOps'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/moco/category/go/><span title=Go class=categoryLinkLabel_W154>Go</span></a><button aria-label="收起側邊欄分類 'Go'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/awesome/><span title="Awesome Golang" class=linkLabel_WmDU>Awesome Golang</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/go-standard-srctree/><span title="Go Standard SrcTree" class=linkLabel_WmDU>Go Standard SrcTree</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/way-to-go/><span title="Way to Go" class=linkLabel_WmDU>Way to Go</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex=0 href=/moco/category/a-tour-of-go/><span title="A Tour of Go" class=categoryLinkLabel_W154>A Tour of Go</span></a><button aria-label="收起側邊欄分類 'A Tour of Go'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/go-tour/go-tour_channel/><span title="Goroutine / Channel" class=linkLabel_WmDU>Goroutine / Channel</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/go-tour/go-tour_closure/><span title=Closure class=linkLabel_WmDU>Closure</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/go-tour/go-tour_defer/><span title=defar class=linkLabel_WmDU>defar</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/moco/golang/go-tour/go-tour_goroutine/><span title=Goroutine class=linkLabel_WmDU>Goroutine</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/moco/golang/go_get-started/><span title="Get Started" class=linkLabel_WmDU>Get Started</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/moco/golang/package/go-std-lib_strconv/><span title=package class=categoryLinkLabel_W154>package</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/javascript/><span title=JavaScript class=categoryLinkLabel_W154>JavaScript</span></a><button aria-label="展開側邊欄分類 'JavaScript'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/java/><span title=Java class=categoryLinkLabel_W154>Java</span></a><button aria-label="展開側邊欄分類 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/utilities/><span title=Utilities class=categoryLinkLabel_W154>Utilities</span></a><button aria-label="展開側邊欄分類 'Utilities'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/machintosh/><span title=Machintosh class=categoryLinkLabel_W154>Machintosh</span></a><button aria-label="展開側邊欄分類 'Machintosh'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/obsidian/><span title=Obsidian class=categoryLinkLabel_W154>Obsidian</span></a><button aria-label="展開側邊欄分類 'Obsidian'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/moco/category/miscellaneous/><span title=Miscellaneous class=categoryLinkLabel_W154>Miscellaneous</span></a><button aria-label="展開側邊欄分類 'Miscellaneous'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/moco/kywk.moco/><span title=kywk.moco class=linkLabel_WmDU>kywk.moco</span></a></ul></nav><button type=button title=收起側邊欄 aria-label=收起側邊欄 class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=頁面路徑><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label=主頁面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/moco/category/go/><span>Go</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/moco/category/a-tour-of-go/><span>A Tour of Go</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Goroutine</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>[Go] Tour: Goroutine 心得筆記</h1></header>
<p><em>本篇大多參考於 <a href=https://peterhpchen.github.io/2020/03/08/goroutine-and-channel.html target=_blank rel="noopener noreferrer" class="">Go 的並發：Goroutine 與 Channel 介紹 - Limitless Ping</a>,
加上一些個人理解與整理. 強烈建議參閱原文, 圖文並茂, 敘事條理分明的好文章.</em></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=threading>Threading<a href=#threading class=hash-link aria-label=Threading的直接連結 title=Threading的直接連結 translate=no>​</a></h2>
<p>先來了解執行緒.<br/>
單執行緒情況下, 程式碼會依序執行.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    begin </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"world"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"hello"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    diff </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sub</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">begin</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Printf</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"spent %d ms"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> diff</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Milliseconds</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">spent 1000 ms</span><br/></span></code></pre></div></div>
<p>這個例子中, 會先執行完 <code>say("world")</code> 才執行 <code>say("hello")</code>.</p>
<p>有時程式中個別函式之間並無先後順序關係, 若可以善用多執行緒執行, 則可大幅提升執行效率.
一般來說, Go 多執行緒最多可以同時執行和 CPU 數量相等的 Goroutine.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    begin </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"world"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"hello"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    diff </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sub</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">begin</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Printf</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"spent %d ms"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> diff</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Milliseconds</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">spent 500 ms</span><br/></span></code></pre></div></div>
<p><code>say("world")</code> 會在另一個執行緒 (Goroutine) 上, 和 <code>main</code> 程序同時執行.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=goroutine-介紹>Goroutine 介紹<a href=#goroutine-介紹 class=hash-link aria-label="Goroutine 介紹的直接連結" title="Goroutine 介紹的直接連結" translate=no>​</a></h2>
<p>Goroutine 類似 golang 的 thread, 讓 Go 可以多工處理,
main function 本身就是一個 Goroutine,
常見會和 Channel 搭配協同工作, 可以簡化 Goroutine 操作.</p>
<p>建立一個 Goroutine 就等於建立一個新執行緒.
建立 Goroutine 相當簡單, 僅需在函式呼叫前加 <code>go</code> 前綴聲明即可.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>f</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">x</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> y</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> z</span><span class="token punctuation" style=color:#393A34>)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=lifecycle>LifeCycle<a href=#lifecycle class=hash-link aria-label=LifeCycle的直接連結 title=LifeCycle的直接連結 translate=no>​</a></h2>
<p>在 golang 中, 當 main Goroutine 結束後, 其他 Goroutine 都會強制結束.
因此 Goroutine 生命週期從被建立時開始, 到函式執行結束返回或 main Goroutine 結束時一起結束.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    begin </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"world"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"hello"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>200</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    diff </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sub</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">begin</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Printf</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"spent %d ms"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> diff</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Milliseconds</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hello</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">world</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">spent 200 ms</span><br/></span></code></pre></div></div>
<p>這段程式共有 <code>main</code>, <code>say("world")</code>, <code>say("hello")</code> 三個 Goroutine.
main Goroutune 僅需花費 200ms, 少於其他兩個 <code>say</code> Goroutine,
當 main 結束時, 另外兩個 Goroutine 會跟著強制停止.</p>
<p>用 <code>time.Sleep</code> 雖然可以延後 main 結束時間, 讓其他 Goroutine 有機會執行完成.
但若 sleep 時間太短, 仍無法讓其他 Goroutine 完成.
而如果 sleep 時間太長, 則會影響程式效率.
除非程式執行時間有所限制, 否則用 <code>time.Sleep</code> 來等候 Goroutine 並非好方法.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=等候-goroutine>等候 Goroutine<a href=#等候-goroutine class=hash-link aria-label="等候 Goroutine的直接連結" title="等候 Goroutine的直接連結" translate=no>​</a></h2>
<p>若程式必須等候所有 Goroutine 執行完畢, 透過 sleep 等候是不可靠的.
Go 裡面的常見等候方式有 <code>sync.WaitGroup</code> 或 <code>channel</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=syncwaitgroup>sync.WaitGroup<a href=#syncwaitgroup class=hash-link aria-label=sync.WaitGroup的直接連結 title=sync.WaitGroup的直接連結 translate=no>​</a></h3>
<blockquote>
<p>Package sync provides basic synchronization primitives such as mutual exclusion locks. Other than the Once and WaitGroup types, most are intended for use by low-level library routines. Higher-level synchronization is better done via channels and communication.</p>
</blockquote>
<p>Go 內建 <code>sync</code> 套件可以管理多個 Goroutine 之間的執行狀態.<br/>
在上面例子中, 若程式需等候所有 Goroutine 執行結束後才能結束, 可使用 <code>sync.WaitGroup</code>.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> wg </span><span class="token operator" style=color:#393A34>*</span><span class="token plain">sync</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">WaitGroup</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>defer</span><span class="token plain"> wg</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Done</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    wg </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>new</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">sync</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">WaitGroup</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    wg</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"world"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> wg</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"hello"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> wg</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    wg</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Wait</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<ul>
<li class="">建立和需要等候的 Goroutine 數量相同的 <code>WaitGroup</code> counter.</li>
<li class="">將 <code>WaitGroup</code> 傳入 Goroutine 中, 在函式執行結束時呼叫 <code>wg.Done()</code> 將 counter 減一.<br/>
常見會在函式最前面使用 <code>defer wg.Done()</code>, 以確保 Goroutine 結束時 <code>wg.Done()</code> 會被執行.</li>
<li class=""><code>wg.Wait()</code> 會等候到 counter 為零為止.</li>
</ul>
<p><code>WaitGroup</code> 使用上相對簡單, 但要注意手動配置數量符合的 counter.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=channel>channel<a href=#channel class=hash-link aria-label=channel的直接連結 title=channel的直接連結 translate=no>​</a></h3>
<p>channel 通常拿來做 Goroutine 之間溝通訊息時使用,
但因其阻塞特性, 亦可拿來當作等候 Goroutine 的方法.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> c </span><span class="token keyword" style=color:#00009f>chan</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Millisecond</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">s</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    c </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"FINISH"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    ch </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>make</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>chan</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"world"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> ch</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>say</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"hello"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> ch</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain">ch</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain">ch</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<ul>
<li class="">建立了一個 channel 用以溝通訊息.</li>
<li class="">建立了 <code>say()</code> Goroutine, 傳入 channel.</li>
<li class="">main 函式中等候 channel 的資料, 此時若 channel 裡面沒有資料, 會阻塞程式執行.
直到某個 Goroutine 執行到 <code>c &lt;- "FINISH"</code> 時才會繼續執行.</li>
<li class="">本例中建立了兩個 Goroutine, 所以需要讀取兩次 channel 資料.</li>
</ul>
<p>Channel 阻塞的方法為 Go 語言中等待的主要方式.</p>
<p>要注意的是, Goroutine 常會和 Channel 搭配做訊息溝通,
若傳入的 Channel 會拿來溝通訊息, 同時也當作阻塞等待的話, 需要注意傳回值的判斷等.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=共享變數>共享變數<a href=#共享變數 class=hash-link aria-label=共享變數的直接連結 title=共享變數的直接連結 translate=no>​</a></h2>
<p>多執行緒下使用相同變數時, 要特別注意競爭問題.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    total </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>func</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            total</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Second</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">total</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">981</span><br/></span></code></pre></div></div>
<p>在 for 迴圈中建立的閉包參照了同一個 total 變數.
多執行緒情況下, 可能導致實際運行狀況如下:</p>
<ol>
<li class="">假設此時 total 值為 70</li>
<li class=""><code>goroutine1</code> 讀取 total (70), 運算 total++ = 71</li>
<li class=""><code>goroutine2</code> 讀取 total (70), 運算 total++ = 71</li>
<li class=""><code>goroutine2</code> 寫回 total 值 71</li>
<li class=""><code>goroutine1</code> 寫回 total 值 71</li>
</ol>
<p><code>goroutine1</code> 和 <code>goroutine2</code> 同時進行加法運算, 並先後將計算後的值寫回記憶過, 可能導致運算錯誤.
在多個 goroutine 裡對同一個變數 total 做加法運算, 在賦值時無法確保其為安全的而導致運算錯誤,
此問題稱為 <strong>Race Condition</strong>.</p>
<p>在執行緒間使用同樣的變數時, 最重要的是確保變數在當前的正確性.<br/>
Go 裡面有幾個常見方法:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=syncmutex-互斥鎖>sync.Mutex (互斥鎖)<a href=#syncmutex-互斥鎖 class=hash-link aria-label="sync.Mutex (互斥鎖)的直接連結" title="sync.Mutex (互斥鎖)的直接連結" translate=no>​</a></h3>
<p><code>sync.Mutex</code> (互斥鎖) 是 sync 套件中用以確保 critical section 正確性的工具物件.
互斥鎖提供兩個方法:</p>
<ul>
<li class="">Lock</li>
<li class="">Unlock
在 Lock 及 Unlock 中間, 會使其他的 Goroutine 等待, 確保此區塊中的變數安全.</li>
</ul>
<p><code>sync.Mutex</code> 相當簡易好用, 宣告變數後, 在要需保護的程式區段前後分別加上 Lock / Unlock 即可.
如下:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    total </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    mux </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> sync</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Mutex</span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>func</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            mux</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Lock</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            total</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            mux</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Unlock</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Second</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    mux</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Lock</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">total</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    mux</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Unlock</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=藉由-channel-保證變數的安全性>藉由 Channel 保證變數的安全性<a href=#藉由-channel-保證變數的安全性 class=hash-link aria-label="藉由 Channel 保證變數的安全性的直接連結" title="藉由 Channel 保證變數的安全性的直接連結" translate=no>​</a></h3>
<p>因為 Channel 推入及拉出時阻塞與等待的特性, 也可以把共享變數存入 Channel 之中,
拉出來做計算的值會保證是安全的.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>func</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    total </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    ch </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>make</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>chan</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    ch </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain"> total</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>:=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>go</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>func</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            ch </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain">ch </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Sleep</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">time</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Second</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    fmt</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Println</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>&lt;-</span><span class="token plain">ch</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<ol>
<li class="">將 total 資料寫入 Channel 之中.</li>
<li class=""><code>goroutine1</code> 從 Channel 中讀取資料進行運算.</li>
<li class=""><code>goroutine2</code> 要從 Channel 讀資料時, 因 Channel 中已無資料, 需等候.</li>
<li class=""><code>goroutine1</code> 把運算結果寫回 Channel.</li>
<li class=""><code>goroutine2</code> 等到 Channel 中有資料, 拉出後結束等待, 繼續做運算.</li>
<li class="">...</li>
</ol>
<p>Channel 阻塞的特性, 搭配 Goroutine 可以用來作流程管控等功能.
但 Channel 還有其他特性, 拿 Channel 當作溝通資料之外的用途時, 仍需特別注意.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=小結>小結<a href=#小結 class=hash-link aria-label=小結的直接連結 title=小結的直接連結 translate=no>​</a></h2>
<p>善用 Goroutine 多執行緒特性可以避免等候, 增進程式效率.
需要等候的時機, 也可用 <code>time.Sleep</code>, <code>sync.WaitGroup</code> 或 Channel 的方式處理.</p>
<p>而在多執行緒程式中常要注意的 Race Condition,
在 Go 裡可以很簡單的用 <code>sync.Mutex</code> 和 Channel 來管理.</p>
<p>相對其他語言, Go 在多執行緒上的創建和管理都相當簡單, 大幅降低程式複雜度.
而 Channel 的阻塞特性, 在多執行緒中發揮方便強大的能力, 後篇繼續討論 Channel.</p>
<p><a class="" href=/moco/golang/go-tour/go-tour_channel/><em>續: Go: Goroutine 和 Channel 心得筆記</em></a></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>標籤：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/moco/tags/go/>Go</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/moco/tags/go-go-tour/>Go/GoTour</a></ul></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label=文件選項卡><a class="pagination-nav__link pagination-nav__link--prev" href=/moco/golang/go-tour/go-tour_defer/><div class=pagination-nav__sublabel>上一頁</div><div class=pagination-nav__label>defar</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/moco/golang/go_get-started/><div class=pagination-nav__sublabel>下一頁</div><div class=pagination-nav__label>Get Started</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#threading class="table-of-contents__link toc-highlight">Threading</a><li><a href=#goroutine-介紹 class="table-of-contents__link toc-highlight">Goroutine 介紹</a><li><a href=#lifecycle class="table-of-contents__link toc-highlight">LifeCycle</a><li><a href=#等候-goroutine class="table-of-contents__link toc-highlight">等候 Goroutine</a><ul><li><a href=#syncwaitgroup class="table-of-contents__link toc-highlight">sync.WaitGroup</a><li><a href=#channel class="table-of-contents__link toc-highlight">channel</a></ul><li><a href=#共享變數 class="table-of-contents__link toc-highlight">共享變數</a><ul><li><a href=#syncmutex-互斥鎖 class="table-of-contents__link toc-highlight">sync.Mutex (互斥鎖)</a><li><a href=#藉由-channel-保證變數的安全性 class="table-of-contents__link toc-highlight">藉由 Channel 保證變數的安全性</a></ul><li><a href=#小結 class="table-of-contents__link toc-highlight">小結</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>主題索引</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/backpacker/lonely-planet/>Backpacker</a><li class=footer__item><a class=footer__link-item href=/lifehacker/way-2-kywk/>Lifehacker</a><li class=footer__item><a class=footer__link-item href=/moco/kywk.moco/>MoCo Lab</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>筆記頻道</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/news/>News Log</a><li class=footer__item><a class=footer__link-item href=/life/>Life Blog</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>連結</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/kywk target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2026 kywk. Built with Docusaurus.</div></div></div></footer></div></body>