<!doctype html><html lang=zh-tw dir=ltr class="docs-wrapper plugin-docs plugin-id-moco docs-version-current docs-doc-page docs-doc-id-devsecops/infra/redis_cluster" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.1"><title data-rh=true>Redis: Cluster 建製 | kywk.me</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://kywk.github.io/moco/devsecops/infra/redis_cluster/><meta data-rh=true property=og:locale content=zh_tw><meta data-rh=true name=docusaurus_locale content=zh-tw><meta data-rh=true name=docsearch:language content=zh-tw><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-moco-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-moco-current><meta data-rh=true property=og:title content="Redis: Cluster 建製 | kywk.me"><meta data-rh=true name=description content="Redis-Cluster 為無中心化架構, 每個節點都會儲存數據以及整個叢集狀態, 每個節點都會和其他節點建立連線."><meta data-rh=true property=og:description content="Redis-Cluster 為無中心化架構, 每個節點都會儲存數據以及整個叢集狀態, 每個節點都會和其他節點建立連線."><meta data-rh=true property=og:image content="https://lh3.googleusercontent.com/pw/ACtC-3fIlrxgO6AX1o_tNuiD0YfrwpojgHUZa_OSpR36XoOZ_Ojz9q0Bw9yZ2V9QwSKUqApRMEIPWetv9AQd4TsfGgE0AaZXj7IJ2NV6ffvWj7N_Fjo2EzJ7BaCjZ7Fxx702zh6ZnykZAOChtRM-P1Zr9t0SYQ=w800-no?authuser=0"><meta data-rh=true name=twitter:image content="https://lh3.googleusercontent.com/pw/ACtC-3fIlrxgO6AX1o_tNuiD0YfrwpojgHUZa_OSpR36XoOZ_Ojz9q0Bw9yZ2V9QwSKUqApRMEIPWetv9AQd4TsfGgE0AaZXj7IJ2NV6ffvWj7N_Fjo2EzJ7BaCjZ7Fxx702zh6ZnykZAOChtRM-P1Zr9t0SYQ=w800-no?authuser=0"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://kywk.github.io/moco/devsecops/infra/redis_cluster/><link data-rh=true rel=alternate href=https://kywk.github.io/moco/devsecops/infra/redis_cluster/ hreflang=zh-tw><link data-rh=true rel=alternate href=https://kywk.github.io/moco/devsecops/infra/redis_cluster/ hreflang=x-default><link rel=alternate type=application/rss+xml href=/news/rss.xml title="kywk.me RSS Feed"><link rel=alternate type=application/atom+xml href=/news/atom.xml title="kywk.me Atom Feed"><link rel=alternate type=application/rss+xml href=/life/rss.xml title="kywk.me RSS Feed"><link rel=alternate type=application/atom+xml href=/life/atom.xml title="kywk.me Atom Feed"><link rel=stylesheet href=/assets/css/styles.2377974f.css><script src=/assets/js/main.c78b0097.js defer></script><script src=/assets/js/runtime~main.add00230.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=跳至主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳至主要内容</a></div><nav aria-label=主導航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切換導覽列 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/logo.svg alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">kywk.me</b></a><a class="navbar__item navbar__link" href="/backpacker/Lonely Planet/">lonely planet</a><a class="navbar__item navbar__link" href=/lifehacker/way-2-kywk/>lifehacker</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/moco/kywk.moco/>moco</a><a class="navbar__item navbar__link" href=/news/>news</a><a class="navbar__item navbar__link" href=/life/>life</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/kywk/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title=切換淺色/深色模式（當前為淺色模式） aria-label=切換淺色/深色模式（當前為淺色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class=navbar__search><span aria-label="expand searchbar" role=button class=search-icon tabindex=0></span><input id=search_input_react type=search placeholder=Loading... aria-label=Search class="navbar__search-input search-bar" disabled></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到頂部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文件側邊欄 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/52-projects/>52 Projects</a><button aria-label="展開側邊欄分類 '52 Projects'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/bootcamp/>BOOTCAMP</a><button aria-label="展開側邊欄分類 'BOOTCAMP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/tech-stack/>Tech Stack</a><button aria-label="展開側邊欄分類 'Tech Stack'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/moco/category/devsecops/>DevSecOps</a><button aria-label="收起側邊欄分類 'DevSecOps'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/awesome/>Awesome DevOps</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/moco/category/cicd/>CI/CD</a><button aria-label="展開側邊欄分類 'CI/CD'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/moco/category/docker/>Docker</a><button aria-label="展開側邊欄分類 'Docker'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/moco/category/elk/>ELK</a><button aria-label="展開側邊欄分類 'ELK'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/moco/category/gitlab/>GitLab</a><button aria-label="展開側邊欄分類 'GitLab'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/moco/category/sre/>SRE</a><button aria-label="收起側邊欄分類 'SRE'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/awesome/>Awesome SRE</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/nexus-repository/>Bash: snippets</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/nginx_docker-tips/>NGINX: container tips</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/nginx_lets-encrypt-ssl/>NGINX: Let's Encrypt SSL</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/nginx_modify-endpoint/>NGINX: changes URI</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/nginx_snippets/>NGINX: Snippets</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/moco/devsecops/infra/redis_cluster/>Redis: Cluster 建製</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/redis_troubleshooting/>Redis: 警告與問題排除</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/moco/devsecops/infra/ubuntu_nginx-php/>Ubuntu: NGINX + PHP</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/moco/category/security/>Security</a><button aria-label="展開側邊欄分類 'Security'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/go/>Go</a><button aria-label="展開側邊欄分類 'Go'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/nodejs/>Node.js</a><button aria-label="展開側邊欄分類 'Node.js'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/java/>Java</a><button aria-label="展開側邊欄分類 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/python/>Python</a><button aria-label="展開側邊欄分類 'Python'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/rust/>Rust</a><button aria-label="展開側邊欄分類 'Rust'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/frontend/>Frontend</a><button aria-label="展開側邊欄分類 'Frontend'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/utilities/>Utilities</a><button aria-label="展開側邊欄分類 'Utilities'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/machintosh/>Machintosh</a><button aria-label="展開側邊欄分類 'Machintosh'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/obsidian/>Obsidian</a><button aria-label="展開側邊欄分類 'Obsidian'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/moco/category/miscellaneous/>Miscellaneous</a><button aria-label="展開側邊欄分類 'Miscellaneous'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/moco/api/RAML/>api</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/moco/kywk.moco/>kywk.moco</a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=頁面路徑><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主頁面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/moco/category/devsecops/><span itemprop=name>DevSecOps</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/moco/category/sre/><span itemprop=name>SRE</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Redis: Cluster 建製</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>[Redis] 建製 Redis Cluster</h1></header>
<p>Redis-Cluster 為無中心化架構, 每個節點都會儲存數據以及整個叢集狀態, 每個節點都會和其他節點建立連線.
一組 Redis Cluster 由多個獨立 Redis 節點組成,
官方建議六個節點, 其中三個為主節點 (master) 三個為從節點 (slave).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=安裝-redis>安裝 Redis<a href=#安裝-redis class=hash-link aria-label="安裝 Redis的直接連結" title="安裝 Redis的直接連結">​</a></h2>
<p>略. 可透過不同系統的套件管理程式安裝, 或參考<a href=https://redis.io/download target=_blank rel="noopener noreferrer">官方文件</a>下載 source tar ball 編譯安裝.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">$ wget https://download.redis.io/releases/redis-6.2.3.tar.gz</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ tar xzf redis-6.2.3.tar.gz</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ cd redis-6.2.3</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ make</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>編譯後執行檔在 <code>src/redis-server</code>, 可試著執行開啟 redis 服務.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cow@sandbox:~/tmp/redis/src# ./redis-server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:C 06 May 2021 07:58:52.254 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:C 06 May 2021 07:58:52.254 # Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=25572, just started</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:C 06 May 2021 07:58:52.254 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 * Increased maximum number of open files to 10032 (it was originally set to 1024).</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                _._</span><br></span><span class=token-line style=color:#393A34><span class="token plain">           _.-``__ ''-._</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      _.-``    `.  `_.  ''-._           Redis 5.0.5 (00000000/0) 64 bit</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  .-`` .-```.  ```\/    _.,_ ''-._</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> (    '      ,       .-`  | `,    )     Running in standalone mode</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |    `-._   `._    /     _.-'    |     PID: 25572</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  `-._    `-._  `-./  _.-'    _.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |`-._`-._    `-.__.-'    _.-'_.-'|</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |    `-._`-._        _.-'_.-'    |           http://redis.io</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  `-._    `-._`-.__.-'_.-'    _.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |`-._`-._    `-.__.-'    _.-'_.-'|</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> |    `-._`-._        _.-'_.-'    |</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  `-._    `-._`-.__.-'_.-'    _.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      `-._    `-.__.-'    _.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          `-._        _.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain">              `-.__.-'</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 # Server initialized</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">25572:M 06 May 2021 07:58:52.255 * Ready to accept connections</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>出現 <strong>Ready to accept connections</strong> 後表示 Redis 程式可正常運作,
可再依需要把執行檔複製到 `/usr/local/bin' 之類系統資料夾中.</p>
<p>而警告訊息的排除可參考: <a href=/moco/devsecops/infra/redis_troubleshooting/>Redis 警告訊息排除</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=準備-config>準備 config<a href=#準備-config class=hash-link aria-label="準備 config的直接連結" title="準備 config的直接連結">​</a></h2>
<p>官方建議使用六個 node 來建 redis cluster,
實際業務運行上通常為六台獨立的主機, 使用同一份 config 部署到六台主機即可.</p>
<blockquote>
<p>本地測試在同一台主機上跑六個不同 redis-server instance, 分別使用 Port: 7001 ~ 7006. 因此需準備六份 config.</p>
</blockquote>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">$ mkdir 7001 7002 7003 7004 7005 7006</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ vi 7001/redis.config</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">port 7001</span><br></span><span class=token-line style=color:#393A34><span class="token plain">cluster-enabled yes</span><br></span><span class=token-line style=color:#393A34><span class="token plain">cluster-config-file nodes_7001.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">cluster-node-timeout 5000</span><br></span><span class=token-line style=color:#393A34><span class="token plain">appendonly yes</span><br></span><span class=token-line style=color:#393A34><span class="token plain">daemonize yes</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bind x.x.x.x</span><br></span><span class=token-line style=color:#393A34><span class="token plain">requirepass password</span><br></span><span class=token-line style=color:#393A34><span class="token plain">masterauth password</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>基本需要的設置內容與簡單說明如下:</p>
<ul>
<li><strong>port</strong> <em>7001</em><br>
Redis-Server instance 所服務的 port, 相同主機的話需錯開.</li>
<li><strong>cluster-enabled</strong> <em>yes</em><br>
啟用 redis cluster</li>
<li><strong>cluster-config-file</strong> <em>nodes_7001.conf</em><br>
每個 node 需要獨立的 cluster 設定檔.
僅需指定檔名, 無須設定檔案內容.
redis-cluster 運作時會自行維護與修改該檔案內容.</li>
<li><strong>cluster-node-timeout</strong> <em>5000</em><br>
node 判斷失效的時間</li>
<li><strong>appendonly</strong> <em>yes</em><br>
啟用 aof</li>
</ul>
<p>設定檔有上述內容, 基本上就可以執行一個 redis-cluster node 了.
而一些常見的額外設定如下:</p>
<ul>
<li><strong>daemonize</strong> <em>yes</em><br>
背景執行</li>
<li><strong>bind</strong> <em>x.x.x.x</em><br>
允許 listen 特定 ip 的連線</li>
<li><strong>requirepass</strong> <em>password</em><br>
密碼設定</li>
<li><strong>masterauth</strong> <em>password</em><br>
從 master 的密碼</li>
</ul>
<p><img decoding=async loading=lazy src="https://lh3.googleusercontent.com/pw/ACtC-3cIjjFhS63ywfyKTBTR55SdYX1NTTwgKzdEjZ9LqEuyrjRM2yUSQ7nWOw_zki8AQLXzLJLjRuseunT-LcW5QTEt6Jg7D18Gf3S5B8yGy_ittXXp19pD8FCj33nBdo-pZbKl2BkLTPK0rzOo5ntxgCUoFQ=w502no?authuser=0" alt="" class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=啟動>啟動<a href=#啟動 class=hash-link aria-label=啟動的直接連結 title=啟動的直接連結>​</a></h2>
<p>透過 <code>redis-server</code> 搭配各個設定檔, 逐一啟動不同的 redis-server instance</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7001/redif.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7002/redif.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7003/redif.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7004/redif.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7005/redif.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">$ redis-server 7006/redif.conf</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=加入-cluster>加入 cluster<a href=#加入-cluster class=hash-link aria-label="加入 cluster的直接連結" title="加入 cluster的直接連結">​</a></h2>
<p>只是把各個 redis-server instance 跑起來, 彼此尚不是 cluster 裡面的 node,
需下指令建理 cluster.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">$ redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=複製程式碼至剪貼簿 title=複製 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><strong>redis-cli</strong><br>
redis CLI 控制程式, 除了集成一些控制項目外, 也是個完整的 redis-client.</li>
<li><strong>--cluster create</strong> <em>x.x.x.x:port1 ... x.x.x.x:port6</em><br>
利用這些 redis-server instance 建立 redis-cluster.</li>
<li><strong>--cluster-replicas</strong> <em>1</em><br>
一個 master 節點搭配一個 slave 節點.<br>
因上述指令共有六個節點, 所以會建構出三個 master 節點搭配三個 slave 節點.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=see-also>See Also<a href=#see-also class=hash-link aria-label="See Also的直接連結" title="See Also的直接連結">​</a></h2>
<p>以上是最常見的 Redis Cluster 建製方法, 也是官方建議的方案.
關於 Redis Cluster 進一步資訊, <a href="https://www.796t.com/article.php?id=192567" target=_blank rel="noopener noreferrer">Redis初步學習整理——第五節Cluster叢集部署、主從複製、哨兵模式_資料庫_程式人生</a>
是個相當不錯的文章, 值得一讀.</p>
<p>其他參考資料陳列於下:</p>
<ul>
<li><a href=https://redis.io/topics/cluster-tutorial target=_blank rel="noopener noreferrer">Redis cluster tutorial – Redis</a></li>
<li><a href=https://tw511.com/a/01/6479.html target=_blank rel="noopener noreferrer">Centos 7 部署Redis 三主三從叢集 - tw511教學網</a></li>
<li><a href=https://blog.yowko.com/create-redis-cluster/ target=_blank rel="noopener noreferrer">建立 Redis Cluster (Redis 5) - Yowko's Notes</a></li>
<li><a href=https://medium.com/@zihansyu/redis-%E9%9B%86%E7%BE%A4%E6%9E%B6%E8%A8%AD-ff641c97232c target=_blank rel="noopener noreferrer">Redis 集群架設. 前言 | by 徐子函 | Medium</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>標籤：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a class="tag_zVej tagRegular_sFm0" href=/moco/tags/infra/>Infra</a><li class=tag_QGVx><a class="tag_zVej tagRegular_sFm0" href=/moco/tags/redis/>Redis</a></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件選項卡><a class="pagination-nav__link pagination-nav__link--prev" href=/moco/devsecops/infra/nginx_snippets/><div class=pagination-nav__sublabel>上一頁</div><div class=pagination-nav__label>NGINX: Snippets</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/moco/devsecops/infra/redis_troubleshooting/><div class=pagination-nav__sublabel>下一頁</div><div class=pagination-nav__label>Redis: 警告與問題排除</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#安裝-redis class="table-of-contents__link toc-highlight">安裝 Redis</a><li><a href=#準備-config class="table-of-contents__link toc-highlight">準備 config</a><li><a href=#啟動 class="table-of-contents__link toc-highlight">啟動</a><li><a href=#加入-cluster class="table-of-contents__link toc-highlight">加入 cluster</a><li><a href=#see-also class="table-of-contents__link toc-highlight">See Also</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/lifehacker/way-2-kywk/>Journal</a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://stackoverflow.com/questions/tagged/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://discordapp.com/invite/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>Discord<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://twitter.com/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/life/>Blog</a><li class=footer__item><a href=https://github.com/facebook/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 kywk. Built with Docusaurus.</div></div></div></footer></div>